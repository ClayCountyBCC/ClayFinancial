var __awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},Utilities,Transaction;(function(n){function t(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("hide");n.classList.remove("show");n.classList.remove("show-inline");n.classList.remove("show-flex")}function r(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show-flex")}function a(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function v(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline-flex");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function y(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-flex");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show")}function o(n,u,f){if(typeof n=="string"&&(n=document.getElementById(n)),u){i(n);let r=document.createElement("div");r.classList.add("notification");r.classList.add("is-danger");let f=document.createElement("button");if(f.classList.add("delete"),f.onclick=()=>{t(n)},r.appendChild(f),Array.isArray(u)){let n=document.createElement("ul");u.forEach(t=>{let i=document.createElement("li");i.appendChild(document.createTextNode(t));n.appendChild(i)});r.appendChild(n)}else r.appendChild(document.createTextNode(u));n.appendChild(r)}r(n);(f==undefined||f===!0)&&window.setTimeout(function(){t(n)},3e4)}function p(n,t){i(n);n.appendChild(document.createTextNode(t))}function i(n){if(n!==null&&n!==undefined)while(n.firstChild)n.removeChild(n.firstChild)}function w(n,t,i=false){let r=document.createElement("option");return r.value=n,r.text=t,r.selected=i,r}function s(n){return typeof n=="string"&&(n=document.getElementById(n)),n.value}function b(n,t){typeof n=="string"&&(n=document.getElementById(n));n.value=t}function u(n,t){typeof n=="string"&&(n=document.getElementById(n));i(n);n.appendChild(document.createTextNode(t))}function h(n){let i=n.replace("nav-",""),t=document.querySelectorAll("#menuTabs > li > a");if(t.length>0)for(let i=0;i<t.length;i++){let r=t.item(i);r.id===n?r.parentElement.classList.add("is-active"):r.parentElement.classList.remove("is-active")}f("#views > section",i)}function k(n,t,i){c(n,"nav-"+i);f(t,i)}function c(n,t){let i=document.querySelectorAll(n);if(i.length>0)for(let n=0;n<i.length;n++){let r=i.item(n);r.id===t?r.classList.add("is-active"):r.classList.remove("is-active")}}function f(n,i){let u=document.querySelectorAll(n);if(u.length>0)for(let n=0;n<u.length;n++){let f=u.item(n);f.id===i?r(f):t(f)}}function d(n){return __awaiter(this,void 0,void 0,function*(){const t=yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"});if(!t.ok)throw new Error(t.statusText);return yield t.json()})}function g(n,t){return fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(n=>{if(!n.ok)throw new Error(n.statusText);return n.json()})}function nt(n,t){return fetch(n,{method:"POST",body:t!==null?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(n=>n)}function tt(n){return n.toLocaleString("en-US",{style:"currency",currency:"USD"})}function it(n){if(n instanceof Date)return n.toLocaleDateString("en-us");var t=new Date(n);return t.toLocaleDateString("en-US")}function rt(n){return n instanceof Date?n.toLocaleString("en-us"):new Date(n).toLocaleString("en-US")}function ut(n,t,i){typeof n=="string"&&(n=document.getElementById(n));let r=n;r.tagName.toLowerCase()==="select"?r.parentElement.classList.remove("is-danger"):r.classList.remove("is-danger");let u=s(r).trim();return u.length==0?(r.tagName.toLowerCase()==="select"?r.parentElement.classList.add("is-danger"):r.classList.add("is-danger"),o(t,i),r.focus(),r.scrollTo(),""):u}function ft(n,t){typeof n=="string"&&(n=document.getElementById(n));let i=n;i.disabled=t;i.classList.toggle("is-loading",t)}function et(n){let i=document.createElement("li");n.selected&&i.classList.add("is-active");let t=document.createElement("a");if(t.id=n.id,t.onclick=function(){l(n)},n.icon.length>0){let i=document.createElement("span");i.classList.add("icon");i.classList.add(Transaction.app_input_size);let r=document.createElement("i"),u=n.icon.split(" ");for(let n of u)r.classList.add(n);i.appendChild(r);t.appendChild(i)}return t.appendChild(document.createTextNode(n.label)),i.appendChild(t),i}function l(n){u("menuTitle",n.title);u("menuSubTitle",n.subTitle);h(n.id);document.getElementById(n.autofocusId).focus()}function ot(t,i){let r=document.getElementById(t);for(let t of i)r.appendChild(n.Create_Menu_Element(t))}function st(){return(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1?"Opera":navigator.userAgent.indexOf("Chrome")!=-1?"Chrome":navigator.userAgent.indexOf("Safari")!=-1?"Safari":navigator.userAgent.indexOf("Firefox")!=-1?"Firefox":navigator.userAgent.indexOf("MSIE")!=-1||!!document.DOCUMENT_NODE==!0?"IE":"unknown"}function ht(n){let t="/",i=window.location.pathname.toLowerCase().indexOf(n);return i==0&&(t=n+"/"),t}function ct(n,t=[],i=[]){let r=document.createElement("div");r.classList.add("level");for(let n of n)r.appendChild(e(n));if(t.length>0){let n=document.createElement("div");n.classList.add("level-left");r.appendChild(n);for(let t of t)n.appendChild(e(t))}if(i.length>0){let n=document.createElement("div");n.classList.add("level-right");r.appendChild(n);for(let t of i)n.appendChild(e(t))}return r}function e(n){let i=document.createElement("div");i.classList.add("level-item",...n.classes);let t=document.createElement("div");if(i.appendChild(t),n.heading.length>0){let i=document.createElement("p");i.classList.add("heading");i.appendChild(document.createTextNode(n.heading));t.appendChild(i)}if(n.title_text.length>0){let i=document.createElement("p");i.classList.add("title");i.appendChild(document.createTextNode(n.title_text));t.appendChild(i)}else n.title!==null&&t.appendChild(n.title);return i}function lt(n,t,i,r=""){n!=="td"&&n!=="th"&&(n="td");let u=document.createElement(n);return r.length>0&&(u.style.width=r),t.length>0&&u.appendChild(document.createTextNode(t)),i.length>0&&u.classList.add(i),u}n.Hide=t;n.Show=r;n.Show_Inline=a;n.Show_Inline_Flex=v;n.Show_Flex=y;n.Error_Show=o;n.Simple_Error_Show=p;n.Clear_Element=i;n.Create_Option=w;n.Get_Value=s;n.Set_Value=b;n.Set_Text=u;n.Show_Menu=h;n.Handle_Tabs=k;n.Activate_Inactivate_Selector=c;n.Show_Hide_Selector=f;n.Get=d;n.Post=g;n.Post_Empty=nt;n.Format_Amount=tt;n.Format_Date=it;n.Format_DateTime=rt;n.Validate_Text=ut;n.Toggle_Loading_Button=ft;n.Create_Menu_Element=et;n.Update_Menu=l;n.Build_Menu_Elements=ot;n.CheckBrowser=st;n.Get_Path=ht;n.Create_Centered_Level=ct;n.CreateTableCell=lt})(Utilities||(Utilities={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},function(n){function f(){return __awaiter(this,void 0,void 0,function*(){yield n.Department.GetDepartments().then(t=>{n.payment_types=[];n.controls=[];n.departments=t;n.DepartmentControl=n.Department.CreateDepartmentElement(n.departments);y();for(let t of n.departments){let i=n.payment_types.map(n=>n.payment_type_id);n.payment_types=n.payment_types.concat(t.payment_types.filter(n=>i.indexOf(n.payment_type_id)===-1));let r=t.controls.map(n=>n.control_id);n.controls=n.controls.concat(t.controls.filter(n=>r.indexOf(n.control_id)===-1));t.control_groups=n.ControlGroup.CreateControlGroups(t.controls);for(let t of t.payment_types)t.control_groups=n.ControlGroup.CreateControlGroups(t.controls)}for(let t of n.payment_types){let i=n.controls.map(n=>n.control_id);n.controls=n.controls.concat(t.controls.filter(n=>i.indexOf(n.control_id)===-1))}});yield n.GetTransactionList(1)})}function e(t){return __awaiter(this,void 0,void 0,function*(){yield n.Data.TransactionData.GetSpecificTransaction(t).then(t=>{console.log("transaction to show",t),n.currentReceipt=new n.Receipt(t),n.currentReceipt.ShowReceipt(t)})})}function o(t){return __awaiter(this,void 0,void 0,function*(){yield n.Data.TransactionData.GetSpecificTransaction(t).then(t=>{console.log("transaction to show",t),n.currentReceipt=new n.Receipt(t),n.ViewReceiptDetail()})})}function r(t){return __awaiter(this,void 0,void 0,function*(){n.current_page=t;yield n.Data.TransactionData.GetTransactionList().then(t=>{n.transactions=t,n.Data.TransactionData.RenderTransactionList(),console.log("transactions",n.transactions),Utilities.Toggle_Loading_Button(n.Data.TransactionData.reload_button,!1)});yield n.Data.TransactionData.GetTransactionPageCount().then(t=>{n.page_count=t,it()})})}function s(){n.currentReceipt=new n.Receipt;let t=document.getElementById("linkReceiptInProgress");t.classList.remove("has-background-grey-light","has-text-grey");t.style.cursor="pointer";n.ViewReceiptDetail()}function h(){n.currentReceipt=new n.Receipt;n.currentReceipt=null;let t=document.getElementById("linkReceiptInProgress");t.classList.add("has-background-grey-light","has-text-grey");t.style.cursor="default"}function c(){}function l(){let n="/",t=window.location.pathname.toLowerCase().indexOf("/clayfinancial");return t==0&&(n="/clayfinancial/"),n}function a(t){let i=n.payment_types.filter(n=>n.payment_type_id===t);return i.length===1?i[0]:null}function v(t){let i=n.controls.filter(n=>n.control_id===t);return i.length===1?i[0]:null}function y(){let r=document.getElementById("departmentFilter");r.add(Utilities.Create_Option("","All Departments",!0));for(let n of n.departments)r.add(Utilities.Create_Option(n.department_id.toString(),n.name,!1));let u=document.getElementById("nameFilter");u.add(Utilities.Create_Option("mine","My Transactions",!0));u.add(Utilities.Create_Option("","All Users",!1));let t=document.getElementById("statusFilter");t.add(Utilities.Create_Option("","All Statuses",!0));t.add(Utilities.Create_Option("i","Incomplete",!1));t.add(Utilities.Create_Option("c","Completed",!1));let i=document.getElementById("typeFilter");i.add(Utilities.Create_Option("","All Types",!0));i.add(Utilities.Create_Option("R","Receipts",!1));i.add(Utilities.Create_Option("D","Deposits",!1))}function p(t){var i=t||window.event;t.keyCode==13&&(console.log("enter"),n.FilterTransactions())}function w(){n.department_id_filter=parseInt(Utilities.Get_Value("departmentFilter"));n.name_filter=Utilities.Get_Value("nameFilter");n.completed_filter=Utilities.Get_Value("statusFilter");n.transaction_type_filter=Utilities.Get_Value("typeFilter");n.transaction_number_filter=Utilities.Get_Value("transactionNumberFilter");n.modified_only_filter=document.getElementById("modifiedFilter").checked;n.GetTransactionList(1)}function b(){!1&&u()}function u(){Utilities.Hide(n.Data.TransactionData.transaction_view_container);Utilities.Show(n.Data.TransactionData.action_container);Utilities.Hide(n.Receipt.receipt_container)}function k(){Utilities.Hide(n.Data.TransactionData.transaction_view_container);Utilities.Hide(n.Data.TransactionData.action_container);Utilities.Show(n.Receipt.receipt_container)}function d(){Utilities.Show(n.Data.TransactionData.transaction_view_container);Utilities.Hide(n.Data.TransactionData.action_container);Utilities.Hide(n.Receipt.receipt_container)}function g(){Utilities.Hide(n.Data.TransactionData.transaction_view_container);Utilities.Hide(n.Data.TransactionData.action_container);Utilities.Hide(n.Receipt.receipt_container)}function nt(t){t.getAttribute("disabled")===null&&r(n.current_page-1)}function tt(t){t.getAttribute("disabled")===null&&r(n.current_page+1)}function it(){let t=document.getElementById("resultsPreviousPage"),i=document.getElementById("resultsNextPage");n.current_page===1?t.setAttribute("disabled",""):t.removeAttribute("disabled");n.page_count<=n.current_page?i.setAttribute("disabled",""):i.removeAttribute("disabled");let r=document.getElementById("resultsPaginationList");Utilities.Clear_Element(r);r.appendChild(rt())}function rt(){let u=n.current_page,f=n.page_count,r=document.createDocumentFragment();if(u<1&&(n.current_page=1),u>f&&(u=f),f<8){for(let n=1;n<=f;n++)r.appendChild(t(n,n===u));return r}if(u===3){for(let n=1;n<=4;n++)r.appendChild(t(n,n===u));r.appendChild(i());for(let n=f-1;n<=f;n++)r.appendChild(t(n,n===u));return r}if(u===f-2){for(let n=1;n<=2;n++)r.appendChild(t(n,n===u));r.appendChild(i());for(let n=f-3;n<=f;n++)r.appendChild(t(n,n===u));return r}if(u<3||u>f-3){for(let n=1;n<=3;n++)r.appendChild(t(n,n===u));r.appendChild(i());for(let n=f-2;n<=f;n++)r.appendChild(t(n,n===u));return r}r.appendChild(t(1,!1));r.appendChild(i());for(let n=u-1;n<=u+1;n++)r.appendChild(t(n,n===u));return r.appendChild(i()),r.appendChild(t(f,!1)),r}function t(t,i){let u=document.createElement("li"),r=document.createElement("a");return r.classList.add("pagination-link"),r.setAttribute("aria-label","Goto page "+t.toString()),i?(r.classList.add("is-current"),r.setAttribute("aria-current","page"),r.style.cursor="default"):r.onclick=()=>{n.GetTransactionList(t);let i=document.getElementById("transaction_list_view_header");i!==null&&i.scrollIntoView(!0)},r.appendChild(document.createTextNode(t.toString())),u.appendChild(r),u}function i(){let t=document.createElement("li"),n=document.createElement("span");return n.classList.add("pagination-ellipsis"),n.innerHTML="&hellip;",t.appendChild(n),t}function ut(n,t){let r=document.createElement("tr"),i=document.createElement("td");return i.colSpan=n,i.appendChild(document.createTextNode(t)),r.appendChild(i),r}function ft(){n.editing_control_data=null;n.editing_payment_method_data=null;document.getElementById("change_transaction").classList.add("is-active")}function et(){document.getElementById("change_transaction").classList.remove("is-active")}function ot(t,i,r){Utilities.Set_Text("change_field_label",r);n.ShowChangeModal();n.Data.ControlData.GetAndDisplayControlHistory(t,i).then(()=>{})}function st(t,i,r,u){Utilities.Set_Text("change_field_label",u);n.ShowChangeModal();n.Data.PaymentMethodData.GetAndDisplayHistory(t,r,i).then(()=>{})}function ht(){Utilities.Toggle_Loading_Button("change_transaction_save",!0);let t=Utilities.Get_Value(n.reason_for_change_input).trim();if(t.length===0){let t=document.getElementById(n.reason_for_change_input),i=document.getElementById(n.reason_for_change_input_container);n.ControlGroup.UpdateInputError(t,i,"This is required.");Utilities.Toggle_Loading_Button("change_transaction_save",!1);return}if(n.editing_control_data!==null){if(!n.editing_control_data.Validate()){Utilities.Toggle_Loading_Button("change_transaction_save",!1);return}n.editing_control_data.reason_for_change=t;n.editing_control_data.SaveControlChanges();n.GetTransactionList(n.current_page)}else{if(!n.editing_payment_method_data.Validate()){Utilities.Toggle_Loading_Button("change_transaction_save",!1);return}n.editing_payment_method_data.reason_for_change=t;n.editing_payment_method_data.SaveChanges();n.GetTransactionList(n.current_page)}}n.app_input_size="is-normal";n.error_scrolled=!1;n.departments=[];n.payment_types=[];n.controls=[];n.transactions=[];n.currentReceipt=null;n.DepartmentControl=null;n.DepartmentControlContainer=null;n.current_page=1;n.page_count=0;n.department_id_filter=-1;n.name_filter="mine";n.completed_filter="";n.transaction_type_filter="";n.modified_only_filter=!1;n.transaction_number_filter="";n.editing_control_data=null;n.editing_payment_method_data=null;n.reason_for_change_input="reason_for_change";n.reason_for_change_input_container="reason_for_change_container";n.change_edit_container="change_edit_container";n.change_transaction_history_table_header="change_transaction_history_header";n.change_transaction_history_table_body="change_transaction_history_table";n.Start=f;n.ShowReceipt=e;n.ShowReceiptDetail=o;n.GetTransactionList=r;n.NewReceipt=s;n.ResetReceipt=h;n.NewDeposit=c;n.GetPath=l;n.FindPaymentType=a;n.FindControl=v;n.SearchOnEnter=p;n.FilterTransactions=w;n.ViewReceiptInProgress=b;n.ViewReceiptDetail=u;n.ViewPrintableReceipt=k;n.ViewTransactions=d;n.ViewDeposit=g;n.PreviousPage=nt;n.NextPage=tt;n.CreateMessageRow=ut;n.ShowChangeModal=ft;n.CloseChangeModal=et;n.LoadControlDataChange=ot;n.LoadPaymentTypeDataChange=st;n.SaveChanges=ht}(Transaction||(Transaction={})),function(n){class t{constructor(n,t,i,...r){this.classes=[];this.heading="";this.title=null;this.title_text="";this.heading=n;this.title=i;t.length>0&&(this.title_text=t,this.title=null);r.length>0&&this.classes.push(...r)}}n.LevelItem=t}(Utilities||(Utilities={})),function(n){class t{constructor(){this.percent_used=0;this.controls=[]}static CreateControlGroups(i){let r=[],u=new t;for(let t of i)t.is_active&&(t.rendered_input_element=n.Control.CreateControl(t),u.controls.push(t));return r.push(u),r}static CreateSavedControlGroups(i){let r=[],u=new t;for(let t of i)t.control.rendered_input_element=n.Control.CreateSavedControl(t),u.controls.push(t.control);return r.push(u),r}static CreateInputFieldContainerByControl(n,t,i=false){return this.CreateInputFieldContainer(t,n.label,i,n.render_hints)}static CreateInputFieldContainer(t,i,r=false,u="",f=false){let o=null;if(t.getAttribute("transaction_id")!==null){let r=t.getAttribute("transaction_id"),u=t.getAttribute("control_data_id");if(u!==null)o=()=>{n.LoadControlDataChange(u,r,i)};else{let u=t.getAttribute("payment_method_data_id"),f=t.getAttribute("is_cash").toLowerCase()==="true";o=()=>{n.LoadPaymentTypeDataChange(u,f,r,i)}}}o!==null&&(t.onclick=()=>{o()});let e=document.createElement("div");e.classList.add("field");let s=document.createElement("label");if(s.classList.add("label",n.app_input_size),i.length>0?s.appendChild(document.createTextNode(i)):s.innerHTML="&nbsp;",e.appendChild(s),t.getAttribute("transaction_id")!==null){let n=document.createElement("a");n.style.marginLeft=".5em";n.style.fontSize=".75em";n.style.fontWeight="400";n.onclick=()=>{o()};n.appendChild(document.createTextNode("edit"));s.appendChild(n)}let h=document.createElement("div");if(h.classList.add("control"),h.appendChild(t),e.appendChild(h),f){let n=document.createElement("p");n.classList.add("help","guide");e.appendChild(n)}let c=document.createElement("p");if(c.classList.add("help","is-danger"),e.appendChild(c),r){let n=document.createElement("div");return n.classList.add("column"),u.length>0&&n.classList.add(u),n.appendChild(e),n}return u.length>0&&e.classList.add(u),e}static CreateButtonlistFieldContainer(t,i,r=false,u=""){let f=document.createElement("div");f.classList.add("field");let e=document.createElement("label");e.classList.add("label",n.app_input_size);i.length>0?e.appendChild(document.createTextNode(i)):e.innerHTML="&nbsp;";f.appendChild(e);let o=document.createElement("div");o.classList.add("control");let s=document.createElement("div");s.classList.add("buttons");for(let n of t)s.appendChild(n);if(o.appendChild(s),f.appendChild(o),r){let n=document.createElement("div");return n.classList.add("column"),u.length>0&&n.classList.add(u),n.appendChild(f),n}return u.length>0&&f.classList.add(u),f}static CreateSelectFieldContainerByControl(n,t,i=false){return this.CreateSelectFieldContainer(t,n.label,i,n.render_hints)}static CreateSelectFieldContainer(t,i,r=false,u=""){let f=document.createElement("div");f.classList.add("field");r&&(f.classList.add("column"),u.length>0&&f.classList.add(u));let e=document.createElement("label");if(e.classList.add("label","is-normal"),e.appendChild(document.createTextNode(i)),f.appendChild(e),t.getAttribute("transaction_id")!==null){let r=document.createElement("a");r.style.marginLeft=".5em";r.style.fontSize=".75em";r.style.fontWeight="400";let u=t.getAttribute("transaction_id"),f=t.getAttribute("control_data_id");r.onclick=()=>{n.LoadControlDataChange(f,u,i)};r.appendChild(document.createTextNode("edit"));e.appendChild(r)}let o=document.createElement("div");o.classList.add("control");let s=document.createElement("div");s.classList.add("select","is-normal");s.appendChild(t);o.appendChild(s);f.appendChild(o);let h=document.createElement("p");return h.classList.add("help","is-danger"),f.appendChild(h),f}CreateControlData(t,i=true){let u=[],r=document.createElement("div");r.classList.add("columns","is-multiline");t.appendChild(r);for(let t of this.controls){let f=new n.Data.ControlData(t,-1,i);u.push(f);r.appendChild(f.container_element)}return u}static CreateInput(n,t,i,r,u=""){let f=document.createElement("input");return f.type=n,f.onwheel=n=>{n.preventDefault()},f.maxLength=t,f.classList.add("input","is-normal"),f.type==="number"&&(f.step="0.01",f.min="0"),f.placeholder=r,f.required=i,f.value=u,f}static UpdateSelectError(t,i=""){let r=t.querySelector("p.help.is-danger"),u=t.querySelector("div.select");i.length===0?(Utilities.Clear_Element(r),u.classList.remove("is-danger")):(Utilities.Simple_Error_Show(r,i),u.classList.add("is-danger"),n.error_scrolled||(n.error_scrolled=!0,t.scrollIntoView(!0)))}static UpdateInputError(t,i,r=""){let u=i.querySelector("p.help.is-danger");r.length===0?(Utilities.Clear_Element(u),t.classList.remove("is-danger")):(Utilities.Simple_Error_Show(u,r),t.classList.add("is-danger"),n.error_scrolled||(n.error_scrolled=!0,i.scrollIntoView(!0)))}static UpdateInputGuide(n,t=""){let i=n.querySelector("p.help.guide");if(i===null){console.log("UpdateInputGuide called, no guide elements found",n,t);return}Utilities.Set_Text(i,t)}static ValidateDropdown(n,i,r){let u="";return n.value==="-1"&&(u="You must choose one of these options."),r.indexOf(n.value)===-1&&u.length===0&&(u="Please select a valid value."),t.UpdateSelectError(i,u),u.length===0}static ValidateDate(n,i){let r="";return n.valueAsDate===null&&n.required&&(r="You must selected a date."),t.UpdateInputError(n,i,r),r.length===0}static ValidateText(n,i){let r="";return n.required&&n.value.length===0&&(r="This field is required."),n.maxLength>0&&n.value.length>n.maxLength&&r.length===0&&(r="You entered "+n.value.length.toString()+" characters but "+n.maxLength.toString()+" is the maximum number of characters allowed."),t.UpdateInputError(n,i,r),r.length===0}static ValidateNumber(n,i){let r="";return n.value.length===0&&(r="You must enter a number. (No commas or $ allowed)."),n.valueAsNumber===NaN&&r.length===0&&(r="Please enter Numbers and Decimal points only."),t.UpdateInputError(n,i,r),r.length===0}static ValidateCount(n,i){let r="";return n.value.length===0&&n.required&&(r="You must enter a number. (No commas, decimal points, or $ allowed)."),n.valueAsNumber===NaN&&r.length===0&&(r="Please enter Numbers only."),n.valueAsNumber<0&&(r="This value must be 0 or greater."),t.UpdateInputError(n,i,r),r.length===0}static ValidateMoney(n,i){let r="";n.value.length===0&&(r="You must enter a number. (No commas or $ allowed).");n.valueAsNumber===NaN&&r.length===0&&(r="Please enter Numbers and Decimal points only.");n.valueAsNumber<0&&r.length===0&&(r="Negative numbers are not allowed.");let u=n.value.split(".");return u.length===2&&r.length===0&&u[1].length>2&&(r="Too many digits after the decimal place. Amounts are limited to 2 digits after the decimal place."),t.UpdateInputError(n,i,r),r.length===0}}n.ControlGroup=t}(Transaction||(Transaction={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},function(n){var t;(function(t){class i{constructor(n,t=false,i,r,u=null){this.payment_method_data_id=-1;this.prior_payment_method_data_id=-1;this.transaction_payment_type_id=-1;this.transaction_id=-1;this.cash_amount=0;this.check_amount=0;this.check_count=0;this.check_number="";this.check_from="";this.paying_for="";this.is_active=!0;this.added_after_save=!1;this.modified_by="";this.modified_on=new Date;this.reason_for_change="";this.error_text="";this.is_cash=!1;this.show_cancel=!1;this.cash_amount_input_element=null;this.cash_amount_input_element_container=null;this.check_amount_input_element=null;this.check_amount_input_element_container=null;this.check_count_input_element=null;this.check_count_input_element_container=null;this.check_number_input_element=null;this.check_number_input_element_container=null;this.paying_for_input_element=null;this.paying_for_input_element_container=null;this.check_from_input_element=null;this.check_from_input_element_container=null;this.add_check_button_element=null;this.cancel_check_button_element=null;this.check_buttons_container_element=null;this.payment_method_change=()=>{};this.validate_money_regex="(?=.*?d)^$?(([1-9]d{0,2}(,d{3})*)|d+)?(.d{1,2})?$";this.control_to_render=null;this.is_cash=n;this.show_cancel=t;this.payment_method_data_id=i;this.payment_method_change=r;n?this.RenderCashControls(u):this.RenderCheckControls(u)}Validate(){return this.is_cash?this.ValidateCash():this.ValidateCheck()}ValidateCash(){return n.ControlGroup.ValidateMoney(this.cash_amount_input_element,this.cash_amount_input_element_container)}ValidateCheck(){let t=!0,n=this.ValidateCheckAmount();return!n&&t&&(t=n),n=this.ValidateCheckCount(),!n&&t&&(t=n),n=this.ValidateCheckNumber(),!n&&t&&(t=n),n=this.ValidateCheckFrom(),!n&&t&&(t=n),n=this.ValidatePayingFor(),!n&&t&&(t=n),t}ValidateCheckAmount(){return n.ControlGroup.ValidateMoney(this.check_amount_input_element,this.check_amount_input_element_container)}ValidateCheckCount(){return n.ControlGroup.ValidateCount(this.check_count_input_element,this.check_count_input_element_container)}ValidateCheckNumber(){let i=this.check_number_input_element,t="";return i.value.length>0&&this.check_amount===0&&(t="This field should only be used if a check is entered."),i.value.length===0&&this.check_amount>0&&this.check_count===1&&(t="A check number is required when you enter a check amount and set the check count to 1 check."),i.value.length>50&&(t="The check number can be at most 50 characters long."),n.ControlGroup.UpdateInputError(this.check_number_input_element,this.check_number_input_element_container,t),t.length===0}ValidatePayingFor(){let i=this.paying_for_input_element,t="";return i.value.length>0&&this.check_amount===0&&(t="This field should only be used if a check amount is entered."),i.value.length>500&&(t="This field can be at most 500 characters long."),n.ControlGroup.UpdateInputError(this.paying_for_input_element,this.paying_for_input_element_container,t),t.length===0}ValidateCheckFrom(){let i=this.check_from_input_element,t="";return i.value.length>0&&this.check_amount===0&&(t="This field should only be used if a check amount is entered."),i.value.length===0&&this.check_amount>0&&this.check_count===1&&(t="This field is required if you enter a check amount and set the check count to 1 check."),i.value.length>500&&(t="This field can be at most 500 characters long."),n.ControlGroup.UpdateInputError(this.check_from_input_element,this.check_from_input_element_container,t),t.length===0}RenderCashControls(t){let i=document.createElement("div");i.classList.add("columns");this.cash_amount_input_element=n.ControlGroup.CreateInput("number",15,!0,"0");t===null?this.cash_amount_input_element.oninput=()=>{this.cash_amount=0,this.ValidateCash()&&(this.cash_amount=this.cash_amount_input_element.valueAsNumber),this.payment_method_change()}:(this.cash_amount_input_element.value=t.cash_amount.toString(),this.cash_amount_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.cash_amount_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.cash_amount_input_element.setAttribute("is_cash","true"));this.cash_amount_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.cash_amount_input_element,"Cash Amount",!0,"is-one-quarter");i.appendChild(this.cash_amount_input_element_container);this.control_to_render=i}RenderCheckControls(t){let i=document.createElement("div");if(i.classList.add("columns","is-multiline","check"),this.check_amount_input_element=n.ControlGroup.CreateInput("number",15,!1,"0"),t===null?this.check_amount_input_element.oninput=()=>{this.check_amount=0,this.ValidateCheckAmount()&&(this.check_amount=this.check_amount_input_element.valueAsNumber,this.check_amount>0?(Utilities.Show_Flex(this.check_buttons_container_element),this.check_count_input_element.required=!0):(Utilities.Hide(this.check_buttons_container_element),this.check_count_input_element.required=!1)),this.payment_method_change()}:(this.check_amount_input_element.readOnly=!0,this.check_amount_input_element.value=t.check_amount.toString(),this.check_amount_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_amount_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_amount_input_element.setAttribute("is_cash","false")),this.check_count_input_element=n.ControlGroup.CreateInput("number",5,!1,"# of Checks"),this.check_count_input_element.step="1",this.check_count_input_element.min="0",t===null?this.check_count_input_element.oninput=t=>{if(this.ValidateCheckCount())if(this.check_count=t.target.valueAsNumber,this.check_amount>0)switch(this.check_count){case 0:n.ControlGroup.UpdateInputGuide(this.check_count_input_element_container,"Partial Check");break;case 1:n.ControlGroup.UpdateInputGuide(this.check_count_input_element_container,"Single Check");break;default:n.ControlGroup.UpdateInputGuide(this.check_count_input_element_container,"Bulk Check")}else n.ControlGroup.UpdateInputGuide(this.check_count_input_element_container,"");else n.ControlGroup.UpdateInputGuide(this.check_count_input_element_container,"");this.payment_method_change()}:(this.check_count_input_element.readOnly=!0,this.check_count_input_element.value=t.check_count.toString(),this.check_count_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_count_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_count_input_element.setAttribute("is_cash","false")),this.check_number_input_element=n.ControlGroup.CreateInput("text",50,!1,"Check Number"),t===null?this.check_number_input_element.oninput=n=>{this.ValidateCheckNumber()&&(this.check_number=n.target.value)}:(this.check_number_input_element.readOnly=!0,this.check_number_input_element.value=t.check_number,this.check_number_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_number_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_number_input_element.setAttribute("is_cash","false")),this.paying_for_input_element=n.ControlGroup.CreateInput("text",500,!1,"Check Paying For"),t===null?this.paying_for_input_element.oninput=n=>{this.ValidatePayingFor()&&(this.paying_for=n.target.value)}:(this.paying_for_input_element.readOnly=!0,this.paying_for_input_element.value=t.paying_for,this.paying_for_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.paying_for_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.paying_for_input_element.setAttribute("is_cash","false")),this.check_from_input_element=n.ControlGroup.CreateInput("text",500,!1,"Check From"),t===null?this.check_from_input_element.oninput=n=>{this.ValidateCheckFrom()&&(this.check_from=n.target.value)}:(this.check_from_input_element.readOnly=!0,this.check_from_input_element.value=t.check_from,this.check_from_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_from_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_from_input_element.setAttribute("is_cash","false")),this.add_check_button_element=document.createElement("button"),this.add_check_button_element.classList.add("button","is-info",n.app_input_size),this.add_check_button_element.appendChild(document.createTextNode("Add Another Check")),this.check_amount_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_amount_input_element,"Check Amount",!0,"is-one-quarter"),i.appendChild(this.check_amount_input_element_container),this.check_count_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_count_input_element,"# of Checks",!0,"is-2",!0),i.appendChild(this.check_count_input_element_container),this.check_number_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_number_input_element,"Check Number",!0,"is-one-quarter"),i.appendChild(this.check_number_input_element_container),this.show_cancel){let t=[];this.cancel_check_button_element=document.createElement("button");this.cancel_check_button_element.classList.add("button","is-warning",n.app_input_size);this.cancel_check_button_element.appendChild(document.createTextNode("Cancel Check"));t.push(this.add_check_button_element);t.push(this.cancel_check_button_element);this.check_buttons_container_element=n.ControlGroup.CreateButtonlistFieldContainer(t,"",!0,"is-one-half")}else this.check_buttons_container_element=n.ControlGroup.CreateInputFieldContainer(this.add_check_button_element,"",!0,"is-one-half"),this.check_buttons_container_element.classList.add("hide");i.appendChild(this.check_buttons_container_element);this.paying_for_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.paying_for_input_element,"Paying For",!0,"is-half");i.appendChild(this.paying_for_input_element_container);this.check_from_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_from_input_element,"Check From",!0,"is-half");i.appendChild(this.check_from_input_element_container);this.control_to_render=i}static GetHistory(t,i){let r=n.GetPath();return Utilities.Get(r+"API/Transaction/GetPaymentMethodHistory?payment_method_data_id="+t+"&transaction_id="+i)}SaveChanges(){let t=n.GetPath();Utilities.Post(t+"API/Transaction/EditPaymentMethod",this).then(t=>{t.length>0?alert("There was a problem saving this change.\r\n"+t):(n.CloseChangeModal(),n.ShowReceiptDetail(this.transaction_id),n.editing_control_data=null,n.editing_payment_method_data=null),Utilities.Toggle_Loading_Button("change_transaction_save",!1)})}static GetAndDisplayHistory(n,t,r){return __awaiter(this,void 0,void 0,function*(){yield i.GetHistory(n,t).then(n=>{i.MarkDataToEdit(n,r),i.DisplayHistory(n,r),i.DisplayEdit()})})}static MarkDataToEdit(i,r){n.editing_control_data=null;n.editing_payment_method_data=null;let u=i.filter(n=>n.is_active);if(u.length===1){let f=u[0],i=new t.PaymentMethodData(r,!1,f.payment_method_data_id,()=>{});i.payment_method_data_id=f.payment_method_data_id;i.transaction_id=f.transaction_id;i.transaction_payment_type_id=f.transaction_payment_type_id;i.prior_payment_method_data_id=f.prior_payment_method_data_id;i.is_active=!0;r?(i.cash_amount=f.cash_amount,i.cash_amount_input_element.valueAsNumber=f.cash_amount):(i.check_amount=f.check_amount,i.check_amount_input_element.valueAsNumber=f.check_amount,i.check_count=f.check_count,i.check_count_input_element.valueAsNumber=f.check_count,i.check_from=f.check_from,i.check_from_input_element.value=f.check_from,i.check_number=f.check_number,i.check_number_input_element.value=f.check_number,i.paying_for=f.paying_for,i.paying_for_input_element.value=f.paying_for);n.editing_payment_method_data=i}else alert("Invalid data stored in database for this transaction.")}static DisplayEdit(){if(n.editing_payment_method_data!==null){let t=document.getElementById(n.change_edit_container);Utilities.Clear_Element(t);t.classList.remove("columns");let i=n.editing_payment_method_data;Utilities.Clear_Element(i.check_buttons_container_element);t.appendChild(i.control_to_render);Utilities.Set_Value(n.reason_for_change_input,"")}}static CreateCashHistoryHeader(){let n=document.createElement("tr");return n.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","20%")),n.appendChild(Utilities.CreateTableCell("th","Cash Amount","has-text-right","15%")),n.appendChild(Utilities.CreateTableCell("th","","","35%")),n}static CreateCheckHistoryHeader(){let n=document.createElement("tr");return n.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","10%")),n.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","15%")),n.appendChild(Utilities.CreateTableCell("th","Check Amount","has-text-right","15%")),n.appendChild(Utilities.CreateTableCell("th","Check Count","has-text-centered","10%")),n.appendChild(Utilities.CreateTableCell("th","Check #","has-text-left","10%")),n.appendChild(Utilities.CreateTableCell("th","Check From","has-text-left","10%")),n.appendChild(Utilities.CreateTableCell("th","Paying For","has-text-left","15%")),n}static DisplayHistory(t,r){let u=document.getElementById(n.change_transaction_history_table_header);Utilities.Clear_Element(u);r?u.appendChild(i.CreateCashHistoryHeader()):u.appendChild(i.CreateCheckHistoryHeader());let f=document.getElementById(n.change_transaction_history_table_body);Utilities.Clear_Element(f);for(let n of t)r?f.appendChild(i.CreateCashHistoryRow(n)):f.appendChild(i.CreateCheckHistoryRow(n))}static CreateCashHistoryRow(n){let t=document.createElement("tr");if(new Date(n.modified_on).getFullYear()<1e3){let n=Utilities.CreateTableCell("td","Original Value","has-text-centered");n.colSpan=3;t.appendChild(n)}else t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(n.modified_on),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.modified_by,"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.reason_for_change,"has-text-left"));return t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.cash_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td","","","35%")),t}static CreateCheckHistoryRow(n){let t=document.createElement("tr");if(new Date(n.modified_on).getFullYear()<1e3){let n=Utilities.CreateTableCell("td","Original Value","has-text-centered");n.colSpan=3;t.appendChild(n)}else t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(n.modified_on),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.modified_by,"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.reason_for_change,"has-text-left"));return t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.check_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",n.check_count.toString(),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.check_number,"has-text-left")),t.appendChild(Utilities.CreateTableCell("td",n.check_from,"has-text-left")),t.appendChild(Utilities.CreateTableCell("td",n.paying_for,"has-text-left")),t}}t.PaymentMethodData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={})),function(n){class t{constructor(){this.control_groups=[]}Constructor(){}}n.PaymentType=t}(Transaction||(Transaction={})),function(n){class t{constructor(){this.rendered_input_element=null;this.valid_values=[]}Constructor(){}static CreateControl(n,i=null){switch(n.data_type){case"date":case"text":return t.CreateInput(n,i);case"number":case"money":case"count":return t.CreateNumericInput(n,i);case"bigtext":return t.CreateTextArea(n,i);case"dropdown":return t.CreateSelect(n,i)}return null}static CreateSavedControl(n){let i=t.CreateControl(n.control,n.value);return i.tagName.toLowerCase()!=="select"?i.readOnly=!0:i.disabled=!0,i.setAttribute("control_data_id",n.control_data_id.toString()),i.setAttribute("transaction_id",n.transaction_id.toString()),i}static CreateInput(t,i){let r=document.createElement("input");if(r.type=t.data_type,r.maxLength=t.max_length,r.classList.add("input",n.app_input_size),r.placeholder=t.label,r.required=t.required,r.type==="date"&&i!==null){let n=i.split("/");if(n.length===3){let t=n[2]+"-";t+=n[0].length===1?"0"+n[0]:n[0];t+="-";t+=n[1].length===1?"0"+n[1]:n[1];r.value=t}else r.value=i}else r.value=i===null?"":i;return r.setAttribute("control_id",t.control_id.toString()),r}static CreateNumericInput(t,i){let r=document.createElement("input");return r.type="number",r.maxLength=t.max_length,r.classList.add("input",n.app_input_size),r.placeholder="0",r.required=t.required,t.data_type==="count"?(r.step="1",r.min="0",r.pattern="[0-9]"):r.step="any",r.value=i===null?"":i,r.setAttribute("control_id",t.control_id.toString()),r}static CreateTextArea(t,i){let r=document.createElement("textarea");return r.maxLength=t.max_length,r.classList.add("textarea",n.app_input_size),r.placeholder=t.label,r.required=t.required,r.rows=4,r.value=i===null?"":i,r.setAttribute("control_id",t.control_id.toString()),r}static CreateSelect(n,t){n.valid_values=n.value.split("|");let i=document.createElement("select");i.required=n.required;i.appendChild(Utilities.Create_Option("-1","Select a "+n.label,!1));for(let n of n.valid_values){let t=Utilities.Create_Option(n,n,!1);i.appendChild(t)}return i.value=t!==null?t:"-1",i}}n.Control=t}(Transaction||(Transaction={})),function(n){class t{constructor(){this.organization="";this.payment_types=[];this.controls=[];this.control_groups=[]}Constructor(){}static GetDepartments(){let t=n.GetPath();return Utilities.Get(t+"API/Transaction/Departments")}static CreateDepartmentElement(n){let t=document.createElement("select"),i=document.createElement("option");i.selected=!0;i.value="-1";i.appendChild(document.createTextNode("Select a Department"));t.appendChild(i);for(let n of n)if(n.is_active){let i=document.createElement("option");i.appendChild(document.createTextNode(n.name));i.value=n.department_id.toString();t.appendChild(i)}return t.selectedIndex=-1,t}static CreateDepartmentElementLevel(n){let t=document.createElement("div");t.classList.add("level");let i=document.createElement("div");i.classList.add("level-left");let r=document.createElement("div");r.classList.add("level-item","has-text-centered");let u=document.createElement("div"),f=document.createElement("p");f.classList.add("heading");f.appendChild(document.createTextNode("Select Department"));let e=document.createElement("div");return e.classList.add("select"),e.appendChild(n),u.appendChild(f),u.appendChild(e),r.appendChild(u),i.appendChild(r),t.appendChild(i),t}static CreateDepartmentElementField(t){return n.ControlGroup.CreateSelectFieldContainer(t,"Department",!0,"is-one-half")}static FindDepartment(t){let i=n.departments.filter(n=>n.department_id===t);return i.length===1?i[0]:null}}n.Department=t}(Transaction||(Transaction={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},function(n){var t;(function(t){class i{constructor(t,i,r){this.control_data_id=-1;this.prior_control_data_id=-1;this.transaction_payment_type_id=-1;this.department_id=-1;this.transaction_id=-1;this.control_id=-1;this.control=null;this.payment_type_id=-1;this.payment_type_index=-1;this.value="";this.is_active=!0;this.modified_on=new Date;this.modified_by="";this.reason_for_change="";this.error_text="";this.selected_control=null;this.input_element=null;this.container_element=null;let u=t.rendered_input_element?t.rendered_input_element.getAttribute("control_data_id"):null;if(this.selected_control=t,this.control_id=t.control_id,this.input_element=r?t.rendered_input_element.cloneNode(!0):t.rendered_input_element?t.rendered_input_element:n.Control.CreateControl(t),this.payment_type_id=i,u===null){let n=this.input_element;n.type==="number"&&(n.onwheel=n=>{n.preventDefault()});this.input_element.oninput=n=>{let i=n.target;if(this.Validate())switch(t.data_type){case"date":let n=i.valueAsDate;n.setMinutes(n.getTimezoneOffset());this.value=Utilities.Format_Date(n);break;case"number":this.value=i.valueAsNumber.toString();break;case"count":this.value=i.valueAsNumber.toString();i.value=i.valueAsNumber.toString();break;case"money":this.value=i.valueAsNumber.toString();break;default:this.value=i.value}}}this.container_element=t.data_type==="dropdown"?n.ControlGroup.CreateSelectFieldContainerByControl(t,this.input_element,!0):n.ControlGroup.CreateInputFieldContainerByControl(t,this.input_element,!0)}Validate(){switch(this.selected_control.data_type){case"dropdown":return this.ValidateDropdown();case"count":return this.ValidateCount();case"date":return this.ValidateDate();case"number":return this.ValidateNumber();case"money":return this.ValidateMoney();case"text":case"bigtext":return this.ValidateText();default:return!1}}ValidateDropdown(){return n.ControlGroup.ValidateDropdown(this.input_element,this.container_element,this.selected_control.valid_values)}ValidateDate(){return n.ControlGroup.ValidateDate(this.input_element,this.container_element)}ValidateText(){return n.ControlGroup.ValidateText(this.input_element,this.container_element)}ValidateNumber(){return n.ControlGroup.ValidateNumber(this.input_element,this.container_element)}ValidateCount(){return n.ControlGroup.ValidateCount(this.input_element,this.container_element)}ValidateMoney(){return n.ControlGroup.ValidateMoney(this.input_element,this.container_element)}static GetControlHistory(t,i){let r=n.GetPath();return Utilities.Get(r+"API/Transaction/GetControlDataHistory?control_data_id="+t+"&transaction_id="+i)}SaveControlChanges(){let t=n.GetPath();console.log("saving this control data",this);Utilities.Post(t+"API/Transaction/EditControls",this).then(t=>{t.length>0?alert("There was a problem saving this change.\r\n"+t):(n.CloseChangeModal(),n.ShowReceiptDetail(this.transaction_id),n.editing_control_data=null),Utilities.Toggle_Loading_Button("change_transaction_save",!1)})}static GetAndDisplayControlHistory(n,t){return __awaiter(this,void 0,void 0,function*(){yield i.GetControlHistory(n,t).then(n=>{i.MarkDataToEdit(n),i.DisplayControlHistory(n),i.DisplayControlToEdit()})})}static MarkDataToEdit(i){n.editing_control_data=null;n.editing_payment_method_data=null;let r=i.filter(n=>n.is_active);if(r.length===1){let i=r[0],u=new t.ControlData(i.control,i.payment_type_id,!1);u.transaction_payment_type_id=i.transaction_payment_type_id;u.department_id=i.department_id;u.is_active=i.is_active;u.control_data_id=i.control_data_id;u.transaction_id=i.transaction_id;u.value=i.value;switch(i.control.data_type){case"date":if(i.value!==""&&i.value!==null){let n=i.value.split("/");if(n.length===3){let t=n[2]+"-";t+=n[0].length===1?"0"+n[0]:n[0];t+="-";t+=n[1].length===1?"0"+n[1]:n[1];u.input_element.value=t}}break;default:u.input_element.value=i.value}u.control=u.selected_control;n.editing_control_data=u}else alert("Invalid data stored in database for this transaction.")}static DisplayControlToEdit(){if(n.editing_control_data!==null){let t=document.getElementById(n.change_edit_container);Utilities.Clear_Element(t);t.classList.add("columns");let i=n.editing_control_data;t.appendChild(i.container_element);Utilities.Set_Value(n.reason_for_change_input,"")}}static CreateControlDataHistoryHeader(){let n=document.createElement("tr");return n.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","20%")),n.appendChild(Utilities.CreateTableCell("th","Value","has-text-left","50%")),n}static DisplayControlHistory(t){let r=document.getElementById(n.change_transaction_history_table_header);Utilities.Clear_Element(r);r.appendChild(i.CreateControlDataHistoryHeader());let u=document.getElementById(n.change_transaction_history_table_body);Utilities.Clear_Element(u);for(let n of t)u.appendChild(i.CreateControlDataHistoryRow(n))}static CreateControlDataHistoryRow(n){let t=document.createElement("tr");if(new Date(n.modified_on).getFullYear()<1e3){let n=Utilities.CreateTableCell("td","Original Value","has-text-centered");n.colSpan=3;t.appendChild(n)}else t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(n.modified_on),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.modified_by,"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.reason_for_change,"has-text-left"));return t.appendChild(Utilities.CreateTableCell("td",n.value,"has-text-left")),t}}t.ControlData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={})),function(n){var t;(function(t){class i{constructor(n,t,i,r=null){this.transaction_payment_type_id=-1;this.transaction_id=-1;this.payment_type_id=-1;this.payment_type_index=-1;this.payment_type=null;this.control_data=[];this.added_after_save=!1;this.error_text="";this.payment_method_data=[];this.payment_type_parent_container=null;this.payment_type_container=null;this.selected_payment_type=null;this.cancel_payment_type_button=null;this.add_another_payment_type_button=null;this.save_button=null;this.control_groups=[];this.total_cash_element=null;this.total_checks_element=null;this.total_number_checks_element=null;this.next_payment_method_id=0;this.selected_payment_type=n;this.payment_type_parent_container=t;this.payment_type_id=n.payment_type_id;this.payment_type_index=r!==null?r.payment_type_index:i;let u=document.createElement("li");u.style.display="block";this.payment_type_container=u;r!==null?(this.transaction_payment_type_id=r.transaction_payment_type_id,this.RenderSavedPaymentTypeControls(u,r),this.RenderSavedPaymentMethods(u,r)):(this.RenderPaymentTypeControls(u),this.RenderPaymentMethods(u));this.RenderPaymentTypeFooter(u);r!==null&&this.SavedPaymentMethodDataCalculateTotals(r.payment_method_data);this.payment_type_parent_container.appendChild(u)}Validate(){let n=!0;for(let t of this.control_data){let i=t.Validate();!i&&n&&(n=!1)}for(let t of this.payment_method_data){let i=t.Validate();!i&&n&&(n=!1)}return n}RenderPaymentTypeControls(n){for(let t of this.selected_payment_type.control_groups)this.control_data.push(...t.CreateControlData(n))}CreateHeaderButton(n,...t){let i=document.createElement("button");return i.appendChild(document.createTextNode(n)),i.classList.add("button",...t),i}RenderPaymentTypeFooter(n){let i=[];this.total_cash_element=document.createElement("span");this.total_cash_element.classList.add("title");this.total_cash_element.appendChild(document.createTextNode("$0.00"));this.total_checks_element=document.createElement("span");this.total_checks_element.classList.add("title");this.total_checks_element.appendChild(document.createTextNode("$0.00"));this.total_number_checks_element=document.createElement("span");this.total_number_checks_element.classList.add("title");this.total_number_checks_element.appendChild(document.createTextNode("0"));i.push(new Utilities.LevelItem("Total Cash","",this.total_cash_element,"has-text-centered"));i.push(new Utilities.LevelItem("Total Checks","",this.total_checks_element,"has-text-centered"));i.push(new Utilities.LevelItem("# Checks","",this.total_number_checks_element,"has-text-centered"));this.add_another_payment_type_button=this.CreateHeaderButton("Add","is-info");this.cancel_payment_type_button=this.CreateHeaderButton("Cancel","is-warning");this.save_button=this.CreateHeaderButton("Preview & Save","is-success");let t=document.createElement("div");t.classList.add("buttons");t.appendChild(this.add_another_payment_type_button);t.appendChild(this.cancel_payment_type_button);t.appendChild(this.save_button);let r=[];r.push(new Utilities.LevelItem("","",t,"has-text-centered"));let u=Utilities.Create_Centered_Level(i,[],r);u.classList.add("has-background-grey-lighter");n.appendChild(u)}RenderPaymentMethods(n){let t=document.createElement("fieldset"),i=document.createElement("legend");i.classList.add("label");i.appendChild(document.createTextNode("Payment Methods"));t.appendChild(i);this.AddCashPaymentMethod(t);this.AddCheckPaymentMethod(t);n.appendChild(t)}AddCheckPaymentMethod(n,i=false){let r=new t.PaymentMethodData(!1,i,this.next_payment_method_id++,()=>{this.PaymentMethodDataChanged()});n.appendChild(r.control_to_render);this.payment_method_data.push(r);r.add_check_button_element.onclick=()=>{this.AddCheckPaymentMethod(n,!0)};i&&(r.cancel_check_button_element.onclick=()=>{n.removeChild(r.control_to_render);let t=this.payment_method_data.findIndex(function(n){return n.payment_method_data_id===r.payment_method_data_id});t>-1&&this.payment_method_data.splice(t,1);r=null;this.PaymentMethodDataChanged()})}AddCashPaymentMethod(n){let i=new t.PaymentMethodData(!0,!1,this.next_payment_method_id++,()=>{this.PaymentMethodDataChanged()});n.appendChild(i.control_to_render);this.payment_method_data.push(i)}PaymentMethodDataChanged(){let n=0,t=0,i=0;for(let r of this.payment_method_data)n+=r.cash_amount,t+=r.check_amount,i+=r.check_count;this.total_cash_element.innerHTML=Utilities.Format_Amount(n);this.total_checks_element.innerHTML=Utilities.Format_Amount(t);this.total_number_checks_element.innerHTML=i.toString()}SavedPaymentMethodDataCalculateTotals(n){let t=0,i=0,r=0;for(let n of n)t+=n.cash_amount,i+=n.check_amount,r+=n.check_count;this.total_cash_element.innerHTML=Utilities.Format_Amount(t);this.total_checks_element.innerHTML=Utilities.Format_Amount(i);this.total_number_checks_element.innerHTML=r.toString()}RenderSavedPaymentTypeControls(t,i){this.control_groups=n.ControlGroup.CreateSavedControlGroups(i.control_data);for(let n of this.control_groups)this.control_data.push(...n.CreateControlData(t,!1))}RenderSavedPaymentMethods(n,t){let i=document.createElement("fieldset"),r=document.createElement("legend");r.classList.add("label");r.appendChild(document.createTextNode("Payment Methods"));i.appendChild(r);let u=null,f=[],e=[...t.payment_method_data];e.sort((n,t)=>t.cash_amount-n.cash_amount);do{let n=e.shift();n.check_amount>0||n.check_number.length>0||n.check_count>0||n.check_from.length>0||n.paying_for.length>0?f.push(n):n.cash_amount>0||u===null?u=n:f.push(n)}while(e.length>0);this.AddSavedCashPaymentMethod(i,u);for(let n of f)this.AddSavedCheckPaymentMethod(i,n);n.appendChild(i)}AddSavedCheckPaymentMethod(n,i){let r=new t.PaymentMethodData(!1,!1,this.next_payment_method_id++,null,i);n.appendChild(r.control_to_render);this.payment_method_data.push(r);r.add_check_button_element.onclick=()=>{this.AddCheckPaymentMethod(n,!0)}}AddSavedCashPaymentMethod(n,i){let r=new t.PaymentMethodData(!0,!1,this.next_payment_method_id++,null,i);n.appendChild(r.control_to_render);this.payment_method_data.push(r)}}t.PaymentTypeData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={})),function(n){class t{constructor(i=null){this.currentTransaction=null;this.savedTransaction=null;this.view_container=null;this.receipt_number_element=null;this.county_manager_element=null;this.created_by_element=null;this.created_on_element=null;this.receipt_view_contents_element=null;this.receipt_view_totals_element=null;this.receipt_preview_controls_element=null;this.receipt_preview_cancel_button_element=null;this.receipt_preview_save_button_element=null;this.view_container=document.getElementById(t.receipt_container);this.receipt_number_element=document.getElementById("receipt_view_number");this.created_by_element=document.getElementById("receipt_created_by");this.county_manager_element=document.getElementById("receipt_view_county_manager");this.created_on_element=document.getElementById("receipt_view_date");this.receipt_view_contents_element=document.getElementById("receipt_view_contents");this.receipt_view_totals_element=document.getElementById("receipt_view_totals");this.currentTransaction=new n.Data.TransactionData("R",i);this.receipt_preview_controls_element=document.getElementById("receipt_preview_controls");this.receipt_preview_cancel_button_element=document.getElementById("receipt_view_cancel");this.receipt_preview_save_button_element=document.getElementById("receipt_view_save");this.receipt_preview_cancel_button_element.onclick=()=>{n.ViewReceiptDetail()};this.receipt_preview_save_button_element.onclick=()=>{this.currentTransaction.SaveTransactionData()}}ShowReceiptPreview(){let n=this.currentTransaction;this.UpdateReceipt(n);Utilities.Show(this.receipt_preview_controls_element)}ShowReceipt(n){this.UpdateReceipt(n);Utilities.Hide(this.receipt_preview_controls_element)}UpdateReceipt(t){n.ViewPrintableReceipt();Utilities.Set_Text(this.created_on_element,Utilities.Format_Date(t.created_on));Utilities.Set_Text(this.receipt_number_element,t.transaction_number);Utilities.Set_Text(this.created_by_element,t.created_by_display_name);Utilities.Set_Text(this.county_manager_element,t.county_manager_name);this.DisplayDepartmentControls(t);this.CreatePaymentTypeDisplay(t)}CreatePaymentTypeDisplay(n){Utilities.Clear_Element(this.receipt_view_contents_element);Utilities.Clear_Element(this.receipt_view_totals_element);let t=0,i=0,r=0;for(let n of n.payment_type_data){let u=0,f=0,e=0;for(let n of n.payment_method_data)f+=n.cash_amount,u+=n.check_amount,e+=n.check_count;this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeRow(n.selected_payment_type!==undefined?n.selected_payment_type.name:n.payment_type.name,f,u,e));t+=u;i+=f;r+=e}this.receipt_view_totals_element.appendChild(this.CreatePaymentTypeRow("Grand Total",i,t,r))}CreatePaymentTypeRow(n,t,i,r){let u=document.createElement("tr");return u.appendChild(Utilities.CreateTableCell("td",n,"has-text-left")),u.appendChild(Utilities.CreateTableCell("td",r.toString(),"has-text-right")),u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(i),"has-text-right")),u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t),"has-text-right")),u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t+i),"has-text-right")),u}DisplayDepartmentControls(n){let i=document.getElementById("receipt_department_controls");Utilities.Clear_Element(i);let t=document.createDocumentFragment();t.appendChild(this.CreatePrintableControl("is-half","Received From",n.received_from));t.appendChild(this.CreatePrintableControl("is-half","Department",n.department_name));for(let n of n.department_control_data)t.appendChild(this.CreateDepartmentControl(n));i.appendChild(t)}CreateDepartmentControl(n){let i="";console.log("create departmental control",n);let t=n.control!==null?n.control:n.selected_control;return t.render_hints.length>0&&(i=t.render_hints),this.CreatePrintableControl(i,t.label,n.value)}CreatePrintableControl(t,i,r){let u=document.createElement("div");u.classList.add("field","column",t);let e=document.createElement("label");e.classList.add("label",n.app_input_size);e.appendChild(document.createTextNode(i));u.appendChild(e);let o=document.createElement("p");o.classList.add("control");u.appendChild(o);let f=document.createElement("input");return f.classList.add("input","is-static",n.app_input_size),f.value=r,f.readOnly=!0,o.appendChild(f),u}}t.receipt_container="receipt_view";n.Receipt=t}(Transaction||(Transaction={})),function(n){var t;(function(t){class i{constructor(t,r){this.transaction_id=-1;this.fiscal_year=-1;this.created_by_employee_id=-1;this.employee_transaction_count=-1;this.transaction_number="PREVIEW";this.transaction_type="";this.child_transaction_id=-1;this.department_id=-1;this.department_name="";this.department_control_data=[];this.payment_type_data=[];this.county_manager_name="PREVIEW";this.error_text="";this.received_from="";this.total_cash_amount=-1;this.total_check_amount=-1;this.total_check_count=-1;this.created_on=new Date;this.created_by_username="";this.created_by_ip_address="";this.created_by_display_name="PREVIEW";this.department_element=null;this.department_element_container=null;this.received_from_element=null;this.received_from_element_container=null;this.department_controls_target="department_controls_container";this.payment_type_target="payment_type_container";this.transaction_error_element=null;this.selected_department=null;this.next_payment_type_index=0;this.transaction_type=t;r!==null&&(this.transaction_id=r.transaction_id,this.transaction_number=r.transaction_number);let f=document.getElementById(i.action_container);Utilities.Clear_Element(f);this.CreateReceiptTitle(f,r);let u=document.createElement("div");u.id="transaction_controls";u.classList.add("columns");f.appendChild(u);this.department_element=n.DepartmentControl.cloneNode(!0);this.RenderDepartmentSelection(u,r);this.RenderReceivedFromInput(u,r);this.transaction_error_element=this.CreateTransactionErrorElement();f.appendChild(this.transaction_error_element)}CreateTransactionErrorElement(){return document.createElement("div")}CreateReceiptTitle(n,t){let i=document.createElement("h2");i.classList.add("title","has-text-centered");let r=t!==null?"Viewing Transaction: "+t.transaction_number:"Create a New Receipt";i.appendChild(document.createTextNode(r));n.appendChild(i)}RenderDepartmentSelection(t,i){i===null?this.department_element.onchange=t=>{this.department_id=parseInt(t.target.value),this.selected_department=n.Department.FindDepartment(this.department_id),this.RenderDepartmentControls(),this.RenderPaymentTypes()}:(this.department_id=i.department_id,this.selected_department=n.Department.FindDepartment(this.department_id),this.RenderSavedDepartmentControls(i),this.RenderSavedPaymentTypes(i),this.department_element.value=i.department_id.toString(),this.department_element.disabled=!0);this.department_element_container=n.Department.CreateDepartmentElementField(this.department_element);t.appendChild(this.department_element_container)}RenderDepartmentControls(){this.department_control_data=[];let n=document.getElementById(this.department_controls_target);if(n===null&&(n=document.createElement("div"),n.id=this.department_controls_target,document.getElementById(i.action_container).appendChild(n)),Utilities.Clear_Element(n),this.department_id!==-1&&this.selected_department!==null&&this.selected_department.controls.length!==0)for(let t of this.selected_department.control_groups)this.department_control_data.push(...t.CreateControlData(n))}RenderPaymentTypes(){this.payment_type_data=[];let n=document.getElementById(this.payment_type_target);if(n===null&&(n=document.createElement("div"),n.id=this.payment_type_target,document.getElementById(i.action_container).appendChild(n)),Utilities.Clear_Element(n),this.department_id!==-1&&this.selected_department!==null){let t=document.createElement("ol");t.classList.add("payment_type");for(let n of this.selected_department.payment_types){let i=document.createElement("li");i.classList.add("light-function","is-size-4","has-background-link");i.style.cursor="pointer";i.setAttribute("payment_type_id",n.payment_type_id.toString());let u=document.createElement("span");u.classList.add("name");u.appendChild(document.createTextNode(n.name));i.appendChild(u);let f=document.createElement("span");f.classList.add("totals");i.appendChild(f);t.appendChild(i);let r=document.createElement("ol");r.classList.add("control_container","hide");t.appendChild(r);i.onclick=()=>{r.childElementCount===0&&(this.AddPaymentType(n,r),r.classList.remove("hide")),console.log("this transaction",this)}}n.appendChild(t)}}AddPaymentType(i,r,u=false){let e=this.next_payment_type_index++;if(u){let n=0;for(let t of this.payment_type_data)t.payment_type_index>n&&(n=t.payment_type_index);e=n+1}let f=new t.PaymentTypeData(i,r,e);this.payment_type_data.push(f);f.add_another_payment_type_button.onclick=()=>{this.AddPaymentType(i,r,u)};f.cancel_payment_type_button.onclick=()=>{r.removeChild(f.payment_type_container);let n=this.payment_type_data.findIndex(n=>n.payment_type_index===f.payment_type_index);n>-1&&this.payment_type_data.splice(n,1);f=null;r.childElementCount===0&&r.classList.add("hide")};u&&Utilities.Set_Text(f.save_button,"Save New Payment Types");f.save_button.onclick=t=>{let i=t.target;Utilities.Toggle_Loading_Button(i,!0);u?(this.SaveNewPaymentTypes(),Utilities.Toggle_Loading_Button(i,!1)):this.ValidateTransaction()?(n.currentReceipt.ShowReceiptPreview(),Utilities.Toggle_Loading_Button(i,!1)):Utilities.Toggle_Loading_Button(i,!1)}}RenderSavedDepartmentControls(t){this.department_control_data=[];let r=document.getElementById(this.department_controls_target);if(r===null&&(r=document.createElement("div"),r.id=this.department_controls_target,document.getElementById(i.action_container).appendChild(r)),Utilities.Clear_Element(r),this.department_id!==-1&&this.selected_department!==null&&this.selected_department.controls.length!==0){let u=n.ControlGroup.CreateSavedControlGroups(t.department_control_data);for(let n of u)this.department_control_data.push(...n.CreateControlData(r,!1))}}RenderSavedPaymentTypes(t){this.payment_type_data=[];let r=document.getElementById(this.payment_type_target);if(r===null&&(r=document.createElement("div"),r.id=this.payment_type_target,document.getElementById(i.action_container).appendChild(r)),Utilities.Clear_Element(r),this.department_id!==-1&&this.selected_department!==null){let u=document.createElement("ol");u.classList.add("payment_type");let e=t.payment_type_data.map(n=>n.payment_type_id),f=[...new Set(e)];for(let i of f){let s=t.payment_type_data.filter(n=>n.payment_type_id===i),f=n.FindPaymentType(s[0].payment_type_id),r=document.createElement("li");r.classList.add("light-function","is-size-4","has-background-link");r.style.cursor="pointer";r.setAttribute("payment_type_id",f.payment_type_id.toString());let e=document.createElement("span");e.classList.add("name");e.appendChild(document.createTextNode(f.name));r.appendChild(e);let h=document.createElement("span");h.classList.add("totals");r.appendChild(h);u.appendChild(r);let o=document.createElement("ol");o.classList.add("control_container");u.appendChild(o);for(let n of s)this.AddSavedPaymentType(f,n,o)}for(let n of this.selected_department.payment_types)if(f.indexOf(n.payment_type_id)===-1){let t=document.createElement("li");t.classList.add("light-function","is-size-4","has-background-link");t.style.cursor="pointer";t.setAttribute("payment_type_id",n.payment_type_id.toString());let r=document.createElement("span");r.classList.add("name");r.appendChild(document.createTextNode(n.name));t.appendChild(r);let f=document.createElement("span");f.classList.add("totals");t.appendChild(f);u.appendChild(t);let i=document.createElement("ol");i.classList.add("control_container","hide");u.appendChild(i);t.onclick=()=>{i.childElementCount===0&&(this.AddPaymentType(n,i,!0),i.classList.remove("hide")),console.log("this transaction",this)}}r.appendChild(u)}}AddSavedPaymentType(n,i,r){let u=new t.PaymentTypeData(n,r,this.next_payment_type_index++,i);this.payment_type_data.push(u);u.add_another_payment_type_button.onclick=()=>{this.AddPaymentType(n,r,!0)};u.cancel_payment_type_button.style.display="none";u.save_button.style.display="none"}RenderReceivedFromInput(t,i){let r=i===null?"":i.received_from;this.received_from=r;this.received_from_element=n.ControlGroup.CreateInput("text",500,!0,"Received From",r);i===null?this.received_from_element.oninput=n=>{let t=n.target;this.received_from=t.value.trim();this.IsValid()}:this.received_from_element.readOnly=!0;this.received_from_element_container=n.ControlGroup.CreateInputFieldContainer(this.received_from_element,"Received From or N/A",!0,"is-one-half");t.appendChild(this.received_from_element_container)}ValidateNewPaymentTypes(n){let t=!0;for(let n of n)n.Validate()||(t=!1);return t}ValidateTransaction(){let n=!0;n=this.IsValid();for(let t of this.department_control_data){let i=t.Validate();!i&&n&&(n=!1)}for(let t of this.payment_type_data){let i=t.Validate();!i&&n&&(n=!1)}return n&&(this.ValidateCheckCount()||(Utilities.Error_Show(this.transaction_error_element,"You have entered a check amount but have entered that you have collected no checks."),this.transaction_error_element.parentElement.scrollIntoView(),n=!1)),n}ValidateCheckCount(){let n=0;for(let t of this.payment_type_data)for(let t of t.payment_method_data){if(t.check_count>0)return!0;n+=t.check_amount}return n===0}IsValid(){n.error_scrolled=!1;this.ResetErrorElements();let t=!0;return this.received_from.length===0&&(n.ControlGroup.UpdateInputError(this.received_from_element,this.received_from_element_container,"This field is required."),t=!1),t}ResetErrorElements(){Utilities.Clear_Element(this.transaction_error_element);n.ControlGroup.UpdateSelectError(this.department_element_container,"");n.ControlGroup.UpdateInputError(this.received_from_element,this.received_from_element_container,"")}SaveTransactionData(){let i=this,r=n.GetPath();Utilities.Post(r+"API/Transaction/Save",i).then(function(i){console.log("post probably good",i);n.currentReceipt.ShowReceipt(i);n.ResetReceipt();n.Data.TransactionData.GetTransactionList().then(i=>{n.transactions=i,Utilities.Toggle_Loading_Button(t.TransactionData.reload_button,!1)})},function(n){console.log("post error occurred",n)})}static GetTransactionList(){let t=n.current_page;Utilities.Toggle_Loading_Button(i.reload_button,!0);let r=n.GetPath(),u=i.GetTransactionFilters();return Utilities.Get(r+"API/Transaction/Get?page_number="+t.toString()+u)}static GetTransactionPageCount(){let r=n.GetPath(),t=i.GetTransactionFilters();return t.length>0&&(t="?"+t.substr(1)),Utilities.Get(r+"API/Transaction/PageCount"+t)}static GetTransactionFilters(){let t=[];return n.name_filter.length>0&&t.push("&display_name_filter="+n.name_filter),n.department_id_filter>0&&t.push("&department_id_filter="+n.department_id_filter.toString()),n.transaction_type_filter.length>0&&t.push("&transaction_type_filter="+n.transaction_type_filter),n.completed_filter.length>0&&t.push("&completed_filter="+n.completed_filter),n.modified_only_filter&&t.push("&has_been_modified=true"),n.transaction_number_filter.length>0&&t.push("&transaction_number_filter="+n.transaction_number_filter),t.join("")}static GetSpecificTransaction(t){let i=n.GetPath();return Utilities.Get(i+"API/Transaction/GetTransactionData?transaction_id="+t.toString())}static RenderTransactionList(){n.ViewTransactions();let u=document.getElementById(i.transaction_list_view_container);Utilities.Clear_Element(u);let f=i.CreateTransactionListTable();u.appendChild(f);let r=document.createElement("tbody");if(f.appendChild(r),n.transactions.length===0)r.appendChild(n.CreateMessageRow(11,"No transactions were found to match your filters."));else for(let n of n.transactions)r.appendChild(i.CreateTransactionListRow(n));Utilities.Toggle_Loading_Button(t.TransactionData.reload_button,!1)}static CreateTransactionListTable(){let i=document.createElement("table");i.classList.add("table","is-fullwidth");let r=document.createElement("thead");r.id="transaction_list_view_header";i.appendChild(r);let t=document.createElement("tr");r.appendChild(t);t.appendChild(Utilities.CreateTableCell("th","Created On","has-text-left","15%"));t.appendChild(Utilities.CreateTableCell("th","Type","has-text-centered","5%"));t.appendChild(Utilities.CreateTableCell("th","Number","has-text-left","10%"));t.appendChild(Utilities.CreateTableCell("th","Status","has-text-left","7.5%"));t.appendChild(Utilities.CreateTableCell("th","Department","has-text-left","15%"));t.appendChild(Utilities.CreateTableCell("th","Checks","has-text-right","7.25%"));t.appendChild(Utilities.CreateTableCell("th","Check Amount","has-text-right","10%"));t.appendChild(Utilities.CreateTableCell("th","Cash Amount","has-text-right","10%"));t.appendChild(Utilities.CreateTableCell("th","Total Amount","has-text-right","10%"));let u=Utilities.CreateTableCell("th","Page: "+n.current_page.toString(),"has-text-centered","10%");return u.colSpan=2,t.appendChild(u),i}static CreateTransactionListRow(t){let r=document.createElement("tr");r.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(t.created_on),"has-text-left"));r.appendChild(Utilities.CreateTableCell("td",t.transaction_type,"has-text-centered"));r.appendChild(Utilities.CreateTableCell("td",t.transaction_number,"has-text-left"));let u="";t.transaction_type==="R"?u=t.child_transaction_id===null?"Incomplete":t.child_transaction_id===t.transaction_id?"Completed":"Deposited":t.transaction_type==="D"&&(u=t.child_transaction_id===null?"Incomplete":"Accepted");r.appendChild(Utilities.CreateTableCell("td",u,"has-text-left"));r.appendChild(Utilities.CreateTableCell("td",t.department_name,"has-text-left"));r.appendChild(Utilities.CreateTableCell("td",t.total_check_count.toString(),"has-text-right"));r.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t.total_check_amount),"has-text-right"));r.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t.total_cash_amount),"has-text-right"));r.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t.total_check_amount+t.total_cash_amount),"has-text-right"));let f=document.createElement("td");f.classList.add("has-text-right");let o=i.CreateTableCellIconButton("fa-list","is-small");o.onclick=()=>{n.ShowReceiptDetail(t.transaction_id)};f.appendChild(o);r.appendChild(f);let e=document.createElement("td");e.classList.add("has-text-right");let s=i.CreateTableCellIconButton("fa-print","is-small");return s.onclick=()=>{n.ShowReceipt(t.transaction_id)},e.appendChild(s),r.appendChild(e),r}static CreateTableCellIconButton(n,t){let i=document.createElement("a");i.classList.add("button",t);let r=document.createElement("span");r.classList.add("icon",t);let u=document.createElement("i");return u.classList.add("fas",n),r.appendChild(u),i.appendChild(r),i}SaveNewPaymentTypes(){if(console.log("save new payment types",this.payment_type_data),this.transaction_id===-1){alert("There was an error attempting to save this transaction.  The transaction id is unknown.");return}let t=[];for(let n of this.payment_type_data)n.transaction_payment_type_id===-1&&(n.transaction_id=this.transaction_id,n.added_after_save=!0,t.push(n));if(!this.ValidateNewPaymentTypes(t)){console.log("failed to validate new payment types");return}let i=n.GetPath();Utilities.Post_Empty(i+"API/Transaction/AddPaymentTypes",t).then(t=>{console.log("response",t),t.ok?t.text().then(t=>{console.log("response text",t),t.length>0?alert("An error occurred attempting to save this payment type:\r\n"+t):n.ShowReceiptDetail(this.transaction_id)}):alert("An error occurred attempting to save this payment type:\r\n"+t.text)})}}i.reload_button="filterRefreshButton";i.action_container="action_view";i.transaction_view_container="transaction_view";i.transaction_list_view_container="transaction_list_view";i.transaction_view_filters_container="transaction_view_filters";t.TransactionData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={}));