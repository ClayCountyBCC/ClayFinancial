/// <reference path="MenuItem.ts" />
"use strict";var _createClass=(function(){function defineProperties(target,props){for(var i=0;i < props.length;i++) {var descriptor=props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if("value" in descriptor)descriptor.writable = true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i < arr.length;i++) arr2[i] = arr[i];return arr2;}else {return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var __awaiter=undefined && undefined.__awaiter || function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new (P || (P = Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e) {reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e) {reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator = generator.apply(thisArg,_arguments || [])).next());});};var Utilities;(function(Utilities){function Hide(e){if(typeof e == "string"){e = document.getElementById(e);}e.classList.add("hide");e.classList.remove("show");e.classList.remove("show-inline");e.classList.remove("show-flex");}Utilities.Hide = Hide;function Show(e){if(typeof e == "string"){e = document.getElementById(e);}e.classList.add("show");e.classList.remove("hide");e.classList.remove("show-inline");e.classList.remove("show-flex");}Utilities.Show = Show;function Show_Inline(e){if(typeof e == "string"){e = document.getElementById(e);}e.classList.add("show-inline");e.classList.remove("hide");e.classList.remove("show");e.classList.remove("show-flex");}Utilities.Show_Inline = Show_Inline;function Show_Inline_Flex(e){if(typeof e == "string"){e = document.getElementById(e);}e.classList.add("show-inline-flex");e.classList.remove("hide");e.classList.remove("show");e.classList.remove("show-flex");}Utilities.Show_Inline_Flex = Show_Inline_Flex;function Show_Flex(e){if(typeof e == "string"){e = document.getElementById(e);}e.classList.add("show-flex");e.classList.remove("hide");e.classList.remove("show-inline");e.classList.remove("show");}Utilities.Show_Flex = Show_Flex;function Error_Show(e,errorText,timeout){if(typeof e == "string"){e = document.getElementById(e);}if(errorText){ //Set_Text(e, errorText);
Clear_Element(e);var notification=document.createElement("div");notification.classList.add("notification");notification.classList.add("is-danger");var deleteButton=document.createElement("button");deleteButton.classList.add("delete");deleteButton.onclick = function(){Hide(e);};notification.appendChild(deleteButton);if(Array.isArray(errorText)){(function(){ // we're assuming that errorText is an array if we get here.
var ul=document.createElement("ul");errorText.forEach(function(et){var li=document.createElement("li");li.appendChild(document.createTextNode(et));ul.appendChild(li);});notification.appendChild(ul);})();}else {notification.appendChild(document.createTextNode(errorText));}e.appendChild(notification);}Show(e);if(timeout == undefined || timeout === true){window.setTimeout(function(j){Hide(e);},30000);}}Utilities.Error_Show = Error_Show;function Simple_Error_Show(e,errorText){Clear_Element(e);e.appendChild(document.createTextNode(errorText));}Utilities.Simple_Error_Show = Simple_Error_Show;function Clear_Element(node){if(node === null || node === undefined)return;while(node.firstChild) {node.removeChild(node.firstChild);}}Utilities.Clear_Element = Clear_Element;function Create_Option(value,label){var selected=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];var o=document.createElement("option");o.value = value;o.text = label;o.selected = selected;return o;}Utilities.Create_Option = Create_Option;function Get_Value(e){if(typeof e == "string"){e = document.getElementById(e);}return e.value;}Utilities.Get_Value = Get_Value;function Set_Value(e,value){if(typeof e == "string"){e = document.getElementById(e);}e.value = value;}Utilities.Set_Value = Set_Value;function Set_Text(e,value){if(typeof e == "string"){e = document.getElementById(e);}Clear_Element(e);e.appendChild(document.createTextNode(value));}Utilities.Set_Text = Set_Text;function Show_Menu(elementId){ //let element = e.srcElement;
// we expect the element's id to be in a "nav-XXX" name format, where 
// XXX is the element we want to show 
var id=elementId.replace("nav-","");var menuItems=document.querySelectorAll("#menuTabs > li > a");if(menuItems.length > 0){for(var i=0;i < menuItems.length;i++) {var item=menuItems.item(i);if(item.id === elementId){item.parentElement.classList.add("is-active");}else {item.parentElement.classList.remove("is-active");}}}Show_Hide_Selector("#views > section",id);}Utilities.Show_Menu = Show_Menu;function Handle_Tabs(tabSelector,containerSelector,id){Activate_Inactivate_Selector(tabSelector,"nav-" + id);Show_Hide_Selector(containerSelector,id);}Utilities.Handle_Tabs = Handle_Tabs;function Activate_Inactivate_Selector(selector,id){var sections=document.querySelectorAll(selector);if(sections.length > 0){for(var i=0;i < sections.length;i++) {var item=sections.item(i);if(item.id === id){item.classList.add("is-active");}else {item.classList.remove("is-active");}}}}Utilities.Activate_Inactivate_Selector = Activate_Inactivate_Selector;function Show_Hide_Selector(selector,id){var sections=document.querySelectorAll(selector);if(sections.length > 0){for(var i=0;i < sections.length;i++) {var item=sections.item(i);if(item.id === id){Show(item);}else {Hide(item);}}}}Utilities.Show_Hide_Selector = Show_Hide_Selector; // original Get Function
//export function Get<T>(url: string): Promise<T>
//{
//  return fetch(url,
//    {
//      method: "GET",
//      headers: {
//        "Content-Type": "application/json"//,"Upgrade-Insecure-Requests": "1"
//      },
//      cache: "no-cache",
//      credentials: "include"
//    }
//  )
//    .then(response =>
//    {
//      if (!response.ok)
//      {
//        throw new Error(response.statusText)
//      }
//      return response.json();
//    });
//}
function Get_Empty(url){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){var response;return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:context$3$0.next = 2;return fetch(url,{method:"GET",headers:{"Content-Type":"application/json" //,"Upgrade-Insecure-Requests": "1"
},cache:"no-cache",credentials:"include"});case 2:response = context$3$0.sent;if(response.ok){context$3$0.next = 5;break;}throw new Error(response.statusText);case 5:context$3$0.next = 7;return response.text();case 7:return context$3$0.abrupt("return",context$3$0.sent);case 8:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Utilities.Get_Empty = Get_Empty;function Get(url){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){var response;return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:context$3$0.next = 2;return fetch(url,{method:"GET",headers:{"Content-Type":"application/json" //,"Upgrade-Insecure-Requests": "1"
},cache:"no-cache",credentials:"include"});case 2:response = context$3$0.sent;if(response.ok){context$3$0.next = 5;break;}throw new Error(response.statusText);case 5:context$3$0.next = 7;return response.json();case 7:return context$3$0.abrupt("return",context$3$0.sent);case 8:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Utilities.Get = Get;function Post(url,data){return fetch(url,{method:"POST",body:JSON.stringify(data),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(response){if(!response.ok){throw new Error(response.statusText);}return response.json();});}Utilities.Post = Post;function Post_Empty(url,data){return fetch(url,{method:"POST",body:data !== null?JSON.stringify(data):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(response){return response; //console.log('Post Response', response);
//if (!response.ok)
//{
//  throw new Error(response.statusText)
//}
//return response;
});}Utilities.Post_Empty = Post_Empty;function Format_Amount(amount){return amount.toLocaleString('en-US',{style:'currency',currency:'USD'});}Utilities.Format_Amount = Format_Amount;function Format_Date(date){if(date instanceof Date){return date.toLocaleDateString('en-us');}var d=new Date(date);return d.toLocaleDateString('en-US');}Utilities.Format_Date = Format_Date;function Format_DateTime(date){if(date instanceof Date){return date.toLocaleString('en-us');}return new Date(date).toLocaleString('en-US');}Utilities.Format_DateTime = Format_DateTime;function Validate_Text(e,errorElementId,errorText){ // this should only be used for required elements.
if(typeof e == "string"){e = document.getElementById(e);}var ele=e;ele.tagName.toLowerCase() === "select"?ele.parentElement.classList.remove("is-danger"):ele.classList.remove("is-danger");var v=Get_Value(ele).trim();if(v.length == 0){ele.tagName.toLowerCase() === "select"?ele.parentElement.classList.add("is-danger"):ele.classList.add("is-danger");Error_Show(errorElementId,errorText);ele.focus();ele.scrollTo();return "";}return v;}Utilities.Validate_Text = Validate_Text;function Toggle_Loading_Button(e,disabled){if(typeof e == "string"){e = document.getElementById(e);}var b=e;b.disabled = disabled;b.classList.toggle("is-loading",disabled);}Utilities.Toggle_Loading_Button = Toggle_Loading_Button;function Create_Menu_Element(menuItem){var li=document.createElement("li");if(menuItem.selected)li.classList.add("is-active");var a=document.createElement("a");a.id = menuItem.id;a.onclick = function(){Update_Menu(menuItem);};if(menuItem.icon.length > 0){var span=document.createElement("span");span.classList.add("icon");span.classList.add(Transaction.app_input_size);var i=document.createElement("i");var icons=menuItem.icon.split(" ");var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=icons[Symbol.iterator](),_step;!(_iteratorNormalCompletion = (_step = _iterator.next()).done);_iteratorNormalCompletion = true) {var icon=_step.value;i.classList.add(icon);}}catch(err) {_didIteratorError = true;_iteratorError = err;}finally {try{if(!_iteratorNormalCompletion && _iterator["return"]){_iterator["return"]();}}finally {if(_didIteratorError){throw _iteratorError;}}}span.appendChild(i);a.appendChild(span);}a.appendChild(document.createTextNode(menuItem.label));li.appendChild(a);return li;}Utilities.Create_Menu_Element = Create_Menu_Element;function Update_Menu(menuItem){Set_Text("menuTitle",menuItem.title);Set_Text("menuSubTitle",menuItem.subTitle);Show_Menu(menuItem.id);document.getElementById(menuItem.autofocusId).focus();}Utilities.Update_Menu = Update_Menu;function Build_Menu_Elements(target,Menus){var menu=document.getElementById(target);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Menus[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done);_iteratorNormalCompletion2 = true) {var menuItem=_step2.value;menu.appendChild(Utilities.Create_Menu_Element(menuItem));}}catch(err) {_didIteratorError2 = true;_iteratorError2 = err;}finally {try{if(!_iteratorNormalCompletion2 && _iterator2["return"]){_iterator2["return"]();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}Utilities.Build_Menu_Elements = Build_Menu_Elements;function CheckBrowser(){var browser="";if((navigator.userAgent.indexOf("Opera") || navigator.userAgent.indexOf('OPR')) != -1){browser = 'Opera';}else if(navigator.userAgent.indexOf("Chrome") != -1){browser = 'Chrome';}else if(navigator.userAgent.indexOf("Safari") != -1){browser = 'Safari';}else if(navigator.userAgent.indexOf("Firefox") != -1){browser = 'Firefox';}else if(navigator.userAgent.indexOf("MSIE") != -1 || !!document.DOCUMENT_NODE == true) //IF IE > 10
{browser = 'IE';}else {browser = 'unknown';}return browser;}Utilities.CheckBrowser = CheckBrowser;function Get_Path(appName){var path="/";var i=window.location.pathname.toLowerCase().indexOf(appName);if(i == 0){path = appName + "/";}return path;}Utilities.Get_Path = Get_Path;function Create_Centered_Level(level_items){var left=arguments.length <= 1 || arguments[1] === undefined?[]:arguments[1];var right=arguments.length <= 2 || arguments[2] === undefined?[]:arguments[2];var level=document.createElement("div");level.classList.add("level");var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=level_items[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done);_iteratorNormalCompletion3 = true) {var li=_step3.value;level.appendChild(Create_Level_Item(li));}}catch(err) {_didIteratorError3 = true;_iteratorError3 = err;}finally {try{if(!_iteratorNormalCompletion3 && _iterator3["return"]){_iterator3["return"]();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}if(left.length > 0){var leftcontainer=document.createElement("div");leftcontainer.classList.add("level-left");level.appendChild(leftcontainer);var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=left[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done);_iteratorNormalCompletion4 = true) {var li=_step4.value;leftcontainer.appendChild(Create_Level_Item(li));}}catch(err) {_didIteratorError4 = true;_iteratorError4 = err;}finally {try{if(!_iteratorNormalCompletion4 && _iterator4["return"]){_iterator4["return"]();}}finally {if(_didIteratorError4){throw _iteratorError4;}}}}if(right.length > 0){var rightcontainer=document.createElement("div");rightcontainer.classList.add("level-right");level.appendChild(rightcontainer);var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=right[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done);_iteratorNormalCompletion5 = true) {var li=_step5.value;rightcontainer.appendChild(Create_Level_Item(li));}}catch(err) {_didIteratorError5 = true;_iteratorError5 = err;}finally {try{if(!_iteratorNormalCompletion5 && _iterator5["return"]){_iterator5["return"]();}}finally {if(_didIteratorError5){throw _iteratorError5;}}}}return level;}Utilities.Create_Centered_Level = Create_Centered_Level;function Create_Level_Item(level_item){var _levelitem$classList;var levelitem=document.createElement("div");(_levelitem$classList = levelitem.classList).add.apply(_levelitem$classList,["level-item"].concat(_toConsumableArray(level_item.classes)));var container=document.createElement("div");levelitem.appendChild(container);if(level_item.heading.length > 0){var heading=document.createElement("p");heading.classList.add("heading");heading.appendChild(document.createTextNode(level_item.heading));container.appendChild(heading);}if(level_item.title_text.length > 0){var title=document.createElement("p");title.classList.add("title");title.appendChild(document.createTextNode(level_item.title_text));container.appendChild(title);}else {if(level_item.title !== null){container.appendChild(level_item.title);}}return levelitem;}function CreateTableCell(celltype,value,class_to_add){var width=arguments.length <= 3 || arguments[3] === undefined?"":arguments[3];var col_span=arguments.length <= 4 || arguments[4] === undefined?-1:arguments[4];if(celltype !== "td" && celltype !== "th")celltype = "td";var cell=document.createElement(celltype);if(width.length > 0)cell.style.width = width;if(value.length > 0)cell.appendChild(document.createTextNode(value));if(class_to_add.length > 0)cell.classList.add(class_to_add);if(col_span > -1)cell.colSpan = col_span;return cell;}Utilities.CreateTableCell = CreateTableCell;})(Utilities || (Utilities = {})); //# sourceMappingURL=Utilities.js.map
var Utilities;(function(Utilities){"use strict";var SimpleValue=function SimpleValue(){_classCallCheck(this,SimpleValue);this.label = "";this.value = "";};Utilities.SimpleValue = SimpleValue;})(Utilities || (Utilities = {})); //# sourceMappingURL=SimpleValue.js.map
var __awaiter=undefined && undefined.__awaiter || function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new (P || (P = Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e) {reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e) {reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator = generator.apply(thisArg,_arguments || [])).next());});};var Transaction;(function(Transaction){Transaction.app_input_size = "is-normal";Transaction.error_scrolled = false;Transaction.departments = [];Transaction.payment_types = [];Transaction.controls = [];Transaction.transactions = [];Transaction.currentReceipt = null; //export let currentTransactionData: Transaction.Data.TransactionData = null;
Transaction.DepartmentControl = null;Transaction.DepartmentControlContainer = null;Transaction.current_page = 1;Transaction.page_count = 0;Transaction.department_id_filter = -1;Transaction.name_filter = "mine";Transaction.completed_filter = "i";Transaction.transaction_type_filter = "";Transaction.modified_only_filter = false;Transaction.transaction_number_filter = "";Transaction.editing_control_data = null;Transaction.editing_payment_method_data = null;Transaction.reason_for_change_input = "reason_for_change";Transaction.reason_for_change_input_container = "reason_for_change_container";Transaction.change_edit_container = "change_edit_container";Transaction.change_transaction_history_table_header = "change_transaction_history_header";Transaction.change_transaction_history_table_body = "change_transaction_history_table";Transaction.deposit_view_container = "deposit_view";function Start(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:context$3$0.next = 2;return Transaction.Department.GetDepartments().then(function(d){Transaction.payment_types = [];Transaction.controls = [];Transaction.departments = d;Transaction.DepartmentControl = Transaction.Department.CreateDepartmentElement(Transaction.departments);PopulateFilters();var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{var _loop=function(){var department=_step6.value;var payment_type_ids=Transaction.payment_types.map(function(pt){return pt.payment_type_id;});Transaction.payment_types = Transaction.payment_types.concat(department.payment_types.filter(function(pt){return payment_type_ids.indexOf(pt.payment_type_id) === -1;}));var department_control_ids=department.controls.map(function(c){return c.control_id;});Transaction.controls = Transaction.controls.concat(department.controls.filter(function(c){return department_control_ids.indexOf(c.control_id) === -1;}));department.control_groups = Transaction.ControlGroup.CreateControlGroups(department.controls);_iteratorNormalCompletion8 = true;_didIteratorError8 = false;_iteratorError8 = undefined;try{for(_iterator8 = department.payment_types[Symbol.iterator]();!(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done);_iteratorNormalCompletion8 = true) {var paymentType=_step8.value;paymentType.control_groups = Transaction.ControlGroup.CreateControlGroups(paymentType.controls);}}catch(err) {_didIteratorError8 = true;_iteratorError8 = err;}finally {try{if(!_iteratorNormalCompletion8 && _iterator8["return"]){_iterator8["return"]();}}finally {if(_didIteratorError8){throw _iteratorError8;}}}};for(var _iterator6=Transaction.departments[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done);_iteratorNormalCompletion6 = true) {var _iteratorNormalCompletion8;var _didIteratorError8;var _iteratorError8;var _iterator8,_step8;_loop();}}catch(err) {_didIteratorError6 = true;_iteratorError6 = err;}finally {try{if(!_iteratorNormalCompletion6 && _iterator6["return"]){_iterator6["return"]();}}finally {if(_didIteratorError6){throw _iteratorError6;}}}var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{var _loop2=function(){var payment_type=_step7.value;var control_ids=Transaction.controls.map(function(c){return c.control_id;});Transaction.controls = Transaction.controls.concat(payment_type.controls.filter(function(c){return control_ids.indexOf(c.control_id) === -1;}));};for(var _iterator7=Transaction.payment_types[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done);_iteratorNormalCompletion7 = true) {_loop2();}}catch(err) {_didIteratorError7 = true;_iteratorError7 = err;}finally {try{if(!_iteratorNormalCompletion7 && _iterator7["return"]){_iterator7["return"]();}}finally {if(_didIteratorError7){throw _iteratorError7;}}}});case 2:context$3$0.next = 4;return Transaction.GetAllNames().then(function(names){var filterNames=document.getElementById("nameFilter");var depositNames=document.getElementById("depositNameFilter");var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=names[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done);_iteratorNormalCompletion9 = true) {var _name=_step9.value;filterNames.add(Utilities.Create_Option(_name,_name,false));depositNames.add(Utilities.Create_Option(_name,_name,false));}}catch(err) {_didIteratorError9 = true;_iteratorError9 = err;}finally {try{if(!_iteratorNormalCompletion9 && _iterator9["return"]){_iterator9["return"]();}}finally {if(_didIteratorError9){throw _iteratorError9;}}}});case 4:context$3$0.next = 6;return Transaction.GetTransactionList(1);case 6:setInterval(function(){var d=new Date();var now_hours=d.getHours(); // putting a limit on when we do the refreshing.  We stop at 7 PM and start again at 6 AM.
if(now_hours > 5 && now_hours < 19){Transaction.GetTransactionList(Transaction.current_page,false);}},60 * 5 * 1000);case 7:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Transaction.Start = Start;function ShowReceipt(transaction_id){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:context$3$0.next = 2;return Transaction.Data.TransactionData.GetSpecificTransaction(transaction_id).then(function(transaction){console.log('transaction to show',transaction);Transaction.currentReceipt = new Transaction.Receipt(transaction);Transaction.currentReceipt.ShowReceipt(transaction);});case 2:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Transaction.ShowReceipt = ShowReceipt;function ShowReceiptDetail(transaction_id){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:context$3$0.next = 2;return Transaction.Data.TransactionData.GetSpecificTransaction(transaction_id).then(function(transaction){console.log('transaction to show',transaction);Transaction.currentReceipt = new Transaction.Receipt(transaction);Transaction.ViewReceiptDetail();});case 2:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Transaction.ShowReceiptDetail = ShowReceiptDetail;function GetTransactionList(page){var change_view=arguments.length <= 1 || arguments[1] === undefined?true:arguments[1];return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:Transaction.current_page = page;context$3$0.next = 3;return Transaction.Data.TransactionData.GetTransactionList().then(function(tv){Transaction.transactions = tv;Transaction.Data.TransactionData.RenderTransactionList(tv);console.log('transactions',Transaction.transactions);Utilities.Toggle_Loading_Button(Transaction.Data.TransactionData.reload_button,false);if(change_view)Transaction.ViewTransactions();});case 3:context$3$0.next = 5;return Transaction.Data.TransactionData.GetTransactionPageCount().then(function(pagecount){Transaction.page_count = pagecount;HandlePagination();});case 5:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Transaction.GetTransactionList = GetTransactionList;function NewReceipt(){Transaction.currentReceipt = new Transaction.Receipt();var current_receipt_link=document.getElementById("linkReceiptInProgress");current_receipt_link.classList.remove("has-background-grey-light","has-text-grey");current_receipt_link.style.cursor = "pointer";Transaction.ViewReceiptDetail();}Transaction.NewReceipt = NewReceipt;function ResetReceipt(){Transaction.currentReceipt = new Transaction.Receipt();Transaction.currentReceipt = null;var current_receipt_link=document.getElementById("linkReceiptInProgress");current_receipt_link.classList.add("has-background-grey-light","has-text-grey");current_receipt_link.style.cursor = "default";}Transaction.ResetReceipt = ResetReceipt;function NewDeposit(){}Transaction.NewDeposit = NewDeposit;function GetPath(){var path="/";var i=window.location.pathname.toLowerCase().indexOf("/clayfinancial");if(i == 0){path = "/clayfinancial/";}return path;}Transaction.GetPath = GetPath;function FindPaymentType(payment_type_id){var filtered=Transaction.payment_types.filter(function(pt){return pt.payment_type_id === payment_type_id;});return filtered.length === 1?filtered[0]:null;}Transaction.FindPaymentType = FindPaymentType;function FindControl(control_id){var filtered=Transaction.controls.filter(function(c){return c.control_id === control_id;});return filtered.length === 1?filtered[0]:null;}Transaction.FindControl = FindControl;function PopulateFilters(){var departmentSelect=document.getElementById("departmentFilter");departmentSelect.add(Utilities.Create_Option("","All Departments",true));var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=Transaction.departments[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done);_iteratorNormalCompletion10 = true) {var d=_step10.value;departmentSelect.add(Utilities.Create_Option(d.department_id.toString(),d.name,false));}}catch(err) {_didIteratorError10 = true;_iteratorError10 = err;}finally {try{if(!_iteratorNormalCompletion10 && _iterator10["return"]){_iterator10["return"]();}}finally {if(_didIteratorError10){throw _iteratorError10;}}}var nameSelect=document.getElementById("nameFilter");nameSelect.add(Utilities.Create_Option("mine","My Transactions",true));nameSelect.add(Utilities.Create_Option("","All Users",false));var depositNameSelect=document.getElementById("depositNameFilter");depositNameSelect.add(Utilities.Create_Option("","Select A Name to Deposit",true));depositNameSelect.add(Utilities.Create_Option("mine","My Transactions",false));var statusSelect=document.getElementById("statusFilter");statusSelect.add(Utilities.Create_Option("","All Statuses",false));statusSelect.add(Utilities.Create_Option("i","Incomplete",true));statusSelect.add(Utilities.Create_Option("c","Completed",false));var typeSelect=document.getElementById("typeFilter");typeSelect.add(Utilities.Create_Option("","All Types",true));typeSelect.add(Utilities.Create_Option("R","Receipts",false));typeSelect.add(Utilities.Create_Option("D","Deposits",false));}function SearchOnEnter(event){var e=event || window.event;if(event.keyCode == 13){console.log('enter');Transaction.FilterTransactions();}}Transaction.SearchOnEnter = SearchOnEnter;function FilterTransactions(){Transaction.department_id_filter = parseInt(Utilities.Get_Value("departmentFilter"));Transaction.name_filter = Utilities.Get_Value("nameFilter");Transaction.completed_filter = Utilities.Get_Value("statusFilter");Transaction.transaction_type_filter = Utilities.Get_Value("typeFilter");Transaction.transaction_number_filter = Utilities.Get_Value("transactionNumberFilter");Transaction.modified_only_filter = document.getElementById("modifiedFilter").checked;Transaction.GetTransactionList(1);}Transaction.FilterTransactions = FilterTransactions;function ViewReceiptInProgress(){if(!(Transaction.currentReceipt === null)){ViewReceiptDetail();}}Transaction.ViewReceiptInProgress = ViewReceiptInProgress;function HideAllViews(){Utilities.Hide(Transaction.deposit_view_container);Utilities.Hide(Transaction.Data.TransactionData.transaction_view_container);Utilities.Hide(Transaction.Data.TransactionData.action_container);Utilities.Hide(Transaction.Receipt.receipt_container);}function ViewReceiptDetail(){HideAllViews();Utilities.Show(Transaction.Data.TransactionData.action_container);}Transaction.ViewReceiptDetail = ViewReceiptDetail;function ViewPrintableReceipt(){HideAllViews();Utilities.Show(Transaction.Receipt.receipt_container);}Transaction.ViewPrintableReceipt = ViewPrintableReceipt;function ViewTransactions(){HideAllViews();Utilities.Show(Transaction.Data.TransactionData.transaction_view_container);}Transaction.ViewTransactions = ViewTransactions;function ViewDeposit(){HideAllViews();Utilities.Show(Transaction.deposit_view_container);Utilities.Hide("createDepositButton");Utilities.Set_Value("depositNameFilter","");}Transaction.ViewDeposit = ViewDeposit;function PreviousPage(element){if(element.getAttribute("disabled") === null)GetTransactionList(Transaction.current_page - 1);}Transaction.PreviousPage = PreviousPage;function NextPage(element){if(element.getAttribute("disabled") === null)GetTransactionList(Transaction.current_page + 1);}Transaction.NextPage = NextPage;function HandlePagination(){ // Handle next/previous pages
var previousPage=document.getElementById("resultsPreviousPage");var nextPage=document.getElementById("resultsNextPage");if(Transaction.current_page === 1){previousPage.setAttribute("disabled","");}else {previousPage.removeAttribute("disabled");}if(Transaction.page_count <= Transaction.current_page){nextPage.setAttribute("disabled","");}else {nextPage.removeAttribute("disabled");} // now that we've handled the next/previous buttons, let's reset the current page in the hash.
var pageList=document.getElementById("resultsPaginationList");Utilities.Clear_Element(pageList);pageList.appendChild(CreatePaginationLinks());}function CreatePaginationLinks(){ // Scenarios
// if the number of pages is 7 or less
//    create a link for every page
//    nothing else to worry about
// if the number of pages is > 7 
//    if the current page is 2 or less or total pages - 2 or more
//      show pages 1 through 3 an ellipsis, and then last page - 3 to last page
//    if the current page is 3 or total pages - 3 
//      show pages 1 through 4 an ellipsis, and then last page - 2 to last page
// Otherwise
//    show page 1 then an ellipsis then currentpage - 1 through current page + 1 then last page
var currentPage=Transaction.current_page;var totalPages=Transaction.page_count;var df=document.createDocumentFragment();if(currentPage < 1)Transaction.current_page = 1;if(currentPage > totalPages)currentPage = totalPages;if(totalPages < 8){ // add a link to every page
for(var i=1;i <= totalPages;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}return df;}if(currentPage === 3){for(var i=1;i <= 4;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}df.appendChild(CreatePaginationEllipsis());for(var i=totalPages - 1;i <= totalPages;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}return df;}if(currentPage === totalPages - 2){for(var i=1;i <= 2;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}df.appendChild(CreatePaginationEllipsis());for(var i=totalPages - 3;i <= totalPages;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}return df;}if(currentPage < 3 || currentPage > totalPages - 3){ // add links to the first 3 pages and last 3 pages
for(var i=1;i <= 3;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}df.appendChild(CreatePaginationEllipsis());for(var i=totalPages - 2;i <= totalPages;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}return df;} // add links to the first page, currentpage -1 through currentpage + 1, and last page
df.appendChild(CreatePaginationLink(1,false));df.appendChild(CreatePaginationEllipsis());for(var i=currentPage - 1;i <= currentPage + 1;i++) {df.appendChild(CreatePaginationLink(i,i === currentPage));}df.appendChild(CreatePaginationEllipsis());df.appendChild(CreatePaginationLink(totalPages,false));return df;}function CreatePaginationLink(page,isSelected){ // scroll back up to the top when a page is clicked
//currentHash.page = page.toString();
//currentHash.permit_display = "";
//currentHash.permit_print = "";
var li=document.createElement("li");var a=document.createElement("a");a.classList.add("pagination-link");a.setAttribute("aria-label","Goto page " + page.toString());if(isSelected){a.classList.add("is-current");a.setAttribute("aria-current","page");a.style.cursor = "default";}else {a.onclick = function(){Transaction.GetTransactionList(page);var header=document.getElementById("transaction_list_view_header");if(header !== null)header.scrollIntoView(true);};}a.appendChild(document.createTextNode(page.toString()));li.appendChild(a);return li;}function CreatePaginationEllipsis(){var li=document.createElement("li");var span=document.createElement("span");span.classList.add("pagination-ellipsis");span.innerHTML = "&hellip;";li.appendChild(span);return li;}function CreateMessageRow(colspan,message){var tr=document.createElement("tr");var td=document.createElement("td");td.colSpan = colspan;td.appendChild(document.createTextNode(message));tr.appendChild(td);return tr;}Transaction.CreateMessageRow = CreateMessageRow;function ShowChangeModal(){Transaction.editing_control_data = null;Transaction.editing_payment_method_data = null;document.getElementById("change_transaction").classList.add("is-active");}Transaction.ShowChangeModal = ShowChangeModal;function CloseChangeModal(){document.getElementById("change_transaction").classList.remove("is-active");}Transaction.CloseChangeModal = CloseChangeModal;function LoadControlDataChange(control_data_id,transaction_id,field_label){Utilities.Set_Text("change_field_label",field_label);Transaction.ShowChangeModal();Transaction.Data.ControlData.GetAndDisplayControlHistory(control_data_id,transaction_id).then(function(){});}Transaction.LoadControlDataChange = LoadControlDataChange;function LoadPaymentTypeDataChange(payment_method_data_id,is_cash,transaction_id,field_label){Utilities.Set_Text("change_field_label",field_label);Transaction.ShowChangeModal();Transaction.Data.PaymentMethodData.GetAndDisplayHistory(payment_method_data_id,transaction_id,is_cash).then(function(){});}Transaction.LoadPaymentTypeDataChange = LoadPaymentTypeDataChange;function SaveChanges(){Utilities.Toggle_Loading_Button("change_transaction_save",true);var reason=Utilities.Get_Value(Transaction.reason_for_change_input).trim();if(reason.length === 0){var input=document.getElementById(Transaction.reason_for_change_input);var container=document.getElementById(Transaction.reason_for_change_input_container);Transaction.ControlGroup.UpdateInputError(input,container,"This is required.");Utilities.Toggle_Loading_Button("change_transaction_save",false);return;}if(Transaction.editing_control_data !== null){if(!Transaction.editing_control_data.Validate()){Utilities.Toggle_Loading_Button("change_transaction_save",false);return;}Transaction.editing_control_data.reason_for_change = reason;Transaction.editing_control_data.SaveControlChanges();Transaction.GetTransactionList(Transaction.current_page);}else {if(!Transaction.editing_payment_method_data.Validate()){Utilities.Toggle_Loading_Button("change_transaction_save",false);return;}Transaction.editing_payment_method_data.reason_for_change = reason;Transaction.editing_payment_method_data.SaveChanges();Transaction.GetTransactionList(Transaction.current_page);}}Transaction.SaveChanges = SaveChanges;function GetAllNames(){var path=Transaction.GetPath();return Utilities.Get(path + "API/Transaction/GetAllNames");}Transaction.GetAllNames = GetAllNames;function GetDepositCount(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){var name,path;return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:Utilities.Hide("createDepositButton");Utilities.Set_Value("depositCount","0");name = Utilities.Get_Value("depositNameFilter");if(!(name.length === 0)){context$3$0.next = 5;break;}return context$3$0.abrupt("return");case 5:path = Transaction.GetPath();context$3$0.next = 8;return Utilities.Get_Empty(path + "API/Transaction/GetDepositCount?name=" + name).then(function(response_text){var count=parseInt(response_text);Utilities.Set_Value("depositCount",response_text);if(count > 0){Utilities.Show("createDepositButton");}});case 8:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Transaction.GetDepositCount = GetDepositCount;function CreateDeposit(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$2$0(){return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1) switch(context$3$0.prev = context$3$0.next){case 0:Utilities.Toggle_Loading_Button("createDepositButton",true);context$3$0.next = 3;return GetDepositCount().then(function(){var count=parseInt(Utilities.Get_Value("depositCount"));if(!isNaN(count) && count > 0){var _name2=Utilities.Get_Value("depositNameFilter");var path=Transaction.GetPath();Utilities.Post(path + "API/Transaction/CreateDeposit?selected_user_display_name=" + _name2,null).then(function(transaction){var transaction_id=transaction.transaction_id;Transaction.ShowReceiptDetail(transaction_id);Transaction.GetTransactionList(Transaction.current_page,false);Utilities.Toggle_Loading_Button("createDepositButton",false);},function(error){console.log("error!",error);Utilities.Toggle_Loading_Button("createDepositButton",false);});}else {Utilities.Toggle_Loading_Button("createDepositButton",false);alert("The Receipts ready for deposit was updated, a deposit can not be created at this time.");return;}});case 3:case "end":return context$3$0.stop();}},callee$2$0,this);}));}Transaction.CreateDeposit = CreateDeposit;})(Transaction || (Transaction = {})); //# sourceMappingURL=app.js.map
var Utilities;(function(Utilities){var LevelItem=function LevelItem(Heading,TitleText,Title){var _classes;_classCallCheck(this,LevelItem);this.classes = [];this.heading = "";this.title = null;this.title_text = "";this.heading = Heading;this.title = Title;if(TitleText.length > 0){this.title_text = TitleText;this.title = null;}for(var _len=arguments.length,Classes=Array(_len > 3?_len - 3:0),_key=3;_key < _len;_key++) {Classes[_key - 3] = arguments[_key];}if(Classes.length > 0)(_classes = this.classes).push.apply(_classes,Classes);};Utilities.LevelItem = LevelItem;})(Utilities || (Utilities = {})); //# sourceMappingURL=LevelItem.js.map
var Transaction;(function(Transaction){var ControlGroup=(function(){function ControlGroup(){_classCallCheck(this,ControlGroup);this.percent_used = 0;this.controls = [];}_createClass(ControlGroup,[{key:"CreateControlData",value:function CreateControlData(target_container){var clone_node=arguments.length <= 1 || arguments[1] === undefined?true:arguments[1];var control_data=[];var group_element=document.createElement("div");group_element.classList.add("columns","is-multiline");target_container.appendChild(group_element);var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=this.controls[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done);_iteratorNormalCompletion11 = true) {var control=_step11.value;var cd=new Transaction.Data.ControlData(control,-1,clone_node);control_data.push(cd);group_element.appendChild(cd.container_element);}}catch(err) {_didIteratorError11 = true;_iteratorError11 = err;}finally {try{if(!_iteratorNormalCompletion11 && _iterator11["return"]){_iterator11["return"]();}}finally {if(_didIteratorError11){throw _iteratorError11;}}}return control_data;}}],[{key:"CreateControlGroups",value:function CreateControlGroups(controls){var controlgroups=[];var controlGroup=new ControlGroup();var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=controls[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done);_iteratorNormalCompletion12 = true) {var control=_step12.value;if(control.is_active){control.rendered_input_element = Transaction.Control.CreateControl(control);controlGroup.controls.push(control);}}}catch(err) {_didIteratorError12 = true;_iteratorError12 = err;}finally {try{if(!_iteratorNormalCompletion12 && _iterator12["return"]){_iterator12["return"]();}}finally {if(_didIteratorError12){throw _iteratorError12;}}}controlgroups.push(controlGroup);return controlgroups;}},{key:"CreateSavedControlGroups",value:function CreateSavedControlGroups(controls){var controlgroups=[];var controlGroup=new ControlGroup();var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=controls[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done);_iteratorNormalCompletion13 = true) {var controldata=_step13.value;controldata.control.rendered_input_element = Transaction.Control.CreateSavedControl(controldata);controlGroup.controls.push(controldata.control);}}catch(err) {_didIteratorError13 = true;_iteratorError13 = err;}finally {try{if(!_iteratorNormalCompletion13 && _iterator13["return"]){_iterator13["return"]();}}finally {if(_didIteratorError13){throw _iteratorError13;}}}controlgroups.push(controlGroup);return controlgroups;}},{key:"CreateInputFieldContainerByControl",value:function CreateInputFieldContainerByControl(control,input){var add_column=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];var class_to_add=arguments.length <= 3 || arguments[3] === undefined?"":arguments[3];return this.CreateInputFieldContainer(input,control.label,add_column,control.render_hints);}},{key:"CreateInputFieldContainer",value:function CreateInputFieldContainer(input,field_label){var add_column=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];var class_to_add=arguments.length <= 3 || arguments[3] === undefined?"":arguments[3];var guide_message_capable=arguments.length <= 4 || arguments[4] === undefined?false:arguments[4];var editFunction=null;if(input.getAttribute("transaction_id") !== null){(function(){ // payment_method_data_id
// department id?
var transaction_id=input.getAttribute("transaction_id");var control_data_id=input.getAttribute("control_data_id");if(control_data_id !== null){editFunction = function(){Transaction.LoadControlDataChange(control_data_id,transaction_id,field_label);};}else {(function(){var payment_method_data_id=input.getAttribute("payment_method_data_id");var is_cash=input.getAttribute("is_cash").toLowerCase() === "true";editFunction = function(){Transaction.LoadPaymentTypeDataChange(payment_method_data_id,is_cash,transaction_id,field_label);};})();}})();}if(editFunction !== null){input.onclick = function(){editFunction();};}var field=document.createElement("div");field.classList.add("field");var label=document.createElement("label");label.classList.add("label",Transaction.app_input_size);if(field_label.length > 0){label.appendChild(document.createTextNode(field_label));}else {label.innerHTML = "&nbsp;";}field.appendChild(label);if(input.getAttribute("transaction_id") !== null){var edit=document.createElement("a");edit.style.marginLeft = ".5em";edit.style.fontSize = ".75em";edit.style.fontWeight = "400";edit.onclick = function(){editFunction();};edit.appendChild(document.createTextNode("edit"));label.appendChild(edit);}var control_element=document.createElement("div");control_element.classList.add("control");control_element.appendChild(input);field.appendChild(control_element);if(guide_message_capable){var guide_element=document.createElement("p");guide_element.classList.add("help","guide");field.appendChild(guide_element);}var error_element=document.createElement("p");error_element.classList.add("help","is-danger");field.appendChild(error_element);if(add_column){var column=document.createElement("div");column.classList.add("column");if(class_to_add.length > 0)column.classList.add(class_to_add);column.appendChild(field);return column;}if(class_to_add.length > 0)field.classList.add(class_to_add);return field;}},{key:"CreateButtonlistFieldContainer",value:function CreateButtonlistFieldContainer(inputs,field_label){var add_column=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];var class_to_add=arguments.length <= 3 || arguments[3] === undefined?"":arguments[3];var field=document.createElement("div");field.classList.add("field");var label=document.createElement("label");label.classList.add("label",Transaction.app_input_size);if(field_label.length > 0){label.appendChild(document.createTextNode(field_label));}else {label.innerHTML = "&nbsp;";}field.appendChild(label);var control=document.createElement("div");control.classList.add("control");var buttonlist=document.createElement("div");buttonlist.classList.add("buttons");var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=inputs[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14 = (_step14 = _iterator14.next()).done);_iteratorNormalCompletion14 = true) {var input=_step14.value;buttonlist.appendChild(input);}}catch(err) {_didIteratorError14 = true;_iteratorError14 = err;}finally {try{if(!_iteratorNormalCompletion14 && _iterator14["return"]){_iterator14["return"]();}}finally {if(_didIteratorError14){throw _iteratorError14;}}}control.appendChild(buttonlist);field.appendChild(control);if(add_column){var column=document.createElement("div");column.classList.add("column");if(class_to_add.length > 0)column.classList.add(class_to_add);column.appendChild(field);return column;}if(class_to_add.length > 0)field.classList.add(class_to_add);return field;}},{key:"CreateSelectFieldContainerByControl",value:function CreateSelectFieldContainerByControl(control,select){var add_column=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];return this.CreateSelectFieldContainer(select,control.label,add_column,control.render_hints);}},{key:"CreateSelectFieldContainer",value:function CreateSelectFieldContainer(select,field_label){var add_column=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];var class_to_add=arguments.length <= 3 || arguments[3] === undefined?"":arguments[3];var field=document.createElement("div");field.classList.add("field");if(add_column){field.classList.add("column");if(class_to_add.length > 0)field.classList.add(class_to_add);}var label=document.createElement("label");label.classList.add("label","is-normal");label.appendChild(document.createTextNode(field_label));field.appendChild(label);if(select.getAttribute("transaction_id") !== null){(function(){var edit=document.createElement("a");edit.style.marginLeft = ".5em";edit.style.fontSize = ".75em";edit.style.fontWeight = "400";var transaction_id=select.getAttribute("transaction_id");var control_data_id=select.getAttribute("control_data_id");edit.onclick = function(){Transaction.LoadControlDataChange(control_data_id,transaction_id,field_label);};edit.appendChild(document.createTextNode("edit"));label.appendChild(edit);})();}var control_element=document.createElement("div");control_element.classList.add("control");var selectContainer=document.createElement("div");selectContainer.classList.add("select","is-normal");selectContainer.appendChild(select);control_element.appendChild(selectContainer);field.appendChild(control_element);var error_element=document.createElement("p");error_element.classList.add("help","is-danger");field.appendChild(error_element);return field;}},{key:"CreateInput",value:function CreateInput(input_type,input_length,is_required,placeholder){var input_value=arguments.length <= 4 || arguments[4] === undefined?"":arguments[4];var input=document.createElement("input");input.type = input_type;input.maxLength = input_length;input.classList.add("input","is-normal");if(input.type === "number"){input.onwheel = function(e){e.preventDefault();};input.step = "0.01";input.min = "0";}input.placeholder = placeholder;input.required = is_required;input.value = input_value;return input;}},{key:"UpdateSelectError",value:function UpdateSelectError(container){var error_text=arguments.length <= 1 || arguments[1] === undefined?"":arguments[1];var error_element=container.querySelector("p.help.is-danger");var select_element=container.querySelector("div.select");if(error_text.length === 0){Utilities.Clear_Element(error_element);select_element.classList.remove("is-danger");}else {Utilities.Simple_Error_Show(error_element,error_text);select_element.classList.add("is-danger");if(!Transaction.error_scrolled){Transaction.error_scrolled = true;container.scrollIntoView(true);}}}},{key:"UpdateInputError",value:function UpdateInputError(input,container){var error_text=arguments.length <= 2 || arguments[2] === undefined?"":arguments[2];var error_element=container.querySelector("p.help.is-danger");if(error_text.length === 0){Utilities.Clear_Element(error_element);input.classList.remove("is-danger");}else {Utilities.Simple_Error_Show(error_element,error_text);input.classList.add("is-danger");if(!Transaction.error_scrolled){Transaction.error_scrolled = true;container.scrollIntoView(true);}}}},{key:"UpdateInputGuide",value:function UpdateInputGuide(container){var guide_text=arguments.length <= 1 || arguments[1] === undefined?"":arguments[1];var guide_element=container.querySelector("p.help.guide");if(guide_element === null){console.log('UpdateInputGuide called, no guide elements found',container,guide_text);return;}Utilities.Set_Text(guide_element,guide_text);}},{key:"ValidateDropdown",value:function ValidateDropdown(input,container,valid_values){var e="";if(input.value === "-1"){e = "You must choose one of these options.";}if(valid_values.indexOf(input.value) === -1 && e.length === 0){e = "Please select a valid value.";}ControlGroup.UpdateSelectError(container,e);return e.length === 0;}},{key:"ValidateDate",value:function ValidateDate(input,container){var e=""; //let input = <HTMLInputElement>this.input_element;
if(input.valueAsDate === null && input.required){e = "You must selected a date.";}ControlGroup.UpdateInputError(input,container,e);return e.length === 0;}},{key:"ValidateText",value:function ValidateText(input,container){var e="";if(input.required && input.value.length === 0){e = "This field is required.";}if(input.maxLength > 0 && input.value.length > input.maxLength && e.length === 0){e = "You entered " + input.value.length.toString() + " characters but " + input.maxLength.toString() + " is the maximum number of characters allowed.";}ControlGroup.UpdateInputError(input,container,e);return e.length === 0;}},{key:"ValidateNumber",value:function ValidateNumber(input,container){var e="";if(input.value.length === 0){e = "You must enter a number. (No commas or $ allowed).";}if(input.valueAsNumber === NaN && e.length === 0){e = "Please enter Numbers and Decimal points only.";}ControlGroup.UpdateInputError(input,container,e);return e.length === 0;}},{key:"ValidateCount",value:function ValidateCount(input,container){var e="";if(input.value.length === 0 && input.required){e = "You must enter a number. (No commas, decimal points, or $ allowed).";}if(input.valueAsNumber === NaN && e.length === 0){e = "Please enter Numbers only.";}if(input.valueAsNumber < 0){e = "This value must be 0 or greater.";}ControlGroup.UpdateInputError(input,container,e);return e.length === 0;}},{key:"ValidateMoney",value:function ValidateMoney(input,container){var e="";if(input.value.length === 0){e = "You must enter a number. (No commas or $ allowed).";}if(input.valueAsNumber === NaN && e.length === 0){e = "Please enter Numbers and Decimal points only.";}if(input.valueAsNumber < 0 && e.length === 0){e = "Negative numbers are not allowed.";}var i=input.value.split(".");if(i.length === 2 && e.length === 0){if(i[1].length > 2){e = "Too many digits after the decimal place. Amounts are limited to 2 digits after the decimal place.";}}ControlGroup.UpdateInputError(input,container,e);return e.length === 0;}}]);return ControlGroup;})();Transaction.ControlGroup = ControlGroup;})(Transaction || (Transaction = {})); //# sourceMappingURL=ControlGroup.js.map
var __awaiter=undefined && undefined.__awaiter || function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new (P || (P = Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e) {reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e) {reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator = generator.apply(thisArg,_arguments || [])).next());});};var Transaction;(function(Transaction){var Data;(function(Data){var PaymentMethodData=(function(){function PaymentMethodData(is_cash,show_cancel,element_id,payment_method_amount_change){if(show_cancel === undefined)show_cancel = false;var saved_payment_method_data=arguments.length <= 4 || arguments[4] === undefined?null:arguments[4];_classCallCheck(this,PaymentMethodData);this.payment_method_data_id = -1;this.prior_payment_method_data_id = -1;this.transaction_payment_type_id = -1;this.transaction_id = -1;this.cash_amount = 0;this.check_amount = 0;this.check_count = 0;this.check_number = "";this.check_from = "";this.paying_for = "";this.is_active = true;this.added_after_save = false;this.modified_by = "";this.modified_on = new Date();this.reason_for_change = "";this.error_text = ""; //client side specific properties
this.is_cash = false;this.show_cancel = false;this.cash_amount_input_element = null;this.cash_amount_input_element_container = null;this.check_amount_input_element = null;this.check_amount_input_element_container = null;this.check_count_input_element = null;this.check_count_input_element_container = null;this.check_number_input_element = null;this.check_number_input_element_container = null;this.paying_for_input_element = null;this.paying_for_input_element_container = null;this.check_from_input_element = null;this.check_from_input_element_container = null;this.add_check_button_element = null;this.cancel_check_button_element = null;this.check_buttons_container_element = null;this.payment_method_change = function(){};this.validate_money_regex = "(?=.*?\d)^\$?(([1-9]\d{0,2}(,\d{3})*)|\d+)?(\.\d{1,2})?$";this.control_to_render = null;this.is_cash = is_cash;this.show_cancel = show_cancel;this.payment_method_data_id = element_id;this.payment_method_change = payment_method_amount_change;is_cash?this.RenderCashControls(saved_payment_method_data):this.RenderCheckControls(saved_payment_method_data);}_createClass(PaymentMethodData,[{key:"Validate",value:function Validate(){if(this.is_cash)return this.ValidateCash();return this.ValidateCheck();}},{key:"ValidateCash",value:function ValidateCash(){var is_valid=true;var v=this.ValidateCashAmount();if(!v && is_valid)is_valid = v; //v = this.ValidatePayingFor();
//if (!v && is_valid) is_valid = v;
return is_valid;}},{key:"ValidateCashAmount",value:function ValidateCashAmount(){return Transaction.ControlGroup.ValidateMoney(this.cash_amount_input_element,this.cash_amount_input_element_container);}},{key:"ValidateCheck",value:function ValidateCheck(){var is_valid=true;var v=this.ValidateCheckAmount();if(!v && is_valid)is_valid = v;v = this.ValidateCheckCount();if(!v && is_valid)is_valid = v;v = this.ValidateCheckNumber();if(!v && is_valid)is_valid = v;v = this.ValidateCheckFrom();if(!v && is_valid)is_valid = v;v = this.ValidatePayingFor();if(!v && is_valid)is_valid = v;return is_valid;}},{key:"ValidateCheckAmount",value:function ValidateCheckAmount(){return Transaction.ControlGroup.ValidateMoney(this.check_amount_input_element,this.check_amount_input_element_container);}},{key:"ValidateCheckCount",value:function ValidateCheckCount(){return Transaction.ControlGroup.ValidateCount(this.check_count_input_element,this.check_count_input_element_container);}},{key:"ValidateCheckNumber",value:function ValidateCheckNumber(){var input=this.check_number_input_element;var e="";if(input.value.length > 0 && this.check_amount === 0){e = "This field should only be used if a check is entered.";}if(input.value.length === 0 && this.check_amount > 0 && this.check_count === 1){e = "A check number is required when you enter a check amount and set the check count to 1 check.";}if(input.value.length > 50){e = "The check number can be at most 50 characters long.";}Transaction.ControlGroup.UpdateInputError(this.check_number_input_element,this.check_number_input_element_container,e);return e.length === 0;}},{key:"ValidatePayingFor",value:function ValidatePayingFor(){var input=this.paying_for_input_element;var e="";if(input.value.length > 0 && this.check_amount === 0){e = "This field should only be used if a check amount is entered.";}if(input.value.length > 500){e = "This field can be at most 500 characters long.";}Transaction.ControlGroup.UpdateInputError(this.paying_for_input_element,this.paying_for_input_element_container,e);return e.length === 0;}},{key:"ValidateCheckFrom",value:function ValidateCheckFrom(){var input=this.check_from_input_element;var e="";if(input.value.length > 0 && this.check_amount === 0){e = "This field should only be used if a check amount is entered.";}if(input.value.length === 0 && this.check_amount > 0 && this.check_count === 1){e = "This field is required if you enter a check amount and set the check count to 1 check.";}if(input.value.length > 500){e = "This field can be at most 500 characters long.";}Transaction.ControlGroup.UpdateInputError(this.check_from_input_element,this.check_from_input_element_container,e);return e.length === 0;}},{key:"RenderCashControls",value:function RenderCashControls(payment_method_data){var _this=this;var columns=document.createElement("div");columns.classList.add("columns");this.cash_amount_input_element = Transaction.ControlGroup.CreateInput("number",15,true,"0");if(payment_method_data === null){this.cash_amount_input_element.oninput = function(event){_this.cash_amount = 0;if(_this.ValidateCashAmount()){_this.cash_amount = _this.cash_amount_input_element.valueAsNumber;}_this.payment_method_change();};}else {this.cash_amount_input_element.value = payment_method_data.cash_amount.toString();this.cash_amount_input_element.setAttribute("payment_method_data_id",payment_method_data.payment_method_data_id.toString());this.cash_amount_input_element.setAttribute("transaction_id",payment_method_data.transaction_id.toString());this.cash_amount_input_element.setAttribute("is_cash","true");}this.cash_amount_input_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.cash_amount_input_element,"Cash Amount",true,"is-one-quarter");columns.appendChild(this.cash_amount_input_element_container);this.control_to_render = columns;}},{key:"RenderCheckControls",value:function RenderCheckControls(payment_method_data){var _this2=this;var columns=document.createElement("div");columns.classList.add("columns","is-multiline","check");this.check_amount_input_element = Transaction.ControlGroup.CreateInput("number",15,false,"0");if(payment_method_data === null){this.check_amount_input_element.oninput = function(event){_this2.check_amount = 0;if(_this2.ValidateCheckAmount()){_this2.check_amount = _this2.check_amount_input_element.valueAsNumber;if(_this2.check_amount > 0){Utilities.Show_Flex(_this2.check_buttons_container_element);_this2.check_count_input_element.required = true;}else {Utilities.Hide(_this2.check_buttons_container_element);_this2.check_count_input_element.required = false;}}_this2.payment_method_change();};}else {this.check_amount_input_element.readOnly = true;this.check_amount_input_element.value = payment_method_data.check_amount.toString();this.check_amount_input_element.setAttribute("payment_method_data_id",payment_method_data.payment_method_data_id.toString());this.check_amount_input_element.setAttribute("transaction_id",payment_method_data.transaction_id.toString());this.check_amount_input_element.setAttribute("is_cash","false");}this.check_count_input_element = Transaction.ControlGroup.CreateInput("number",5,false,"# of Checks");this.check_count_input_element.step = "1";this.check_count_input_element.min = "0";if(payment_method_data === null){this.check_count_input_element.oninput = function(event){if(_this2.ValidateCheckCount()){_this2.check_count = event.target.valueAsNumber;if(_this2.check_amount > 0){switch(_this2.check_count){case 0:Transaction.ControlGroup.UpdateInputGuide(_this2.check_count_input_element_container,"Partial Check");break;case 1:Transaction.ControlGroup.UpdateInputGuide(_this2.check_count_input_element_container,"Single Check");break;default:Transaction.ControlGroup.UpdateInputGuide(_this2.check_count_input_element_container,"Bulk Check");}}else {Transaction.ControlGroup.UpdateInputGuide(_this2.check_count_input_element_container,"");}}else {Transaction.ControlGroup.UpdateInputGuide(_this2.check_count_input_element_container,"");}_this2.payment_method_change();};}else {this.check_count_input_element.readOnly = true;this.check_count_input_element.value = payment_method_data.check_count.toString();this.check_count_input_element.setAttribute("payment_method_data_id",payment_method_data.payment_method_data_id.toString());this.check_count_input_element.setAttribute("transaction_id",payment_method_data.transaction_id.toString());this.check_count_input_element.setAttribute("is_cash","false");}this.check_number_input_element = Transaction.ControlGroup.CreateInput("text",50,false,"Check Number");if(payment_method_data === null){this.check_number_input_element.oninput = function(event){if(_this2.ValidateCheckNumber()){_this2.check_number = event.target.value;}};}else {this.check_number_input_element.readOnly = true;this.check_number_input_element.value = payment_method_data.check_number;this.check_number_input_element.setAttribute("payment_method_data_id",payment_method_data.payment_method_data_id.toString());this.check_number_input_element.setAttribute("transaction_id",payment_method_data.transaction_id.toString());this.check_number_input_element.setAttribute("is_cash","false");}this.paying_for_input_element = Transaction.ControlGroup.CreateInput("text",500,false,"Check Paying For");if(payment_method_data === null){this.paying_for_input_element.oninput = function(event){if(_this2.ValidatePayingFor()){_this2.paying_for = event.target.value;}};}else {this.paying_for_input_element.readOnly = true;this.paying_for_input_element.value = payment_method_data.paying_for;this.paying_for_input_element.setAttribute("payment_method_data_id",payment_method_data.payment_method_data_id.toString());this.paying_for_input_element.setAttribute("transaction_id",payment_method_data.transaction_id.toString());this.paying_for_input_element.setAttribute("is_cash","false");}this.check_from_input_element = Transaction.ControlGroup.CreateInput("text",500,false,"Check From");if(payment_method_data === null){this.check_from_input_element.oninput = function(event){if(_this2.ValidateCheckFrom()){_this2.check_from = event.target.value;}};}else {this.check_from_input_element.readOnly = true;this.check_from_input_element.value = payment_method_data.check_from;this.check_from_input_element.setAttribute("payment_method_data_id",payment_method_data.payment_method_data_id.toString());this.check_from_input_element.setAttribute("transaction_id",payment_method_data.transaction_id.toString());this.check_from_input_element.setAttribute("is_cash","false");}this.add_check_button_element = document.createElement("button");this.add_check_button_element.classList.add("button","is-info",Transaction.app_input_size);this.add_check_button_element.appendChild(document.createTextNode("Add Another Check"));this.check_amount_input_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.check_amount_input_element,"Check Amount",true,"is-one-quarter");columns.appendChild(this.check_amount_input_element_container);this.check_count_input_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.check_count_input_element,"# of Checks",true,"is-2",true);columns.appendChild(this.check_count_input_element_container);this.check_number_input_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.check_number_input_element,"Check Number",true,"is-one-quarter");columns.appendChild(this.check_number_input_element_container);if(this.show_cancel){var buttons=[];this.cancel_check_button_element = document.createElement("button");this.cancel_check_button_element.classList.add("button","is-warning",Transaction.app_input_size);this.cancel_check_button_element.appendChild(document.createTextNode("Cancel Check"));buttons.push(this.add_check_button_element);buttons.push(this.cancel_check_button_element);this.check_buttons_container_element = Transaction.ControlGroup.CreateButtonlistFieldContainer(buttons,"",true,"is-one-quarter");}else {this.check_buttons_container_element = Transaction.ControlGroup.CreateInputFieldContainer(this.add_check_button_element,"",true,"is-one-quarter");if(payment_method_data === null){this.check_buttons_container_element.classList.add("hide");}}columns.appendChild(this.check_buttons_container_element);this.paying_for_input_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.paying_for_input_element,"Paying For",true,"is-half");if(payment_method_data === null){this.paying_for_input_element_container.style.display = "none";}columns.appendChild(this.paying_for_input_element_container);this.check_from_input_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.check_from_input_element,"Check From",true,"is-half");columns.appendChild(this.check_from_input_element_container);this.control_to_render = columns;}},{key:"SaveChanges",value:function SaveChanges(){var _this3=this;var path=Transaction.GetPath();Utilities.Post_Empty(path + "API/Transaction/EditPaymentMethod",this).then(function(response){response.text().then(function(text){if(text.length === 0) // success!
{Transaction.CloseChangeModal();Transaction.ShowReceiptDetail(_this3.transaction_id);Transaction.editing_control_data = null;Transaction.editing_payment_method_data = null;Transaction.GetTransactionList(Transaction.current_page,false);}else {alert("There was a problem saving this change." + '\r\n' + response);}Utilities.Toggle_Loading_Button("change_transaction_save",false);});});}}],[{key:"GetHistory",value:function GetHistory(payment_method_data_id,transaction_id){var path=Transaction.GetPath();return Utilities.Get(path + "API/Transaction/GetPaymentMethodHistory?payment_method_data_id=" + payment_method_data_id + "&transaction_id=" + transaction_id);}},{key:"GetAndDisplayHistory",value:function GetAndDisplayHistory(payment_method_data_id,transaction_id,is_cash){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$4$0(){return regeneratorRuntime.wrap(function callee$4$0$(context$5$0){while(1) switch(context$5$0.prev = context$5$0.next){case 0:context$5$0.next = 2;return PaymentMethodData.GetHistory(payment_method_data_id,transaction_id).then(function(history){PaymentMethodData.MarkDataToEdit(history,is_cash);PaymentMethodData.DisplayHistory(history,is_cash);PaymentMethodData.DisplayEdit();});case 2:case "end":return context$5$0.stop();}},callee$4$0,this);}));}},{key:"MarkDataToEdit",value:function MarkDataToEdit(payment_method_data,is_cash){Transaction.editing_control_data = null;Transaction.editing_payment_method_data = null;var filtered=payment_method_data.filter(function(x){return x.is_active;});if(filtered.length === 1){var p=filtered[0];var pmd=new Data.PaymentMethodData(is_cash,false,p.payment_method_data_id,function(){});pmd.payment_method_data_id = p.payment_method_data_id;pmd.transaction_id = p.transaction_id;pmd.transaction_payment_type_id = p.transaction_payment_type_id;pmd.prior_payment_method_data_id = p.prior_payment_method_data_id;pmd.is_active = true;if(is_cash){pmd.cash_amount = p.cash_amount;pmd.cash_amount_input_element.valueAsNumber = p.cash_amount;}else {pmd.check_amount = p.check_amount;pmd.check_amount_input_element.valueAsNumber = p.check_amount;pmd.check_count = p.check_count;pmd.check_count_input_element.valueAsNumber = p.check_count;pmd.check_from = p.check_from;pmd.check_from_input_element.value = p.check_from;pmd.check_number = p.check_number;pmd.check_number_input_element.value = p.check_number;pmd.paying_for = p.paying_for;pmd.paying_for_input_element.value = p.paying_for;}Transaction.editing_payment_method_data = pmd;}else {alert("Invalid data stored in database for this transaction.");}}},{key:"DisplayEdit",value:function DisplayEdit(){if(Transaction.editing_payment_method_data === null)return;var container=document.getElementById(Transaction.change_edit_container);Utilities.Clear_Element(container);container.classList.remove("columns");var e=Transaction.editing_payment_method_data;Utilities.Clear_Element(e.check_buttons_container_element);container.appendChild(e.control_to_render);Utilities.Set_Value(Transaction.reason_for_change_input,"");}},{key:"CreateCashHistoryHeader",value:function CreateCashHistoryHeader(){var tr=document.createElement("tr");tr.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%"));tr.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","15%"));tr.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","20%"));tr.appendChild(Utilities.CreateTableCell("th","Cash Amount","has-text-right","15%"));tr.appendChild(Utilities.CreateTableCell("th","","","35%"));return tr;}},{key:"CreateCheckHistoryHeader",value:function CreateCheckHistoryHeader(){var tr=document.createElement("tr");tr.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%"));tr.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","10%"));tr.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","15%"));tr.appendChild(Utilities.CreateTableCell("th","Check Amount","has-text-right","15%"));tr.appendChild(Utilities.CreateTableCell("th","Check Count","has-text-centered","10%"));tr.appendChild(Utilities.CreateTableCell("th","Check #","has-text-left","10%"));tr.appendChild(Utilities.CreateTableCell("th","Check From","has-text-left","10%"));tr.appendChild(Utilities.CreateTableCell("th","Paying For","has-text-left","15%"));return tr;}},{key:"DisplayHistory",value:function DisplayHistory(payment_method_data,is_cash){var header=document.getElementById(Transaction.change_transaction_history_table_header);Utilities.Clear_Element(header);if(is_cash){header.appendChild(PaymentMethodData.CreateCashHistoryHeader());}else {header.appendChild(PaymentMethodData.CreateCheckHistoryHeader());}var body=document.getElementById(Transaction.change_transaction_history_table_body);Utilities.Clear_Element(body);var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=payment_method_data[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15 = (_step15 = _iterator15.next()).done);_iteratorNormalCompletion15 = true) {var pmd=_step15.value;if(is_cash){body.appendChild(PaymentMethodData.CreateCashHistoryRow(pmd));}else {body.appendChild(PaymentMethodData.CreateCheckHistoryRow(pmd));}}}catch(err) {_didIteratorError15 = true;_iteratorError15 = err;}finally {try{if(!_iteratorNormalCompletion15 && _iterator15["return"]){_iterator15["return"]();}}finally {if(_didIteratorError15){throw _iteratorError15;}}}}},{key:"CreateCashHistoryRow",value:function CreateCashHistoryRow(data){var tr=document.createElement("tr");if(new Date(data.modified_on).getFullYear() < 1000){var original=Utilities.CreateTableCell("td","Original Value","has-text-centered");original.colSpan = 3;tr.appendChild(original);}else {tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(data.modified_on),"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",data.modified_by,"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",data.reason_for_change,"has-text-left"));}tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(data.cash_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td","","","35%"));return tr;}},{key:"CreateCheckHistoryRow",value:function CreateCheckHistoryRow(data){var tr=document.createElement("tr");if(new Date(data.modified_on).getFullYear() < 1000){var original=Utilities.CreateTableCell("td","Original Value","has-text-centered");original.colSpan = 3;tr.appendChild(original);}else {tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(data.modified_on),"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",data.modified_by,"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",data.reason_for_change,"has-text-left"));}tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(data.check_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",data.check_count.toString(),"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",data.check_number,"has-text-left"));tr.appendChild(Utilities.CreateTableCell("td",data.check_from,"has-text-left"));tr.appendChild(Utilities.CreateTableCell("td",data.paying_for,"has-text-left"));return tr;}}]);return PaymentMethodData;})();Data.PaymentMethodData = PaymentMethodData;})(Data = Transaction.Data || (Transaction.Data = {}));})(Transaction || (Transaction = {})); //# sourceMappingURL=PaymentMethodData.js.map
var Transaction;(function(Transaction){var PaymentType=(function(){function PaymentType(){_classCallCheck(this,PaymentType);this.control_groups = [];}_createClass(PaymentType,[{key:"Constructor",value:function Constructor(){}}]);return PaymentType;})();Transaction.PaymentType = PaymentType;})(Transaction || (Transaction = {})); //# sourceMappingURL=PaymentType.js.map
var Transaction;(function(Transaction){var Control=(function(){function Control(){_classCallCheck(this,Control);this.rendered_input_element = null;this.valid_values = [];this.is_printed = false;}_createClass(Control,[{key:"Constructor",value:function Constructor(){}}],[{key:"CreateControl",value:function CreateControl(control){var value=arguments.length <= 1 || arguments[1] === undefined?null:arguments[1];switch(control.data_type){case "date":case "text":return Control.CreateInput(control,value);case "number":case "money":case "count":return Control.CreateNumericInput(control,value);case "bigtext":return Control.CreateTextArea(control,value);case "dropdown":return Control.CreateSelect(control,value);}return null;}},{key:"CreateSavedControl",value:function CreateSavedControl(control_data){var control=Control.CreateControl(control_data.control,control_data.value);if(control.tagName.toLowerCase() !== "select"){control.readOnly = true;}else {control.disabled = true;}control.setAttribute("control_data_id",control_data.control_data_id.toString());control.setAttribute("transaction_id",control_data.transaction_id.toString());return control;}},{key:"CreateInput",value:function CreateInput(control,value){var input=document.createElement("input");input.type = control.data_type;input.maxLength = control.max_length;input.classList.add("input",Transaction.app_input_size);input.placeholder = control.label;input.required = control.required;if(input.type === "date" && value !== null){var tmp=value.split("/");if(tmp.length === 3){var v=tmp[2] + '-';v += tmp[0].length === 1?"0" + tmp[0]:tmp[0];v += "-";v += tmp[1].length === 1?"0" + tmp[1]:tmp[1];input.value = v;}else {input.value = value; // dates need to be in yyyy-mm-dd format
}}else {input.value = value === null?"":value;}input.setAttribute("control_id",control.control_id.toString());return input;}},{key:"CreateNumericInput",value:function CreateNumericInput(control,value){var input=document.createElement("input");input.type = "number";input.maxLength = control.max_length;input.classList.add("input",Transaction.app_input_size);input.placeholder = "0";input.required = control.required;if(control.data_type === "count"){input.step = "1";input.min = "0";input.pattern = "[0-9]";}else {input.step = "any";}input.value = value === null?"":value;input.setAttribute("control_id",control.control_id.toString());return input;}},{key:"CreateTextArea",value:function CreateTextArea(control,value){var textarea=document.createElement("textarea");textarea.maxLength = control.max_length;textarea.classList.add("textarea",Transaction.app_input_size);textarea.placeholder = control.label;textarea.required = control.required;textarea.rows = 4;textarea.value = value === null?"":value;textarea.setAttribute("control_id",control.control_id.toString());return textarea;}},{key:"CreateSelect",value:function CreateSelect(control,value){control.valid_values = control.value.split("|");var select=document.createElement("select");select.required = control.required;select.appendChild(Utilities.Create_Option("-1","Select a " + control.label,false));var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=control.valid_values[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16 = (_step16 = _iterator16.next()).done);_iteratorNormalCompletion16 = true) {var valid_value=_step16.value;var option=Utilities.Create_Option(valid_value,valid_value,false);select.appendChild(option);}}catch(err) {_didIteratorError16 = true;_iteratorError16 = err;}finally {try{if(!_iteratorNormalCompletion16 && _iterator16["return"]){_iterator16["return"]();}}finally {if(_didIteratorError16){throw _iteratorError16;}}}if(value !== null){select.value = value;}else {select.value = "-1";}return select;}}]);return Control;})();Transaction.Control = Control;})(Transaction || (Transaction = {})); //# sourceMappingURL=Control.js.map
var Transaction;(function(Transaction){var Department=(function(){function Department(){_classCallCheck(this,Department);this.organization = "";this.payment_types = [];this.controls = [];this.control_groups = [];}_createClass(Department,[{key:"Constructor",value:function Constructor(){}}],[{key:"GetDepartments",value:function GetDepartments(){var path=Transaction.GetPath();return Utilities.Get(path + "API/Transaction/Departments");}},{key:"CreateDepartmentElement",value:function CreateDepartmentElement(departments){var select=document.createElement("select");var defaultOption=document.createElement("option");defaultOption.selected = true;defaultOption.value = "-1";defaultOption.appendChild(document.createTextNode("Select a Department"));select.appendChild(defaultOption);var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=departments[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17 = (_step17 = _iterator17.next()).done);_iteratorNormalCompletion17 = true) {var d=_step17.value;if(d.is_active){var option=document.createElement("option");option.appendChild(document.createTextNode(d.name));option.value = d.department_id.toString();select.appendChild(option);}}}catch(err) {_didIteratorError17 = true;_iteratorError17 = err;}finally {try{if(!_iteratorNormalCompletion17 && _iterator17["return"]){_iterator17["return"]();}}finally {if(_didIteratorError17){throw _iteratorError17;}}}select.selectedIndex = -1;return select;}},{key:"CreateDepartmentElementLevel",value:function CreateDepartmentElementLevel(department){var level=document.createElement("div");level.classList.add("level");var left=document.createElement("div");left.classList.add("level-left");var outer=document.createElement("div");outer.classList.add("level-item","has-text-centered");var inner=document.createElement("div");var heading=document.createElement("p");heading.classList.add("heading");heading.appendChild(document.createTextNode("Select Department"));var selectContainer=document.createElement("div");selectContainer.classList.add("select");selectContainer.appendChild(department);inner.appendChild(heading);inner.appendChild(selectContainer);outer.appendChild(inner);left.appendChild(outer);level.appendChild(left);return level;}},{key:"CreateDepartmentElementField",value:function CreateDepartmentElementField(department){return Transaction.ControlGroup.CreateSelectFieldContainer(department,"Department",true,"is-one-half"); //let field = document.createElement("div");
//field.classList.add("field");
//let label = document.createElement("label");
//label.classList.add("label", Transaction.app_input_size);
//label.appendChild(document.createTextNode("Department"));
//field.appendChild(label);
//let control = document.createElement("div");
//control.classList.add("control");
//let selectContainer = document.createElement("div");
//selectContainer.classList.add("select", Transaction.app_input_size);
//selectContainer.appendChild(department);
//control.appendChild(selectContainer);
//field.appendChild(control);
//return field;
}},{key:"FindDepartment",value:function FindDepartment(department_id){var filtered=Transaction.departments.filter(function(d){return d.department_id === department_id;});return filtered.length === 1?filtered[0]:null;}}]);return Department;})();Transaction.Department = Department;})(Transaction || (Transaction = {})); //# sourceMappingURL=Department.js.map
var __awaiter=undefined && undefined.__awaiter || function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new (P || (P = Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e) {reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e) {reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator = generator.apply(thisArg,_arguments || [])).next());});};var Transaction;(function(Transaction){var Data;(function(Data){var ControlData=(function(){function ControlData(control,payment_type_id,clone_node){var _this4=this;_classCallCheck(this,ControlData);this.control_data_id = -1;this.prior_control_data_id = -1;this.transaction_payment_type_id = -1;this.department_id = -1;this.transaction_id = -1;this.control_id = -1;this.control = null;this.payment_type_id = -1;this.payment_type_index = -1;this.value = "";this.is_active = true;this.modified_on = new Date();this.modified_by = "";this.reason_for_change = "";this.error_text = ""; // client side controls
this.selected_control = null;this.input_element = null;this.container_element = null;var saved_control_data_id=control.rendered_input_element?control.rendered_input_element.getAttribute("control_data_id"):null;this.selected_control = control;this.control_id = control.control_id;if(clone_node){this.input_element = control.rendered_input_element.cloneNode(true);}else {this.input_element = control.rendered_input_element?control.rendered_input_element:Transaction.Control.CreateControl(control);}this.payment_type_id = payment_type_id;if(saved_control_data_id === null){var input=this.input_element;if(input.type === "number"){input.onwheel = function(e){e.preventDefault();};}this.input_element.oninput = function(event){var input=event.target;if(_this4.Validate()){switch(control.data_type){case "date":var d=input.valueAsDate;d.setMinutes(d.getTimezoneOffset());_this4.value = Utilities.Format_Date(d);break;case "number":_this4.value = input.valueAsNumber.toString();break;case "count":_this4.value = input.valueAsNumber.toString();input.value = input.valueAsNumber.toString();break;case "money":_this4.value = input.valueAsNumber.toString();break;default: // "bigtext", "text", "dropdown"
_this4.value = input.value;break;}}};}if(control.data_type === "dropdown"){this.container_element = Transaction.ControlGroup.CreateSelectFieldContainerByControl(control,this.input_element,true);}else {this.container_element = Transaction.ControlGroup.CreateInputFieldContainerByControl(control,this.input_element,true);}}_createClass(ControlData,[{key:"Validate",value:function Validate(){switch(this.selected_control.data_type){case "dropdown":return this.ValidateDropdown();case "count":return this.ValidateCount();case "date":return this.ValidateDate();case "number":return this.ValidateNumber();case "money":return this.ValidateMoney();case "text":case "bigtext":return this.ValidateText();default:return false;}}},{key:"ValidateDropdown",value:function ValidateDropdown(){return Transaction.ControlGroup.ValidateDropdown(this.input_element,this.container_element,this.selected_control.valid_values);}},{key:"ValidateDate",value:function ValidateDate(){return Transaction.ControlGroup.ValidateDate(this.input_element,this.container_element);}},{key:"ValidateText",value:function ValidateText(){return Transaction.ControlGroup.ValidateText(this.input_element,this.container_element);}},{key:"ValidateNumber",value:function ValidateNumber(){return Transaction.ControlGroup.ValidateNumber(this.input_element,this.container_element);}},{key:"ValidateCount",value:function ValidateCount(){return Transaction.ControlGroup.ValidateCount(this.input_element,this.container_element);}},{key:"ValidateMoney",value:function ValidateMoney(){return Transaction.ControlGroup.ValidateMoney(this.input_element,this.container_element);}},{key:"SaveControlChanges",value:function SaveControlChanges(){var _this5=this;var path=Transaction.GetPath();console.log('saving this control data',this);Utilities.Post(path + "API/Transaction/EditControls",this).then(function(response){if(response.length > 0){alert("There was a problem saving this change." + '\r\n' + response);}else {Transaction.CloseChangeModal();Transaction.ShowReceiptDetail(_this5.transaction_id);Transaction.editing_control_data = null;}Utilities.Toggle_Loading_Button("change_transaction_save",false);});}},{key:"SetErrorText",value:function SetErrorText(error_text){if(this.selected_control.data_type === "dropdown"){Transaction.ControlGroup.UpdateSelectError(this.container_element,error_text);}else {Transaction.ControlGroup.UpdateInputError(this.input_element,this.container_element,error_text);}}}],[{key:"GetControlHistory",value:function GetControlHistory(control_data_id,transaction_id){var path=Transaction.GetPath();return Utilities.Get(path + "API/Transaction/GetControlDataHistory?control_data_id=" + control_data_id + "&transaction_id=" + transaction_id);}},{key:"GetAndDisplayControlHistory",value:function GetAndDisplayControlHistory(control_data_id,transaction_id){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function callee$4$0(){return regeneratorRuntime.wrap(function callee$4$0$(context$5$0){while(1) switch(context$5$0.prev = context$5$0.next){case 0:context$5$0.next = 2;return ControlData.GetControlHistory(control_data_id,transaction_id).then(function(control_data_history){ControlData.MarkDataToEdit(control_data_history);ControlData.DisplayControlHistory(control_data_history);ControlData.DisplayControlToEdit();});case 2:case "end":return context$5$0.stop();}},callee$4$0,this);}));}},{key:"MarkDataToEdit",value:function MarkDataToEdit(control_data){Transaction.editing_control_data = null;Transaction.editing_payment_method_data = null;var filtered=control_data.filter(function(x){return x.is_active;});if(filtered.length === 1){var c=filtered[0];var cd=new Data.ControlData(c.control,c.payment_type_id,false);cd.transaction_payment_type_id = c.transaction_payment_type_id;cd.department_id = c.department_id;cd.is_active = c.is_active;cd.control_data_id = c.control_data_id;cd.transaction_id = c.transaction_id;cd.value = c.value;switch(c.control.data_type){case "date":if(c.value !== "" && c.value !== null){var tmp=c.value.split("/");if(tmp.length === 3){var v=tmp[2] + '-';v += tmp[0].length === 1?"0" + tmp[0]:tmp[0];v += "-";v += tmp[1].length === 1?"0" + tmp[1]:tmp[1];cd.input_element.value = v;}}break;default:cd.input_element.value = c.value;}cd.control = cd.selected_control;Transaction.editing_control_data = cd;}else {alert("Invalid data stored in database for this transaction.");}}},{key:"DisplayControlToEdit",value:function DisplayControlToEdit(){if(Transaction.editing_control_data === null)return;var container=document.getElementById(Transaction.change_edit_container);Utilities.Clear_Element(container);container.classList.add("columns");var e=Transaction.editing_control_data;container.appendChild(e.container_element);Utilities.Set_Value(Transaction.reason_for_change_input,"");}},{key:"CreateControlDataHistoryHeader",value:function CreateControlDataHistoryHeader(){var tr=document.createElement("tr");tr.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%"));tr.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","15%"));tr.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","20%"));tr.appendChild(Utilities.CreateTableCell("th","Value","has-text-left","50%"));return tr;}},{key:"DisplayControlHistory",value:function DisplayControlHistory(control_data){var header=document.getElementById(Transaction.change_transaction_history_table_header);Utilities.Clear_Element(header);header.appendChild(ControlData.CreateControlDataHistoryHeader());var body=document.getElementById(Transaction.change_transaction_history_table_body);Utilities.Clear_Element(body);var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=control_data[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18 = (_step18 = _iterator18.next()).done);_iteratorNormalCompletion18 = true) {var cd=_step18.value;body.appendChild(ControlData.CreateControlDataHistoryRow(cd));}}catch(err) {_didIteratorError18 = true;_iteratorError18 = err;}finally {try{if(!_iteratorNormalCompletion18 && _iterator18["return"]){_iterator18["return"]();}}finally {if(_didIteratorError18){throw _iteratorError18;}}}}},{key:"CreateControlDataHistoryRow",value:function CreateControlDataHistoryRow(control_data){var tr=document.createElement("tr");if(new Date(control_data.modified_on).getFullYear() < 1000){var original=Utilities.CreateTableCell("td","Original Value","has-text-centered");original.colSpan = 3;tr.appendChild(original);}else {tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(control_data.modified_on),"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",control_data.modified_by,"has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",control_data.reason_for_change,"has-text-left"));}tr.appendChild(Utilities.CreateTableCell("td",control_data.value,"has-text-left"));return tr;}}]);return ControlData;})();Data.ControlData = ControlData;})(Data = Transaction.Data || (Transaction.Data = {}));})(Transaction || (Transaction = {})); //# sourceMappingURL=ControlData.js.map
var Transaction;(function(Transaction){var Data;(function(Data){var PaymentTypeData=(function(){function PaymentTypeData(payment_type,target_container,payment_type_index){var saved_payment_type_data=arguments.length <= 3 || arguments[3] === undefined?null:arguments[3];_classCallCheck(this,PaymentTypeData);this.transaction_payment_type_id = -1;this.transaction_id = -1;this.payment_type_id = -1;this.payment_type_index = -1;this.payment_type = null;this.control_data = [];this.added_after_save = false;this.error_text = "";this.payment_method_data = []; //clientside controls
this.payment_type_parent_container = null;this.payment_type_container = null;this.selected_payment_type = null; // this is used by the new receipt process.  payment_type is used when you view an existing transaction.
this.cancel_payment_type_button = null;this.add_another_payment_type_button = null;this.save_button = null;this.control_groups = [];this.total_cash_element = null;this.total_checks_element = null;this.total_number_checks_element = null;this.next_payment_method_id = 0;this.selected_payment_type = payment_type;this.payment_type_parent_container = target_container;this.payment_type_id = payment_type.payment_type_id;this.payment_type_index = saved_payment_type_data !== null?saved_payment_type_data.payment_type_index:payment_type_index;var li=document.createElement("li");li.style.display = "block";this.payment_type_container = li;if(saved_payment_type_data !== null){this.transaction_payment_type_id = saved_payment_type_data.transaction_payment_type_id;this.transaction_id = saved_payment_type_data.transaction_id;this.RenderSavedPaymentTypeControls(li,saved_payment_type_data);this.RenderSavedPaymentMethods(li,saved_payment_type_data);}else {this.RenderPaymentTypeControls(li);this.RenderPaymentMethods(li);}this.RenderPaymentTypeFooter(li);if(saved_payment_type_data !== null)this.SavedPaymentMethodDataCalculateTotals(saved_payment_type_data.payment_method_data);this.payment_type_parent_container.appendChild(li);}_createClass(PaymentTypeData,[{key:"Validate",value:function Validate(){var is_valid=true;var _iteratorNormalCompletion19=true;var _didIteratorError19=false;var _iteratorError19=undefined;try{for(var _iterator19=this.control_data[Symbol.iterator](),_step19;!(_iteratorNormalCompletion19 = (_step19 = _iterator19.next()).done);_iteratorNormalCompletion19 = true) {var ct=_step19.value;var v=ct.Validate();if(!v && is_valid)is_valid = false;}}catch(err) {_didIteratorError19 = true;_iteratorError19 = err;}finally {try{if(!_iteratorNormalCompletion19 && _iterator19["return"]){_iterator19["return"]();}}finally {if(_didIteratorError19){throw _iteratorError19;}}}var _iteratorNormalCompletion20=true;var _didIteratorError20=false;var _iteratorError20=undefined;try{for(var _iterator20=this.payment_method_data[Symbol.iterator](),_step20;!(_iteratorNormalCompletion20 = (_step20 = _iterator20.next()).done);_iteratorNormalCompletion20 = true) {var pmt=_step20.value;var v=pmt.Validate();if(!v && is_valid)is_valid = false;}}catch(err) {_didIteratorError20 = true;_iteratorError20 = err;}finally {try{if(!_iteratorNormalCompletion20 && _iterator20["return"]){_iterator20["return"]();}}finally {if(_didIteratorError20){throw _iteratorError20;}}}return is_valid;}},{key:"RenderPaymentTypeControls",value:function RenderPaymentTypeControls(target_container){var _iteratorNormalCompletion21=true;var _didIteratorError21=false;var _iteratorError21=undefined;try{for(var _iterator21=this.selected_payment_type.control_groups[Symbol.iterator](),_step21;!(_iteratorNormalCompletion21 = (_step21 = _iterator21.next()).done);_iteratorNormalCompletion21 = true) {var _control_data;var group=_step21.value;(_control_data = this.control_data).push.apply(_control_data,_toConsumableArray(group.CreateControlData(target_container)));}}catch(err) {_didIteratorError21 = true;_iteratorError21 = err;}finally {try{if(!_iteratorNormalCompletion21 && _iterator21["return"]){_iterator21["return"]();}}finally {if(_didIteratorError21){throw _iteratorError21;}}}}},{key:"CreateHeaderButton",value:function CreateHeaderButton(label){var _button$classList;var button=document.createElement("button");button.appendChild(document.createTextNode(label));for(var _len2=arguments.length,classes=Array(_len2 > 1?_len2 - 1:0),_key2=1;_key2 < _len2;_key2++) {classes[_key2 - 1] = arguments[_key2];}(_button$classList = button.classList).add.apply(_button$classList,["button"].concat(classes));return button;}},{key:"RenderPaymentTypeFooter",value:function RenderPaymentTypeFooter(target_container){var items=[];this.total_cash_element = document.createElement("span");this.total_cash_element.classList.add("title");this.total_cash_element.appendChild(document.createTextNode("$0.00"));this.total_checks_element = document.createElement("span");this.total_checks_element.classList.add("title");this.total_checks_element.appendChild(document.createTextNode("$0.00"));this.total_number_checks_element = document.createElement("span");this.total_number_checks_element.classList.add("title");this.total_number_checks_element.appendChild(document.createTextNode("0"));items.push(new Utilities.LevelItem("Total Cash","",this.total_cash_element,"has-text-centered"));items.push(new Utilities.LevelItem("Total Checks","",this.total_checks_element,"has-text-centered"));items.push(new Utilities.LevelItem("# Checks","",this.total_number_checks_element,"has-text-centered"));this.add_another_payment_type_button = this.CreateHeaderButton("Add","is-info");this.cancel_payment_type_button = this.CreateHeaderButton("Cancel","is-warning");this.save_button = this.CreateHeaderButton("Preview & Save","is-success");var buttons=document.createElement("div");buttons.classList.add("buttons");buttons.appendChild(this.add_another_payment_type_button);buttons.appendChild(this.cancel_payment_type_button);buttons.appendChild(this.save_button);var right=[];right.push(new Utilities.LevelItem("","",buttons,"has-text-centered"));var heading=Utilities.Create_Centered_Level(items,[],right);heading.classList.add("has-background-grey-lighter");target_container.appendChild(heading);}},{key:"RenderPaymentMethods",value:function RenderPaymentMethods(target_container){var fieldset=document.createElement("fieldset");var legend=document.createElement("legend");legend.classList.add("label");legend.appendChild(document.createTextNode("Payment Methods"));fieldset.appendChild(legend);this.AddCashPaymentMethod(fieldset);this.AddCheckPaymentMethod(fieldset);target_container.appendChild(fieldset);}},{key:"AddCheckPaymentMethod",value:function AddCheckPaymentMethod(target_container){var _this6=this;var show_cancel=arguments.length <= 1 || arguments[1] === undefined?false:arguments[1];var show_save=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];var check=new Data.PaymentMethodData(false,show_cancel,this.next_payment_method_id++,function(){_this6.PaymentMethodDataChanged();});target_container.appendChild(check.control_to_render);this.payment_method_data.push(check);if(show_save){Utilities.Set_Text(check.add_check_button_element,"Save this Check");check.add_check_button_element.classList.remove("is-info");check.add_check_button_element.classList.add("is-success");check.add_check_button_element.onclick = function(event){_this6.SavePaymentMethodData(check,check.add_check_button_element);};}else {check.add_check_button_element.onclick = function(event){_this6.AddCheckPaymentMethod(target_container,true,show_save);};}if(show_cancel){check.cancel_check_button_element.onclick = function(event){target_container.removeChild(check.control_to_render);var indextoremove=_this6.payment_method_data.findIndex(function(j){return j.payment_method_data_id === check.payment_method_data_id;});if(indextoremove > -1)_this6.payment_method_data.splice(indextoremove,1);check = null;_this6.PaymentMethodDataChanged();};}}},{key:"AddCashPaymentMethod",value:function AddCashPaymentMethod(target_container){var _this7=this;var cash=new Data.PaymentMethodData(true,false,this.next_payment_method_id++,function(){_this7.PaymentMethodDataChanged();});target_container.appendChild(cash.control_to_render);this.payment_method_data.push(cash);}},{key:"PaymentMethodDataChanged",value:function PaymentMethodDataChanged(){var cash=0;var checks=0;var number_checks=0;var _iteratorNormalCompletion22=true;var _didIteratorError22=false;var _iteratorError22=undefined;try{for(var _iterator22=this.payment_method_data[Symbol.iterator](),_step22;!(_iteratorNormalCompletion22 = (_step22 = _iterator22.next()).done);_iteratorNormalCompletion22 = true) {var pmt=_step22.value;cash += pmt.cash_amount;checks += pmt.check_amount;number_checks += pmt.check_count;}}catch(err) {_didIteratorError22 = true;_iteratorError22 = err;}finally {try{if(!_iteratorNormalCompletion22 && _iterator22["return"]){_iterator22["return"]();}}finally {if(_didIteratorError22){throw _iteratorError22;}}}this.total_cash_element.innerHTML = Utilities.Format_Amount(cash);this.total_checks_element.innerHTML = Utilities.Format_Amount(checks);this.total_number_checks_element.innerHTML = number_checks.toString();}},{key:"SavedPaymentMethodDataCalculateTotals",value:function SavedPaymentMethodDataCalculateTotals(payment_method_data){var cash=0;var checks=0;var number_checks=0;var _iteratorNormalCompletion23=true;var _didIteratorError23=false;var _iteratorError23=undefined;try{for(var _iterator23=payment_method_data[Symbol.iterator](),_step23;!(_iteratorNormalCompletion23 = (_step23 = _iterator23.next()).done);_iteratorNormalCompletion23 = true) {var pmt=_step23.value;cash += pmt.cash_amount;checks += pmt.check_amount;number_checks += pmt.check_count;}}catch(err) {_didIteratorError23 = true;_iteratorError23 = err;}finally {try{if(!_iteratorNormalCompletion23 && _iterator23["return"]){_iterator23["return"]();}}finally {if(_didIteratorError23){throw _iteratorError23;}}}this.total_cash_element.innerHTML = Utilities.Format_Amount(cash);this.total_checks_element.innerHTML = Utilities.Format_Amount(checks);this.total_number_checks_element.innerHTML = number_checks.toString();} /*
             * Render functions that are for Saved Transactions
             *
             */},{key:"RenderSavedPaymentTypeControls",value:function RenderSavedPaymentTypeControls(target_container,saved_payment_type_data){this.control_groups = Transaction.ControlGroup.CreateSavedControlGroups(saved_payment_type_data.control_data);var _iteratorNormalCompletion24=true;var _didIteratorError24=false;var _iteratorError24=undefined;try{for(var _iterator24=this.control_groups[Symbol.iterator](),_step24;!(_iteratorNormalCompletion24 = (_step24 = _iterator24.next()).done);_iteratorNormalCompletion24 = true) {var _control_data2;var group=_step24.value;(_control_data2 = this.control_data).push.apply(_control_data2,_toConsumableArray(group.CreateControlData(target_container,false)));}}catch(err) {_didIteratorError24 = true;_iteratorError24 = err;}finally {try{if(!_iteratorNormalCompletion24 && _iterator24["return"]){_iterator24["return"]();}}finally {if(_didIteratorError24){throw _iteratorError24;}}}}},{key:"RenderSavedPaymentMethods",value:function RenderSavedPaymentMethods(target_container,saved_payment_type_data){var fieldset=document.createElement("fieldset");var legend=document.createElement("legend");legend.classList.add("label");legend.appendChild(document.createTextNode("Payment Methods"));fieldset.appendChild(legend);var cash_payment_method_data=null;var check_payment_method_data=[];var payment_method_data_copy=[].concat(_toConsumableArray(saved_payment_type_data.payment_method_data)); // we have to sort this because we expect the first 0 amount to be cash.
// so we sort this as cash amount descending.
payment_method_data_copy.sort(function(a,b){return b.cash_amount - a.cash_amount;});do {var pmd=payment_method_data_copy.shift();if(pmd.check_amount > 0 || pmd.check_number.length > 0 || pmd.check_count > 0 || pmd.check_from.length > 0 || pmd.paying_for.length > 0){check_payment_method_data.push(pmd);}else {if(pmd.cash_amount > 0 || cash_payment_method_data === null){cash_payment_method_data = pmd;}else {check_payment_method_data.push(pmd);}}}while(payment_method_data_copy.length > 0);this.AddSavedCashPaymentMethod(fieldset,cash_payment_method_data);var _iteratorNormalCompletion25=true;var _didIteratorError25=false;var _iteratorError25=undefined;try{for(var _iterator25=check_payment_method_data[Symbol.iterator](),_step25;!(_iteratorNormalCompletion25 = (_step25 = _iterator25.next()).done);_iteratorNormalCompletion25 = true) {var cpmd=_step25.value;this.AddSavedCheckPaymentMethod(fieldset,cpmd);}}catch(err) {_didIteratorError25 = true;_iteratorError25 = err;}finally {try{if(!_iteratorNormalCompletion25 && _iterator25["return"]){_iterator25["return"]();}}finally {if(_didIteratorError25){throw _iteratorError25;}}}target_container.appendChild(fieldset);}},{key:"AddSavedCheckPaymentMethod",value:function AddSavedCheckPaymentMethod(target_container,payment_method_data){var _this8=this;var check=new Data.PaymentMethodData(false,false,this.next_payment_method_id++,null,payment_method_data);target_container.appendChild(check.control_to_render);this.payment_method_data.push(check);check.add_check_button_element.onclick = function(event){_this8.AddCheckPaymentMethod(target_container,true,true);};}},{key:"AddSavedCashPaymentMethod",value:function AddSavedCashPaymentMethod(target_container,payment_method_data){var cash=new Data.PaymentMethodData(true,false,this.next_payment_method_id++,null,payment_method_data);target_container.appendChild(cash.control_to_render);this.payment_method_data.push(cash);}},{key:"SavePaymentMethodData",value:function SavePaymentMethodData(check,button){var _this9=this;Utilities.Toggle_Loading_Button(button,true);if(!check.Validate()){return;}check.transaction_id = this.transaction_id;check.payment_method_data_id = -1;check.transaction_payment_type_id = this.transaction_payment_type_id;var path=Transaction.GetPath();Utilities.Post_Empty(path + "API/Transaction/AddPaymentMethod",check).then(function(response){response.text().then(function(text){console.log('response text',text,text.length);Utilities.Toggle_Loading_Button(button,false);if(text.length > 0){alert("there was an error attempting to add this check, please refresh this web page and try again.");return;}else {Transaction.ShowReceiptDetail(_this9.transaction_id);}});});}},{key:"FindPaymentTypeControl",value:function FindPaymentTypeControl(control_id){return this.control_data.find(function(c){return c.control_id === control_id;});}}]);return PaymentTypeData;})();Data.PaymentTypeData = PaymentTypeData;})(Data = Transaction.Data || (Transaction.Data = {}));})(Transaction || (Transaction = {})); //# sourceMappingURL=PaymentTypeData.js.map
var Transaction;(function(Transaction){var Receipt=(function(){ //receipt_view_contents
function Receipt(){var _this10=this;var saved_transaction=arguments.length <= 0 || arguments[0] === undefined?null:arguments[0];_classCallCheck(this,Receipt);this.currentTransaction = null;this.savedTransaction = null;this.view_container = null;this.receipt_number_element = null;this.county_manager_element = null;this.created_by_element = null;this.created_on_element = null;this.receipt_view_contents_element = null;this.receipt_view_totals_element = null;this.receipt_preview_controls_element = null;this.receipt_preview_cancel_button_element = null;this.receipt_preview_save_button_element = null;this.view_container = document.getElementById(Receipt.receipt_container);this.receipt_number_element = document.getElementById("receipt_view_number");this.created_by_element = document.getElementById("receipt_created_by");this.county_manager_element = document.getElementById("receipt_view_county_manager");this.created_on_element = document.getElementById("receipt_view_date");this.receipt_view_contents_element = document.getElementById("receipt_view_contents");this.receipt_view_totals_element = document.getElementById("receipt_view_totals");this.currentTransaction = new Transaction.Data.TransactionData("R",saved_transaction);this.receipt_preview_controls_element = document.getElementById("receipt_preview_controls");this.receipt_preview_cancel_button_element = document.getElementById("receipt_view_cancel");this.receipt_preview_save_button_element = document.getElementById("receipt_view_save");this.receipt_preview_cancel_button_element.onclick = function(event){Transaction.ViewReceiptDetail();};this.receipt_preview_save_button_element.onclick = function(event){_this10.currentTransaction.SaveTransactionData();};} //clientside controls
_createClass(Receipt,[{key:"ShowReceiptPreview",value:function ShowReceiptPreview(){var t=this.currentTransaction;this.UpdateReceipt(t);Utilities.Show(this.receipt_preview_controls_element);}},{key:"ShowReceipt",value:function ShowReceipt(t){this.UpdateReceipt(t);Utilities.Hide(this.receipt_preview_controls_element);}},{key:"UpdateReceipt",value:function UpdateReceipt(t){Transaction.ViewPrintableReceipt();Utilities.Set_Text(this.created_on_element,Utilities.Format_Date(t.created_on));Utilities.Set_Text(this.receipt_number_element,t.transaction_number);Utilities.Set_Text(this.created_by_element,t.created_by_display_name);Utilities.Set_Text(this.county_manager_element,t.county_manager_name);this.DisplayDepartmentControls(t);if(t.transaction_type == "R"){this.CreatePaymentTypeDisplay(t);}else {this.CreateTransactionViewDisplay(t);if(t.transaction_type === "C"){}}}},{key:"CreateTransactionViewDisplay",value:function CreateTransactionViewDisplay(t){Utilities.Clear_Element(this.receipt_view_contents_element);Utilities.Clear_Element(this.receipt_view_totals_element);var _iteratorNormalCompletion26=true;var _didIteratorError26=false;var _iteratorError26=undefined;try{for(var _iterator26=t.deposit_receipts[Symbol.iterator](),_step26;!(_iteratorNormalCompletion26 = (_step26 = _iterator26.next()).done);_iteratorNormalCompletion26 = true) {var td=_step26.value;this.receipt_view_contents_element.appendChild(this.CreateReceiptDetailRow(td.transaction_type + " " + td.transaction_number,td.total_cash_amount,td.total_check_amount,td.total_check_count));}}catch(err) {_didIteratorError26 = true;_iteratorError26 = err;}finally {try{if(!_iteratorNormalCompletion26 && _iterator26["return"]){_iterator26["return"]();}}finally {if(_didIteratorError26){throw _iteratorError26;}}}this.receipt_view_totals_element.appendChild(this.CreateReceiptDetailRow("Grand Total",t.total_cash_amount,t.total_check_amount,t.total_check_count));}},{key:"CreatePaymentTypeDisplay",value:function CreatePaymentTypeDisplay(t){Utilities.Clear_Element(this.receipt_view_contents_element);Utilities.Clear_Element(this.receipt_view_totals_element);var check_total=0;var cash_total=0;var check_count=0;var _iteratorNormalCompletion27=true;var _didIteratorError27=false;var _iteratorError27=undefined;try{for(var _iterator27=t.payment_type_data[Symbol.iterator](),_step27;!(_iteratorNormalCompletion27 = (_step27 = _iterator27.next()).done);_iteratorNormalCompletion27 = true) {var ptd=_step27.value;var payment_method_header_row_shown=false;var current_check_total=0;var current_cash_total=0;var current_check_count=0;var controls=ptd.control_data;var address_controls=this.get_address_controls(controls,true);if(address_controls.length > 0){controls = this.get_address_controls(controls,false);}var date_range_controls=this.get_date_range_controls(controls,true);if(date_range_controls.length > 0){controls = this.get_date_range_controls(controls,false);}var _iteratorNormalCompletion28=true;var _didIteratorError28=false;var _iteratorError28=undefined;try{for(var _iterator28=controls[Symbol.iterator](),_step28;!(_iteratorNormalCompletion28 = (_step28 = _iterator28.next()).done);_iteratorNormalCompletion28 = true) {var cd=_step28.value;var control=cd.control?cd.control:cd.selected_control;if(control.data_type === "bigtext"){var div=document.createElement("div");var text=cd.value.split("\n");var _iteratorNormalCompletion30=true;var _didIteratorError30=false;var _iteratorError30=undefined;try{for(var _iterator30=text[Symbol.iterator](),_step30;!(_iteratorNormalCompletion30 = (_step30 = _iterator30.next()).done);_iteratorNormalCompletion30 = true) {var _t=_step30.value;var p=document.createElement("p");p.appendChild(document.createTextNode(_t));div.appendChild(p);}}catch(err) {_didIteratorError30 = true;_iteratorError30 = err;}finally {try{if(!_iteratorNormalCompletion30 && _iterator30["return"]){_iterator30["return"]();}}finally {if(_didIteratorError30){throw _iteratorError30;}}}this.receipt_view_contents_element.appendChild(this.CreateControlDataRow(control.label,div));}else {if(control.data_type === "money"){var v=Utilities.Format_Amount(parseFloat(cd.value));this.receipt_view_contents_element.appendChild(this.CreateControlDataRow(control.label,v));}else {this.receipt_view_contents_element.appendChild(this.CreateControlDataRow(control.label,cd.value));}}}}catch(err) {_didIteratorError28 = true;_iteratorError28 = err;}finally {try{if(!_iteratorNormalCompletion28 && _iterator28["return"]){_iterator28["return"]();}}finally {if(_didIteratorError28){throw _iteratorError28;}}}if(address_controls.length > 0){var address=this.get_address(address_controls);this.receipt_view_contents_element.appendChild(this.CreateControlDataRow("Address",address));}if(date_range_controls.length > 0){var date_range=this.get_date_range(date_range_controls);this.receipt_view_contents_element.appendChild(this.CreateControlDataRow("Date Range",date_range));}var _iteratorNormalCompletion29=true;var _didIteratorError29=false;var _iteratorError29=undefined;try{for(var _iterator29=ptd.payment_method_data[Symbol.iterator](),_step29;!(_iteratorNormalCompletion29 = (_step29 = _iterator29.next()).done);_iteratorNormalCompletion29 = true) {var pmd=_step29.value;if(pmd.cash_amount > 0){if(!payment_method_header_row_shown){this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeHeaderRow());payment_method_header_row_shown = true;}this.receipt_view_contents_element.appendChild(this.CreateCashDataRow(pmd));}else {if(pmd.check_amount > 0 || pmd.check_number.length > 0 || pmd.check_from.length > 0){if(!payment_method_header_row_shown){this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeHeaderRow());payment_method_header_row_shown = true;}this.receipt_view_contents_element.appendChild(this.CreateCheckDataRow(pmd));}}current_cash_total += pmd.cash_amount;current_check_total += pmd.check_amount;current_check_count += pmd.check_count;}}catch(err) {_didIteratorError29 = true;_iteratorError29 = err;}finally {try{if(!_iteratorNormalCompletion29 && _iterator29["return"]){_iterator29["return"]();}}finally {if(_didIteratorError29){throw _iteratorError29;}}}var payment_type_name=ptd.selected_payment_type !== undefined?ptd.selected_payment_type.name:ptd.payment_type.name;this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeRow(payment_type_name + " Total",current_cash_total,current_check_total,current_check_count));check_total += current_check_total;cash_total += current_cash_total;check_count += current_check_count;}}catch(err) {_didIteratorError27 = true;_iteratorError27 = err;}finally {try{if(!_iteratorNormalCompletion27 && _iterator27["return"]){_iterator27["return"]();}}finally {if(_didIteratorError27){throw _iteratorError27;}}}this.receipt_view_totals_element.appendChild(this.CreatePaymentTypeRow("Grand Total",cash_total,check_total,check_count));}},{key:"CreatePaymentTypeRow",value:function CreatePaymentTypeRow(payment_type,cash_amount,check_amount,check_count){return this.CreateReceiptDetailRow(payment_type,cash_amount,check_amount,check_count);}},{key:"CreateControlDataRow",value:function CreateControlDataRow(label,value){var tr=document.createElement("tr");tr.classList.add("pagebreak");tr.appendChild(Utilities.CreateTableCell("td",label,"has-text-right"));if(typeof value == "string"){tr.appendChild(Utilities.CreateTableCell("td",value,"has-text-left","",2));}else {var cell=Utilities.CreateTableCell("td",value,"has-text-left","",2);cell.appendChild(value);tr.appendChild(cell);}tr.appendChild(Utilities.CreateTableCell("td","","","",4));return tr;}},{key:"CreatePaymentTypeHeaderRow",value:function CreatePaymentTypeHeaderRow(){var tr=document.createElement("tr");tr.classList.add("pagebreak");tr.appendChild(Utilities.CreateTableCell("th","Check Number","has-text-right"));tr.appendChild(Utilities.CreateTableCell("th","Check From","has-text-right"));tr.appendChild(Utilities.CreateTableCell("th","Type","has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td","","","",4));return tr;}},{key:"CreateCheckDataRow",value:function CreateCheckDataRow(pmd){var tr=document.createElement("tr");tr.classList.add("pagebreak");tr.appendChild(Utilities.CreateTableCell("td",pmd.check_number,"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",pmd.check_from,"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td","Check","has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td",pmd.check_count.toString(),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(pmd.check_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td","",""));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(pmd.check_amount),"has-text-right"));return tr;}},{key:"CreateCashDataRow",value:function CreateCashDataRow(pmd){var tr=document.createElement("tr");tr.classList.add("pagebreak");tr.appendChild(Utilities.CreateTableCell("td","","","",2)); //tr.appendChild(Utilities.CreateTableCell("td", pmd.check_from, "has-text-left"));
tr.appendChild(Utilities.CreateTableCell("td","Cash","has-text-centered"));tr.appendChild(Utilities.CreateTableCell("td","","","",2));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(pmd.cash_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(pmd.cash_amount),"has-text-right"));return tr;}},{key:"CreateReceiptDetailRow",value:function CreateReceiptDetailRow(label,cash_amount,check_amount,check_count){var tr=document.createElement("tr");tr.appendChild(Utilities.CreateTableCell("th",label,"has-text-left","",3));tr.appendChild(Utilities.CreateTableCell("th",check_count.toString(),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("th",Utilities.Format_Amount(check_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("th",Utilities.Format_Amount(cash_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("th",Utilities.Format_Amount(cash_amount + check_amount),"has-text-right"));tr.classList.add("payment_type_end");return tr;}},{key:"DisplayDepartmentControls",value:function DisplayDepartmentControls(t){var container=document.getElementById("receipt_department_controls");Utilities.Clear_Element(container);var df=document.createDocumentFragment();df.appendChild(this.CreatePrintableControl("is-half","Received From",t.received_from));df.appendChild(this.CreatePrintableControl("is-half","Department",t.department_name));var _iteratorNormalCompletion31=true;var _didIteratorError31=false;var _iteratorError31=undefined;try{for(var _iterator31=t.department_control_data[Symbol.iterator](),_step31;!(_iteratorNormalCompletion31 = (_step31 = _iterator31.next()).done);_iteratorNormalCompletion31 = true) {var cd=_step31.value;df.appendChild(this.CreateDepartmentControl(cd));}}catch(err) {_didIteratorError31 = true;_iteratorError31 = err;}finally {try{if(!_iteratorNormalCompletion31 && _iterator31["return"]){_iterator31["return"]();}}finally {if(_didIteratorError31){throw _iteratorError31;}}}container.appendChild(df);}},{key:"CreateDepartmentControl",value:function CreateDepartmentControl(control_data){var size="";console.log("create departmental control",control_data);var c=control_data.control !== null?control_data.control:control_data.selected_control;if(c.render_hints.length > 0)size = c.render_hints;return this.CreatePrintableControl(size,c.label,control_data.value);}},{key:"CreatePrintableControl",value:function CreatePrintableControl(size,label,value){var e=document.createElement("div");e.classList.add("field","column",size);var l=document.createElement("label");l.classList.add("label",Transaction.app_input_size);l.appendChild(document.createTextNode(label));e.appendChild(l);var control=document.createElement("p");control.classList.add("control");e.appendChild(control);var input=document.createElement("input");input.classList.add("input","is-static",Transaction.app_input_size);input.value = value;input.readOnly = true;control.appendChild(input);return e;}},{key:"get_address_controls",value:function get_address_controls(cd,match){var address_control_ids=[5,6,7,8,9];return this.get_control_groups(address_control_ids,cd,match);}},{key:"get_address",value:function get_address(cd){var e=document.createElement("div");var line1="";var line2="";var city="";var state="";var zip="";var line3="";var _iteratorNormalCompletion32=true;var _didIteratorError32=false;var _iteratorError32=undefined;try{for(var _iterator32=cd[Symbol.iterator](),_step32;!(_iteratorNormalCompletion32 = (_step32 = _iterator32.next()).done);_iteratorNormalCompletion32 = true) {var c=_step32.value;switch(c.control_id){case 5: // address line 1
line1 = c.value.trim();break;case 6:line2 = c.value.trim();break;case 7: // City
city = c.value.trim();break;case 8: // State
state = c.value.trim();break;case 9: //Zip
zip = c.value.trim();}}}catch(err) {_didIteratorError32 = true;_iteratorError32 = err;}finally {try{if(!_iteratorNormalCompletion32 && _iterator32["return"]){_iterator32["return"]();}}finally {if(_didIteratorError32){throw _iteratorError32;}}}if(line1.length > 0){var line1_p=document.createElement("p");line1_p.appendChild(document.createTextNode(line1));e.appendChild(line1_p);}if(line2.length > 0){var line2_p=document.createElement("p");line2_p.appendChild(document.createTextNode(line2));e.appendChild(line2_p);}if(city.length > 0 || state.length > 0 || zip.length > 0){if(city.length > 0)line3 = city + ", ";if(state.length > 0)line3 += state + " ";line3 += zip;var line3_p=document.createElement("p");line3_p.appendChild(document.createTextNode(line3));e.appendChild(line3_p);}return e;}},{key:"get_date_range",value:function get_date_range(cd){var start="";var end="";var e=document.createElement("e");var _iteratorNormalCompletion33=true;var _didIteratorError33=false;var _iteratorError33=undefined;try{for(var _iterator33=cd[Symbol.iterator](),_step33;!(_iteratorNormalCompletion33 = (_step33 = _iterator33.next()).done);_iteratorNormalCompletion33 = true) {var c=_step33.value;switch(c.control_id){case 10:case 71:start = c.value;break;case 11:case 72:end = c.value;break;}}}catch(err) {_didIteratorError33 = true;_iteratorError33 = err;}finally {try{if(!_iteratorNormalCompletion33 && _iterator33["return"]){_iterator33["return"]();}}finally {if(_didIteratorError33){throw _iteratorError33;}}}e.appendChild(document.createTextNode(start + " through " + end));return e;}},{key:"get_date_range_controls",value:function get_date_range_controls(cd,match){var date_range_control_ids=[10,11,71,72];return this.get_control_groups(date_range_control_ids,cd,match);}},{key:"get_control_groups",value:function get_control_groups(control_ids,cd,match){if(match){return cd.filter(function(j){return control_ids.includes(j.control_id);});}else {return cd.filter(function(j){return !control_ids.includes(j.control_id);});}}}]);return Receipt;})();Receipt.receipt_container = "receipt_view";Transaction.Receipt = Receipt;})(Transaction || (Transaction = {})); //# sourceMappingURL=Receipt.js.map
var Transaction;(function(Transaction){var Data;(function(Data){var TransactionData=(function(){function TransactionData(transaction_type,saved_transaction){_classCallCheck(this,TransactionData);this.transaction_id = -1;this.fiscal_year = -1;this.created_by_employee_id = -1;this.employee_transaction_count = -1;this.transaction_number = "PREVIEW";this.transaction_type = "";this.child_transaction_id = -1;this.department_id = -1;this.department_name = "";this.department_control_data = [];this.payment_type_data = [];this.county_manager_name = "PREVIEW";this.comment = "";this.error_text = "";this.received_from = "";this.total_cash_amount = -1;this.total_check_amount = -1;this.total_check_count = -1;this.created_on = new Date();this.created_by_username = "";this.created_by_ip_address = "";this.created_by_display_name = "PREVIEW";this.deposit_receipts = [];this.can_modify = false;this.can_accept_deposit = false;this.child_transaction = null; //public base_container: string = 'root';
this.department_element = null;this.department_element_container = null;this.received_from_element = null;this.received_from_element_container = null;this.department_controls_target = 'department_controls_container';this.payment_type_target = 'payment_type_container';this.transaction_error_element = null;this.selected_department = null;this.next_payment_type_index = 0;this.transaction_type = transaction_type;if(saved_transaction !== null){this.transaction_id = saved_transaction.transaction_id;this.transaction_number = saved_transaction.transaction_number;this.transaction_type = saved_transaction.transaction_type;}var targetContainer=document.getElementById(TransactionData.action_container);Utilities.Clear_Element(targetContainer);this.CreateReceiptTitle(targetContainer,saved_transaction);switch(this.transaction_type){case "R":console.log("receipt view");this.RenderReceiptView(targetContainer,saved_transaction);break;case "D":case "C":console.log("deposit view");this.RenderDepositView(targetContainer,saved_transaction);break;default:break;}this.transaction_error_element = this.CreateTransactionErrorElement();targetContainer.appendChild(this.transaction_error_element);} // client side only stuff
_createClass(TransactionData,[{key:"RenderDepositView",value:function RenderDepositView(container,saved_transaction){var transactions_container=document.createElement("div");container.appendChild(transactions_container);var footer=TransactionData.CreateTransactionsTableFooter(saved_transaction);TransactionData.RenderTransactionList(saved_transaction.deposit_receipts,transactions_container,footer);if(saved_transaction.can_accept_deposit){ // we'll show a menu that will allow the deposit viewer to indicate
// how many checks / how much cash/checks they've collected
// and provide a spot for comments.
// last will be a Create Receipt button.
console.log('can accept deposit');container.appendChild(TransactionData.CreateAcceptDepositMenu(saved_transaction));}}},{key:"RenderReceiptView",value:function RenderReceiptView(container,saved_transaction){var control_container=document.createElement("div");control_container.id = "transaction_controls";control_container.classList.add("columns");container.appendChild(control_container);this.department_element = Transaction.DepartmentControl.cloneNode(true);this.RenderDepartmentSelection(control_container,saved_transaction);this.RenderReceivedFromInput(control_container,saved_transaction);}},{key:"CreateTransactionErrorElement",value:function CreateTransactionErrorElement(){var e=document.createElement("div");return e;}},{key:"CreateReceiptTitle",value:function CreateReceiptTitle(target,saved_transaction){var title=document.createElement("h2");title.classList.add("title","has-text-centered");var text="";if(saved_transaction === null){text = "Create a New Receipt";title.appendChild(document.createTextNode(text));}else {switch(saved_transaction.transaction_type){case "R":text = "Viewing Receipt: " + saved_transaction.transaction_number;break;case "D":text = "Viewing Deposit: " + saved_transaction.transaction_number;break;case "C":text = "Viewing Deposit Receipt: " + saved_transaction.transaction_number;break;}title.appendChild(document.createTextNode(text));if(saved_transaction.child_transaction !== null){(function(){var c=saved_transaction.child_transaction;var link=document.createElement("a");link.appendChild(document.createTextNode(c.transaction_number));link.onclick = function(){Transaction.ShowReceiptDetail(c.transaction_id);};switch(c.transaction_type){case "D":text = ", Deposited: ";break;case "C":text = ", Deposit Accepted: ";break;}title.appendChild(document.createTextNode(text));title.appendChild(link);})();}}target.appendChild(title);}},{key:"RenderDepartmentSelection",value:function RenderDepartmentSelection(target,saved_transaction){var _this11=this;if(saved_transaction === null){this.department_element.onchange = function(event){_this11.department_id = parseInt(event.target.value);_this11.selected_department = Transaction.Department.FindDepartment(_this11.department_id);_this11.RenderDepartmentControls();_this11.RenderPaymentTypes();};}else {this.department_id = saved_transaction.department_id;this.selected_department = Transaction.Department.FindDepartment(this.department_id);this.RenderSavedDepartmentControls(saved_transaction);this.RenderSavedPaymentTypes(saved_transaction);this.department_element.value = saved_transaction.department_id.toString();this.department_element.disabled = true;}this.department_element_container = Transaction.Department.CreateDepartmentElementField(this.department_element);target.appendChild(this.department_element_container);}},{key:"RenderDepartmentControls",value:function RenderDepartmentControls(){this.department_control_data = [];var departmentControlContainer=document.getElementById(this.department_controls_target);if(departmentControlContainer === null){departmentControlContainer = document.createElement("div");departmentControlContainer.id = this.department_controls_target;document.getElementById(TransactionData.action_container).appendChild(departmentControlContainer);}Utilities.Clear_Element(departmentControlContainer);if(this.department_id === -1 || this.selected_department === null || this.selected_department.controls.length === 0)return;var _iteratorNormalCompletion34=true;var _didIteratorError34=false;var _iteratorError34=undefined;try{for(var _iterator34=this.selected_department.control_groups[Symbol.iterator](),_step34;!(_iteratorNormalCompletion34 = (_step34 = _iterator34.next()).done);_iteratorNormalCompletion34 = true) {var _department_control_data;var group=_step34.value;(_department_control_data = this.department_control_data).push.apply(_department_control_data,_toConsumableArray(group.CreateControlData(departmentControlContainer)));}}catch(err) {_didIteratorError34 = true;_iteratorError34 = err;}finally {try{if(!_iteratorNormalCompletion34 && _iterator34["return"]){_iterator34["return"]();}}finally {if(_didIteratorError34){throw _iteratorError34;}}}}},{key:"RenderPaymentTypes",value:function RenderPaymentTypes(){var _this12=this;this.payment_type_data = [];var paymentTypeContainer=document.getElementById(this.payment_type_target); // if we can't find it, create it.
if(paymentTypeContainer === null){paymentTypeContainer = document.createElement("div");paymentTypeContainer.id = this.payment_type_target;document.getElementById(TransactionData.action_container).appendChild(paymentTypeContainer);}Utilities.Clear_Element(paymentTypeContainer);if(this.department_id === -1 || this.selected_department === null)return;var ol=document.createElement("ol");ol.classList.add("payment_type");var _iteratorNormalCompletion35=true;var _didIteratorError35=false;var _iteratorError35=undefined;try{var _loop3=function(){var pt=_step35.value;var li=document.createElement("li");li.classList.add("light-function","is-size-4","has-background-link");li.style.cursor = "pointer";li.setAttribute("payment_type_id",pt.payment_type_id.toString());var name=document.createElement("span");name.classList.add("name");name.appendChild(document.createTextNode(pt.name));li.appendChild(name);var totals=document.createElement("span");totals.classList.add("totals");li.appendChild(totals);ol.appendChild(li);var controls_container=document.createElement("ol");controls_container.classList.add("control_container","hide");ol.appendChild(controls_container);li.onclick = function(event){if(controls_container.childElementCount === 0) // there is no payment type data created yet.
{_this12.AddPaymentType(pt,controls_container);controls_container.classList.remove("hide");}console.log('this transaction',_this12);};};for(var _iterator35=this.selected_department.payment_types[Symbol.iterator](),_step35;!(_iteratorNormalCompletion35 = (_step35 = _iterator35.next()).done);_iteratorNormalCompletion35 = true) {_loop3();}}catch(err) {_didIteratorError35 = true;_iteratorError35 = err;}finally {try{if(!_iteratorNormalCompletion35 && _iterator35["return"]){_iterator35["return"]();}}finally {if(_didIteratorError35){throw _iteratorError35;}}}paymentTypeContainer.appendChild(ol);}},{key:"AddPaymentType",value:function AddPaymentType(payment_type,container){var _this13=this;var transaction_already_saved=arguments.length <= 2 || arguments[2] === undefined?false:arguments[2];if(payment_type.payment_type_id === 62){var _iteratorNormalCompletion36=true;var _didIteratorError36=false;var _iteratorError36=undefined;try{for(var _iterator36=this.payment_type_data[Symbol.iterator](),_step36;!(_iteratorNormalCompletion36 = (_step36 = _iterator36.next()).done);_iteratorNormalCompletion36 = true) {var _ptd=_step36.value;if(_ptd.payment_type_id === 62){alert("You can only add 1 Security Deposit to receipt.");return;}}}catch(err) {_didIteratorError36 = true;_iteratorError36 = err;}finally {try{if(!_iteratorNormalCompletion36 && _iterator36["return"]){_iterator36["return"]();}}finally {if(_didIteratorError36){throw _iteratorError36;}}}}var default_payment_type_index=this.next_payment_type_index++;if(transaction_already_saved){var max_index=0;var _iteratorNormalCompletion37=true;var _didIteratorError37=false;var _iteratorError37=undefined;try{for(var _iterator37=this.payment_type_data[Symbol.iterator](),_step37;!(_iteratorNormalCompletion37 = (_step37 = _iterator37.next()).done);_iteratorNormalCompletion37 = true) {var pt=_step37.value;if(pt.payment_type_index > max_index)max_index = pt.payment_type_index;}}catch(err) {_didIteratorError37 = true;_iteratorError37 = err;}finally {try{if(!_iteratorNormalCompletion37 && _iterator37["return"]){_iterator37["return"]();}}finally {if(_didIteratorError37){throw _iteratorError37;}}}default_payment_type_index = max_index + 1;}var ptd=new Data.PaymentTypeData(payment_type,container,default_payment_type_index);this.payment_type_data.push(ptd);ptd.add_another_payment_type_button.onclick = function(event){_this13.AddPaymentType(payment_type,container,transaction_already_saved);};ptd.cancel_payment_type_button.onclick = function(event){container.removeChild(ptd.payment_type_container);var indextoremove=_this13.payment_type_data.findIndex(function(j){return j.payment_type_index === ptd.payment_type_index;});if(indextoremove > -1)_this13.payment_type_data.splice(indextoremove,1);ptd = null;if(container.childElementCount === 0)container.classList.add("hide");};if(transaction_already_saved){Utilities.Set_Text(ptd.save_button,"Save New Payment Types");}ptd.save_button.onclick = function(event){var button=event.target;Utilities.Toggle_Loading_Button(button,true);if(transaction_already_saved){_this13.SaveNewPaymentTypes();Utilities.Toggle_Loading_Button(button,false);}else {if(_this13.ValidateTransaction()){Transaction.currentReceipt.ShowReceiptPreview();Utilities.Toggle_Loading_Button(button,false);}else {Utilities.Toggle_Loading_Button(button,false);}}};} /*
             * Saved Transaction Rendering functions
             *
             */},{key:"RenderSavedDepartmentControls",value:function RenderSavedDepartmentControls(saved_transaction){this.department_control_data = [];var departmentControlContainer=document.getElementById(this.department_controls_target);if(departmentControlContainer === null){departmentControlContainer = document.createElement("div");departmentControlContainer.id = this.department_controls_target;document.getElementById(TransactionData.action_container).appendChild(departmentControlContainer);}Utilities.Clear_Element(departmentControlContainer);if(this.department_id === -1 || this.selected_department === null || this.selected_department.controls.length === 0)return;var control_groups=Transaction.ControlGroup.CreateSavedControlGroups(saved_transaction.department_control_data);var _iteratorNormalCompletion38=true;var _didIteratorError38=false;var _iteratorError38=undefined;try{for(var _iterator38=control_groups[Symbol.iterator](),_step38;!(_iteratorNormalCompletion38 = (_step38 = _iterator38.next()).done);_iteratorNormalCompletion38 = true) {var _department_control_data2;var group=_step38.value;(_department_control_data2 = this.department_control_data).push.apply(_department_control_data2,_toConsumableArray(group.CreateControlData(departmentControlContainer,false)));}}catch(err) {_didIteratorError38 = true;_iteratorError38 = err;}finally {try{if(!_iteratorNormalCompletion38 && _iterator38["return"]){_iterator38["return"]();}}finally {if(_didIteratorError38){throw _iteratorError38;}}}}},{key:"RenderSavedPaymentTypes",value:function RenderSavedPaymentTypes(saved_transaction){var _this14=this; // The primary difference between the RenderSavedPaymentTypes and RenderPaymentTypes functions
// is that the RenderPaymentTypes function renders the payment type based on what information
// the system is currently set up to expect for that paymenttype.
// The RenderSavedPaymentTypes function renders the payment type based on the information
// that was saved.  This information may not be vaild for the payment types going forward.
this.payment_type_data = [];var paymentTypeContainer=document.getElementById(this.payment_type_target); // if we can't find it, create it.
if(paymentTypeContainer === null){paymentTypeContainer = document.createElement("div");paymentTypeContainer.id = this.payment_type_target;document.getElementById(TransactionData.action_container).appendChild(paymentTypeContainer);}Utilities.Clear_Element(paymentTypeContainer);if(this.department_id === -1 || this.selected_department === null)return;var ol=document.createElement("ol");ol.classList.add("payment_type");var ids=saved_transaction.payment_type_data.map(function(ptd){return ptd.payment_type_id;});var distinct_payment_type_ids=[].concat(_toConsumableArray(new Set(ids)));var _iteratorNormalCompletion39=true;var _didIteratorError39=false;var _iteratorError39=undefined;try{var _loop4=function(){var payment_type_id=_step39.value;var filtered=saved_transaction.payment_type_data.filter(function(x){return x.payment_type_id === payment_type_id;});var pt=Transaction.FindPaymentType(filtered[0].payment_type_id); //filtered[0].payment_type;
//let pt = Transaction.FindPaymentType(payment_type_id);
var li=document.createElement("li");li.classList.add("light-function","is-size-4","has-background-link");li.style.cursor = "pointer";li.setAttribute("payment_type_id",pt.payment_type_id.toString());var name=document.createElement("span");name.classList.add("name");name.appendChild(document.createTextNode(pt.name));li.appendChild(name);var totals=document.createElement("span"); // will need to calculate totals now
totals.classList.add("totals");li.appendChild(totals);ol.appendChild(li);var controls_container=document.createElement("ol");controls_container.classList.add("control_container");ol.appendChild(controls_container);_iteratorNormalCompletion41 = true;_didIteratorError41 = false;_iteratorError41 = undefined;try{for(_iterator41 = filtered[Symbol.iterator]();!(_iteratorNormalCompletion41 = (_step41 = _iterator41.next()).done);_iteratorNormalCompletion41 = true) {var ptd=_step41.value;_this14.AddSavedPaymentType(pt,ptd,controls_container);}}catch(err) {_didIteratorError41 = true;_iteratorError41 = err;}finally {try{if(!_iteratorNormalCompletion41 && _iterator41["return"]){_iterator41["return"]();}}finally {if(_didIteratorError41){throw _iteratorError41;}}}};for(var _iterator39=distinct_payment_type_ids[Symbol.iterator](),_step39;!(_iteratorNormalCompletion39 = (_step39 = _iterator39.next()).done);_iteratorNormalCompletion39 = true) {var _iteratorNormalCompletion41;var _didIteratorError41;var _iteratorError41;var _iterator41,_step41;_loop4();}}catch(err) {_didIteratorError39 = true;_iteratorError39 = err;}finally {try{if(!_iteratorNormalCompletion39 && _iterator39["return"]){_iterator39["return"]();}}finally {if(_didIteratorError39){throw _iteratorError39;}}}var _iteratorNormalCompletion40=true;var _didIteratorError40=false;var _iteratorError40=undefined;try{var _loop5=function(){var pt=_step40.value;if(distinct_payment_type_ids.indexOf(pt.payment_type_id) === -1){(function(){var li=document.createElement("li");li.classList.add("light-function","is-size-4","has-background-link");li.style.cursor = "pointer";li.setAttribute("payment_type_id",pt.payment_type_id.toString());var name=document.createElement("span");name.classList.add("name");name.appendChild(document.createTextNode(pt.name));li.appendChild(name);var totals=document.createElement("span");totals.classList.add("totals");li.appendChild(totals);ol.appendChild(li);var controls_container=document.createElement("ol");controls_container.classList.add("control_container","hide");ol.appendChild(controls_container);li.onclick = function(event){if(controls_container.childElementCount === 0) // there is no payment type data created yet.
{_this14.AddPaymentType(pt,controls_container,true);controls_container.classList.remove("hide");}console.log('this transaction',_this14);};})();}};for(var _iterator40=this.selected_department.payment_types[Symbol.iterator](),_step40;!(_iteratorNormalCompletion40 = (_step40 = _iterator40.next()).done);_iteratorNormalCompletion40 = true) {_loop5();}}catch(err) {_didIteratorError40 = true;_iteratorError40 = err;}finally {try{if(!_iteratorNormalCompletion40 && _iterator40["return"]){_iterator40["return"]();}}finally {if(_didIteratorError40){throw _iteratorError40;}}}paymentTypeContainer.appendChild(ol);}},{key:"AddSavedPaymentType",value:function AddSavedPaymentType(payment_type,payment_type_data,container){var _this15=this;var ptd=new Data.PaymentTypeData(payment_type,container,this.next_payment_type_index++,payment_type_data);this.payment_type_data.push(ptd); //ptd.add_another_payment_type_button.style.display = "none";
ptd.add_another_payment_type_button.onclick = function(event){_this15.AddPaymentType(payment_type,container,true);};ptd.cancel_payment_type_button.style.display = "none";ptd.save_button.style.display = "none";}},{key:"RenderReceivedFromInput",value:function RenderReceivedFromInput(target_container,saved_transaction){var _this16=this;var input_value=saved_transaction === null?"":saved_transaction.received_from;this.received_from = input_value;this.received_from_element = Transaction.ControlGroup.CreateInput("text",500,true,"Received From",input_value);if(saved_transaction === null){this.received_from_element.oninput = function(event){var e=event.target;_this16.received_from = e.value.trim();_this16.IsValid();};}else {this.received_from_element.readOnly = true;}this.received_from_element_container = Transaction.ControlGroup.CreateInputFieldContainer(this.received_from_element,"Received From or N/A",true,"is-one-half");target_container.appendChild(this.received_from_element_container);}},{key:"ValidateNewPaymentTypes",value:function ValidateNewPaymentTypes(payment_types){var is_valid=true;var _iteratorNormalCompletion42=true;var _didIteratorError42=false;var _iteratorError42=undefined;try{for(var _iterator42=payment_types[Symbol.iterator](),_step42;!(_iteratorNormalCompletion42 = (_step42 = _iterator42.next()).done);_iteratorNormalCompletion42 = true) {var pt=_step42.value;if(!pt.Validate())is_valid = false;}}catch(err) {_didIteratorError42 = true;_iteratorError42 = err;}finally {try{if(!_iteratorNormalCompletion42 && _iterator42["return"]){_iterator42["return"]();}}finally {if(_didIteratorError42){throw _iteratorError42;}}}return is_valid;}},{key:"ValidateTransaction",value:function ValidateTransaction(){var is_valid=true;is_valid = this.IsValid();var _iteratorNormalCompletion43=true;var _didIteratorError43=false;var _iteratorError43=undefined;try{for(var _iterator43=this.department_control_data[Symbol.iterator](),_step43;!(_iteratorNormalCompletion43 = (_step43 = _iterator43.next()).done);_iteratorNormalCompletion43 = true) {var ct=_step43.value;var v=ct.Validate();if(!v && is_valid)is_valid = false;}}catch(err) {_didIteratorError43 = true;_iteratorError43 = err;}finally {try{if(!_iteratorNormalCompletion43 && _iterator43["return"]){_iterator43["return"]();}}finally {if(_didIteratorError43){throw _iteratorError43;}}}var _iteratorNormalCompletion44=true;var _didIteratorError44=false;var _iteratorError44=undefined;try{for(var _iterator44=this.payment_type_data[Symbol.iterator](),_step44;!(_iteratorNormalCompletion44 = (_step44 = _iterator44.next()).done);_iteratorNormalCompletion44 = true) {var pt=_step44.value;var v=pt.Validate();if(!v && is_valid)is_valid = false;}}catch(err) {_didIteratorError44 = true;_iteratorError44 = err;}finally {try{if(!_iteratorNormalCompletion44 && _iterator44["return"]){_iterator44["return"]();}}finally {if(_didIteratorError44){throw _iteratorError44;}}}if(is_valid){if(!this.ValidateCheckCount()){Utilities.Error_Show(this.transaction_error_element,"You have entered a check amount but have entered that you have collected no checks.");this.transaction_error_element.parentElement.scrollIntoView();is_valid = false;}}return is_valid;}},{key:"ValidateCheckCount",value:function ValidateCheckCount(){var check_amount=0;var _iteratorNormalCompletion45=true;var _didIteratorError45=false;var _iteratorError45=undefined;try{for(var _iterator45=this.payment_type_data[Symbol.iterator](),_step45;!(_iteratorNormalCompletion45 = (_step45 = _iterator45.next()).done);_iteratorNormalCompletion45 = true) {var pt=_step45.value;var _iteratorNormalCompletion46=true;var _didIteratorError46=false;var _iteratorError46=undefined;try{for(var _iterator46=pt.payment_method_data[Symbol.iterator](),_step46;!(_iteratorNormalCompletion46 = (_step46 = _iterator46.next()).done);_iteratorNormalCompletion46 = true) {var pmd=_step46.value;if(pmd.check_count > 0)return true;check_amount += pmd.check_amount;}}catch(err) {_didIteratorError46 = true;_iteratorError46 = err;}finally {try{if(!_iteratorNormalCompletion46 && _iterator46["return"]){_iterator46["return"]();}}finally {if(_didIteratorError46){throw _iteratorError46;}}}}}catch(err) {_didIteratorError45 = true;_iteratorError45 = err;}finally {try{if(!_iteratorNormalCompletion45 && _iterator45["return"]){_iterator45["return"]();}}finally {if(_didIteratorError45){throw _iteratorError45;}}}return check_amount === 0;}},{key:"IsValid",value:function IsValid(){Transaction.error_scrolled = false;this.ResetErrorElements();var is_valid=true; //if (this.department_id === -1)
//{
//  //ControlGroup.UpdateSelectError(this.department_element_container, "Invalid Department Selected");
//  is_valid = false;
//}
if(this.received_from.length === 0){Transaction.ControlGroup.UpdateInputError(this.received_from_element,this.received_from_element_container,"This field is required.");is_valid = false;}return is_valid;}},{key:"ResetErrorElements",value:function ResetErrorElements(){Utilities.Clear_Element(this.transaction_error_element);Transaction.ControlGroup.UpdateSelectError(this.department_element_container,"");Transaction.ControlGroup.UpdateInputError(this.received_from_element,this.received_from_element_container,"");}},{key:"SaveTransactionData",value:function SaveTransactionData(){ // first let's reorder all of the payment_type_index fields
// by reorder I mean make them representative
// of the actual index that element is in the array.
var t=this;var path=Transaction.GetPath();Utilities.Post(path + "API/Transaction/Save",t).then(function(response){if(response.error_text.length === 0){console.log("post probably good",response);Transaction.currentReceipt.ShowReceipt(response);Transaction.ResetReceipt();Transaction.Data.TransactionData.GetTransactionList().then(function(tv){Transaction.transactions = tv;TransactionData.RenderTransactionList(tv);Utilities.Toggle_Loading_Button(Data.TransactionData.reload_button,false);});}else {console.log('transaction error',response.error_text,response);Transaction.ViewReceiptDetail();t.ParseReturnedTransactionForErrors(response);return;} // need to reset the current transaction
// and display the one that I just downloaded.
},function(error){console.log("post error occurred",error);});}},{key:"ParseReturnedTransactionForErrors",value:function ParseReturnedTransactionForErrors(failed_transaction){var f=failed_transaction; // now we compare the current transaction to the failed transaction, match payment type ids
// and payment type indexes, and then match controls (including departmental)
// we'll apply any errors we find to the best matched control we have in this transaction.
var _iteratorNormalCompletion47=true;var _didIteratorError47=false;var _iteratorError47=undefined;try{for(var _iterator47=f.department_control_data[Symbol.iterator](),_step47;!(_iteratorNormalCompletion47 = (_step47 = _iterator47.next()).done);_iteratorNormalCompletion47 = true) {var cd=_step47.value;if(cd.error_text.length > 0){var this_cd=this.FindDepartmentControl(cd.control_id);if(this_cd !== undefined){this_cd.SetErrorText(cd.error_text);}}}}catch(err) {_didIteratorError47 = true;_iteratorError47 = err;}finally {try{if(!_iteratorNormalCompletion47 && _iterator47["return"]){_iterator47["return"]();}}finally {if(_didIteratorError47){throw _iteratorError47;}}}var _iteratorNormalCompletion48=true;var _didIteratorError48=false;var _iteratorError48=undefined;try{for(var _iterator48=f.payment_type_data[Symbol.iterator](),_step48;!(_iteratorNormalCompletion48 = (_step48 = _iterator48.next()).done);_iteratorNormalCompletion48 = true) {var pmd=_step48.value;var this_pmd=this.FindPaymentType(pmd.payment_type_id,pmd.payment_type_index);if(this_pmd !== undefined){var _iteratorNormalCompletion49=true;var _didIteratorError49=false;var _iteratorError49=undefined;try{for(var _iterator49=pmd.control_data[Symbol.iterator](),_step49;!(_iteratorNormalCompletion49 = (_step49 = _iterator49.next()).done);_iteratorNormalCompletion49 = true) {var cd=_step49.value;if(cd.error_text.length > 0){var this_cd=this_pmd.FindPaymentTypeControl(cd.control_id);if(this_cd !== undefined){this_cd.SetErrorText(cd.error_text);}}}}catch(err) {_didIteratorError49 = true;_iteratorError49 = err;}finally {try{if(!_iteratorNormalCompletion49 && _iterator49["return"]){_iterator49["return"]();}}finally {if(_didIteratorError49){throw _iteratorError49;}}}}}}catch(err) {_didIteratorError48 = true;_iteratorError48 = err;}finally {try{if(!_iteratorNormalCompletion48 && _iterator48["return"]){_iterator48["return"]();}}finally {if(_didIteratorError48){throw _iteratorError48;}}}Utilities.Error_Show(this.transaction_error_element,failed_transaction.error_text);this.transaction_error_element.parentElement.scrollIntoView();}},{key:"FindDepartmentControl",value:function FindDepartmentControl(control_id){return this.department_control_data.find(function(c){return c.control_id === control_id;});}},{key:"FindPaymentType",value:function FindPaymentType(payment_type_id,index){return this.payment_type_data.find(function(pmd){return pmd.payment_type_index === index && pmd.payment_type_id === payment_type_id;});} /*
             * Transaction View Code
             */},{key:"SaveNewPaymentTypes", /*
             * Add New Payment Type to Saved Transaction
             *
             */value:function SaveNewPaymentTypes(){var _this17=this;console.log("save new payment types",this.payment_type_data);if(this.transaction_id === -1){alert("There was an error attempting to save this transaction.  The transaction id is unknown.");return;}var PaymentTypesToSave=[];var _iteratorNormalCompletion50=true;var _didIteratorError50=false;var _iteratorError50=undefined;try{for(var _iterator50=this.payment_type_data[Symbol.iterator](),_step50;!(_iteratorNormalCompletion50 = (_step50 = _iterator50.next()).done);_iteratorNormalCompletion50 = true) {var pt=_step50.value;if(pt.transaction_payment_type_id === -1){pt.transaction_id = this.transaction_id;pt.added_after_save = true;PaymentTypesToSave.push(pt);}}}catch(err) {_didIteratorError50 = true;_iteratorError50 = err;}finally {try{if(!_iteratorNormalCompletion50 && _iterator50["return"]){_iterator50["return"]();}}finally {if(_didIteratorError50){throw _iteratorError50;}}}if(!this.ValidateNewPaymentTypes(PaymentTypesToSave)){console.log("failed to validate new payment types");return;}var path=Transaction.GetPath();Utilities.Post_Empty(path + "API/Transaction/AddPaymentTypes",PaymentTypesToSave).then(function(response){console.log("response",response);if(response.ok){response.text().then(function(text){console.log('response text',text);if(text.length > 0){alert("An error occurred attempting to save this payment type:\r\n" + text);}else {Transaction.ShowReceiptDetail(_this17.transaction_id);}});}else {alert("An error occurred attempting to save this payment type:\r\n" + response.text);}});}}],[{key:"GetTransactionList",value:function GetTransactionList(){var page=Transaction.current_page;Utilities.Toggle_Loading_Button(TransactionData.reload_button,true);var path=Transaction.GetPath();var filters=TransactionData.GetTransactionFilters();return Utilities.Get(path + "API/Transaction/Get?page_number=" + page.toString() + filters);}},{key:"GetTransactionPageCount",value:function GetTransactionPageCount(){var path=Transaction.GetPath();var props=[];var filters=TransactionData.GetTransactionFilters();if(filters.length > 0)filters = "?" + filters.substr(1);return Utilities.Get(path + "API/Transaction/PageCount" + filters);}},{key:"GetTransactionFilters",value:function GetTransactionFilters(){var props=[];if(Transaction.name_filter.length > 0)props.push("&display_name_filter=" + Transaction.name_filter);if(Transaction.department_id_filter > 0)props.push("&department_id_filter=" + Transaction.department_id_filter.toString());if(Transaction.transaction_type_filter.length > 0)props.push("&transaction_type_filter=" + Transaction.transaction_type_filter);if(Transaction.completed_filter.length > 0)props.push("&completed_filter=" + Transaction.completed_filter);if(Transaction.modified_only_filter)props.push("&has_been_modified=true");if(Transaction.transaction_number_filter.length > 0)props.push("&transaction_number_filter=" + Transaction.transaction_number_filter);return props.join("");}},{key:"GetSpecificTransaction",value:function GetSpecificTransaction(transaction_id){var path=Transaction.GetPath();return Utilities.Get(path + "API/Transaction/GetTransactionData?transaction_id=" + transaction_id.toString());}},{key:"RenderTransactionList",value:function RenderTransactionList(transactions){var target_container=arguments.length <= 1 || arguments[1] === undefined?null:arguments[1];var footer=arguments.length <= 2 || arguments[2] === undefined?null:arguments[2];var deposit_view=target_container !== null; //Transaction.ViewTransactions();
var container=target_container;if(!deposit_view){container = document.getElementById(TransactionData.transaction_list_view_container);}Utilities.Clear_Element(container);var table=TransactionData.CreateTransactionListTable(deposit_view);container.appendChild(table);var tbody=document.createElement("tbody");table.appendChild(tbody);var colspan=!deposit_view?11:9;var errorMessage=!deposit_view?"No transactions were found to match your filters.":"No transactions were found.";if(transactions.length === 0){tbody.appendChild(Transaction.CreateMessageRow(colspan,errorMessage));}else {var _iteratorNormalCompletion51=true;var _didIteratorError51=false;var _iteratorError51=undefined;try{for(var _iterator51=transactions[Symbol.iterator](),_step51;!(_iteratorNormalCompletion51 = (_step51 = _iterator51.next()).done);_iteratorNormalCompletion51 = true) {var data=_step51.value;tbody.appendChild(TransactionData.CreateTransactionListRow(data,deposit_view));}}catch(err) {_didIteratorError51 = true;_iteratorError51 = err;}finally {try{if(!_iteratorNormalCompletion51 && _iterator51["return"]){_iterator51["return"]();}}finally {if(_didIteratorError51){throw _iteratorError51;}}}}if(footer !== null)table.appendChild(footer);}},{key:"CreateTransactionsTableFooter",value:function CreateTransactionsTableFooter(saved_transaction){var tfoot=document.createElement("tfoot");var tr=document.createElement("tr");tfoot.appendChild(tr);var spacer=Utilities.CreateTableCell("td","Deposit Totals","has-text-right");spacer.colSpan = 6;tr.appendChild(spacer);tr.appendChild(Utilities.CreateTableCell("td",saved_transaction.total_check_count.toString(),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(saved_transaction.total_check_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(saved_transaction.total_cash_amount),"has-text-right"));tr.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(saved_transaction.total_check_amount + saved_transaction.total_cash_amount),"has-text-right"));return tfoot;}},{key:"CreateTransactionListTable",value:function CreateTransactionListTable(){var short_view=arguments.length <= 0 || arguments[0] === undefined?false:arguments[0];var table=document.createElement("table");table.classList.add("table","is-fullwidth");var thead=document.createElement("thead");thead.id = "transaction_list_view_header";table.appendChild(thead);var tr=document.createElement("tr");thead.appendChild(tr);tr.appendChild(Utilities.CreateTableCell("th","Created On","has-text-left","15%"));tr.appendChild(Utilities.CreateTableCell("th","Type","has-text-centered","5%"));tr.appendChild(Utilities.CreateTableCell("th","Number","has-text-left","10%"));tr.appendChild(Utilities.CreateTableCell("th","Status","has-text-left","7.5%")); //!short_view ? "7.5%" : "12.5%"));
tr.appendChild(Utilities.CreateTableCell("th","Department","has-text-left","15%"));tr.appendChild(Utilities.CreateTableCell("th","Received From","has-text-left","12.5%"));tr.appendChild(Utilities.CreateTableCell("th","Checks","has-text-right","7.5%")); //!short_view ? "7.5%" : "12.5%"));
tr.appendChild(Utilities.CreateTableCell("th","$ Check","has-text-right","7.5%"));tr.appendChild(Utilities.CreateTableCell("th","$ Cash","has-text-right","7.5%"));tr.appendChild(Utilities.CreateTableCell("th","$ Total","has-text-right","7.5%"));if(!short_view){var page=Utilities.CreateTableCell("th","Pg: " + Transaction.current_page.toString(),"has-text-centered","5%"); //page.colSpan = 2;
tr.appendChild(page);} //tr.appendChild(Utilities.CreateTableCell("th", "Page: " + Transaction.current_page.toString(), "", "5%"));
return table;}},{key:"CreateTransactionListRow",value:function CreateTransactionListRow(data,short_view){var tr=document.createElement("tr");var data_row=document.createElement("tr");tr.append(data_row);data_row.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(data.created_on),"has-text-left"));if(data.transaction_type === "C" && data.comment.length > 0){var comment_container=document.createElement("tr");comment_container.appendChild(Utilities.CreateTableCell("td",data.comment,"has-text-left"));tr.appendChild(comment_container);} //let transaction_display_value = data.transaction_type + " / " + data.transaction_number;
data_row.appendChild(Utilities.CreateTableCell("td",data.transaction_type,"has-text-centered"));var link=document.createElement("a");link.appendChild(document.createTextNode(data.transaction_number));link.onclick = function(){Transaction.ShowReceiptDetail(data.transaction_id);};var linkCell=Utilities.CreateTableCell("td","","has-text-left");linkCell.appendChild(link);data_row.appendChild(linkCell);var status="";if(data.transaction_type === "R" || data.transaction_type === "C"){if(data.child_transaction_id === null){status = "Incomplete";}else {if(data.child_transaction_id === data.transaction_id){status = "Completed";}else {status = "Deposited"; // maybe turn this into a link to the deposit?
}}}else {if(data.transaction_type === "D"){if(data.child_transaction_id === null){status = "Incomplete";}else {status = "Accepted";}}}data_row.appendChild(Utilities.CreateTableCell("td",status,"has-text-left"));data_row.appendChild(Utilities.CreateTableCell("td",data.department_name,"has-text-left"));data_row.appendChild(Utilities.CreateTableCell("td",data.received_from,"has-text-left"));data_row.appendChild(Utilities.CreateTableCell("td",data.total_check_count.toString(),"has-text-right"));data_row.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(data.total_check_amount),"has-text-right"));data_row.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(data.total_cash_amount),"has-text-right"));data_row.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(data.total_check_amount + data.total_cash_amount),"has-text-right"));if(!short_view){ //let listtd = document.createElement("td");
//listtd.classList.add("has-text-right");
//let detailButton = TransactionData.CreateTableCellIconButton("fa-list", "is-small");
//detailButton.onclick = () =>
//{
//  Transaction.ShowReceiptDetail(data.transaction_id);
//}
//listtd.appendChild(detailButton);
//tr.appendChild(listtd);
var printtd=document.createElement("td");printtd.classList.add("has-text-right");var printButton=TransactionData.CreateTableCellIconButton("fa-print","is-small");printButton.onclick = function(){Transaction.ShowReceipt(data.transaction_id);};printtd.appendChild(printButton);data_row.appendChild(printtd);}return data_row;}},{key:"CreateTableCellIconButton",value:function CreateTableCellIconButton(icon,size){var button=document.createElement("a");button.classList.add("button",size);var span=document.createElement("span");span.classList.add("icon",size);var i=document.createElement("i");i.classList.add("fas",icon);span.appendChild(i);button.appendChild(span);return button;}},{key:"CreateAcceptDepositMenu",value:function CreateAcceptDepositMenu(saved_transaction){saved_transaction.transaction_type = "C"; //saved_transaction.total_check_amount = 0;
//saved_transaction.total_check_count = 0;
//saved_transaction.total_cash_amount = 0;
var df=document.createDocumentFragment();var container=document.createElement("div");container.classList.add("columns","is-multiline");df.appendChild(container);var cash_input=Transaction.ControlGroup.CreateInput("number",15,true,"Cash Amount");var cash_input_container=Transaction.ControlGroup.CreateInputFieldContainer(cash_input,"Cash Amount Collected",true,"is-one-quarter");container.appendChild(cash_input_container);cash_input.oninput = function(event){saved_transaction.total_cash_amount = 0;if(Transaction.ControlGroup.ValidateMoney(cash_input,cash_input_container)){saved_transaction.total_cash_amount = cash_input.valueAsNumber;}};var check_input=Transaction.ControlGroup.CreateInput("number",15,true,"Check Amount");var check_input_container=Transaction.ControlGroup.CreateInputFieldContainer(check_input,"Check Amount Collected",true,"is-one-quarter");container.appendChild(check_input_container);check_input.oninput = function(event){saved_transaction.total_check_amount = 0;if(Transaction.ControlGroup.ValidateMoney(check_input,check_input_container)){saved_transaction.total_check_amount = check_input.valueAsNumber;}};var check_count_input=Transaction.ControlGroup.CreateInput("number",15,true,"# of Checks");var check_count_input_container=Transaction.ControlGroup.CreateInputFieldContainer(check_count_input,"# of Checks",true,"is-one-quarter");container.appendChild(check_count_input_container);check_count_input.oninput = function(event){saved_transaction.total_check_count = 0;if(Transaction.ControlGroup.ValidateNumber(check_count_input,check_count_input_container)){saved_transaction.total_check_count = check_count_input.valueAsNumber;}};var comment_input=document.createElement("textarea");comment_input.maxLength = 500;comment_input.required = false;comment_input.classList.add("textarea","is-normal");comment_input.rows = 4;comment_input.value = "";comment_input.oninput = function(event){saved_transaction.comment = comment_input.value;};var comment_input_container=Transaction.ControlGroup.CreateInputFieldContainer(comment_input,"Comments ** optional",true,"is-half");container.appendChild(comment_input_container);var save_button=document.createElement("button");save_button.classList.add("button","is-success");save_button.appendChild(document.createTextNode("Create Receipt For This Deposit"));save_button.onclick = function(){console.log("Create C Transaction",saved_transaction); // validate
Utilities.Toggle_Loading_Button(save_button,true);if(saved_transaction.total_cash_amount === 0 && saved_transaction.total_check_amount === 0 && saved_transaction.comment.length === 0){alert("In order to create a receipt for this deposit, you must enter this information.");return;}var path=Transaction.GetPath();Utilities.Post(path + "API/Transaction/Save",saved_transaction).then(function(response){Transaction.currentReceipt.ShowReceipt(response);Transaction.ResetReceipt();Transaction.GetTransactionList(Transaction.current_page,false).then(function(){Utilities.Toggle_Loading_Button(save_button,false);}); // need to reset the current transaction
// and display the one that I just downloaded.
},function(error){console.log("post error occurred",error);});};var save_button_container=Transaction.ControlGroup.CreateInputFieldContainer(save_button,"",true,"is-one-quarter");container.appendChild(save_button_container);return df;}},{key:"SaveDepositReceipt",value:function SaveDepositReceipt(){}}]);return TransactionData;})();TransactionData.reload_button = 'filterRefreshButton';TransactionData.action_container = 'action_view';TransactionData.transaction_view_container = "transaction_view";TransactionData.transaction_list_view_container = 'transaction_list_view';TransactionData.transaction_view_filters_container = "transaction_view_filters";Data.TransactionData = TransactionData;})(Data = Transaction.Data || (Transaction.Data = {}));})(Transaction || (Transaction = {})); //# sourceMappingURL=TransactionData.js.map

