"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var t=0,i=Array(n.length);t<n.length;t++)i[t]=n[t];return i}return Array.from(n)}function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),__awaiter=undefined&&undefined.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},Utilities,Transaction;(function(n){function t(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("hide");n.classList.remove("show");n.classList.remove("show-inline");n.classList.remove("show-flex")}function r(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show-flex")}function a(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function v(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline-flex");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function y(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-flex");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show")}function o(n,u,f){var e,o;typeof n=="string"&&(n=document.getElementById(n));u&&(i(n),e=document.createElement("div"),e.classList.add("notification"),e.classList.add("is-danger"),o=document.createElement("button"),o.classList.add("delete"),o.onclick=function(){t(n)},e.appendChild(o),Array.isArray(u)?function(){var n=document.createElement("ul");u.forEach(function(t){var i=document.createElement("li");i.appendChild(document.createTextNode(t));n.appendChild(i)});e.appendChild(n)}():e.appendChild(document.createTextNode(u)),n.appendChild(e));r(n);(f==undefined||f===!0)&&window.setTimeout(function(){t(n)},3e4)}function p(n,t){i(n);n.appendChild(document.createTextNode(t))}function i(n){if(n!==null&&n!==undefined)while(n.firstChild)n.removeChild(n.firstChild)}function w(n,t){var r=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],i=document.createElement("option");return i.value=n,i.text=t,i.selected=r,i}function s(n){return typeof n=="string"&&(n=document.getElementById(n)),n.value}function b(n,t){typeof n=="string"&&(n=document.getElementById(n));n.value=t}function u(n,t){typeof n=="string"&&(n=document.getElementById(n));i(n);n.appendChild(document.createTextNode(t))}function h(n){var u=n.replace("nav-",""),r=document.querySelectorAll("#menuTabs > li > a"),t,i;if(r.length>0)for(t=0;t<r.length;t++)i=r.item(t),i.id===n?i.parentElement.classList.add("is-active"):i.parentElement.classList.remove("is-active");f("#views > section",u)}function k(n,t,i){c(n,"nav-"+i);f(t,i)}function c(n,t){var u=document.querySelectorAll(n),i,r;if(u.length>0)for(i=0;i<u.length;i++)r=u.item(i),r.id===t?r.classList.add("is-active"):r.classList.remove("is-active")}function f(n,i){var e=document.querySelectorAll(n),u,f;if(e.length>0)for(u=0;u<e.length;u++)f=e.item(u),f.id===i?r(f):t(f)}function d(n){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"});case 2:if(i=t.sent,i.ok){t.next=5;break}throw new Error(i.statusText);case 5:return t.next=7,i.text();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}))}function g(n){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"});case 2:if(i=t.sent,i.ok){t.next=5;break}throw new Error(i.statusText);case 5:return t.next=7,i.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}))}function nt(n,t){return fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){if(!n.ok)throw new Error(n.statusText);return n.json()})}function tt(n,t){return fetch(n,{method:"POST",body:t!==null?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){return n})}function it(n){return n.toLocaleString("en-US",{style:"currency",currency:"USD"})}function rt(n){if(n instanceof Date)return n.toLocaleDateString("en-us");var t=new Date(n);return t.toLocaleDateString("en-US")}function ut(n){return n instanceof Date?n.toLocaleString("en-us"):new Date(n).toLocaleString("en-US")}function ft(n,t,i){var r,u;return(typeof n=="string"&&(n=document.getElementById(n)),r=n,r.tagName.toLowerCase()==="select"?r.parentElement.classList.remove("is-danger"):r.classList.remove("is-danger"),u=s(r).trim(),u.length==0)?(r.tagName.toLowerCase()==="select"?r.parentElement.classList.add("is-danger"):r.classList.add("is-danger"),o(t,i),r.focus(),r.scrollTo(),""):u}function et(n,t){typeof n=="string"&&(n=document.getElementById(n));var i=n;i.disabled=t;i.classList.toggle("is-loading",t)}function ot(n){var u=document.createElement("li"),t,i,r,e,o;if(n.selected&&u.classList.add("is-active"),t=document.createElement("a"),t.id=n.id,t.onclick=function(){l(n)},n.icon.length>0){i=document.createElement("span");i.classList.add("icon");i.classList.add(Transaction.app_input_size);var s=document.createElement("i"),a=n.icon.split(" "),f=!0,h=!1,c=undefined;try{for(r=a[Symbol.iterator]();!(f=(e=r.next()).done);f=!0)o=e.value,s.classList.add(o)}catch(v){h=!0;c=v}finally{try{!f&&r["return"]&&r["return"]()}finally{if(h)throw c;}}i.appendChild(s);t.appendChild(i)}return t.appendChild(document.createTextNode(n.label)),u.appendChild(t),u}function l(n){u("menuTitle",n.title);u("menuSubTitle",n.subTitle);h(n.id);document.getElementById(n.autofocusId).focus()}function st(t,i){var h=document.getElementById(t),u=!0,f=!1,e=undefined,r,o,s;try{for(r=i[Symbol.iterator]();!(u=(o=r.next()).done);u=!0)s=o.value,h.appendChild(n.Create_Menu_Element(s))}catch(c){f=!0;e=c}finally{try{!u&&r["return"]&&r["return"]()}finally{if(f)throw e;}}}function ht(){return(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1?"Opera":navigator.userAgent.indexOf("Chrome")!=-1?"Chrome":navigator.userAgent.indexOf("Safari")!=-1?"Safari":navigator.userAgent.indexOf("Firefox")!=-1?"Firefox":navigator.userAgent.indexOf("MSIE")!=-1||!!document.DOCUMENT_NODE==!0?"IE":"unknown"}function ct(n){var t="/",i=window.location.pathname.toLowerCase().indexOf(n);return i==0&&(t=n+"/"),t}function lt(n){var v=arguments.length<=1||arguments[1]===undefined?[]:arguments[1],y=arguments.length<=2||arguments[2]===undefined?[]:arguments[2],i=document.createElement("div"),r,p,u,f,w,o,s,b,t;i.classList.add("level");var h=!0,k=!1,d=undefined;try{for(r=n[Symbol.iterator]();!(h=(p=r.next()).done);h=!0)t=p.value,i.appendChild(e(t))}catch(c){k=!0;d=c}finally{try{!h&&r["return"]&&r["return"]()}finally{if(k)throw d;}}if(v.length>0){u=document.createElement("div");u.classList.add("level-left");i.appendChild(u);var l=!0,g=!1,nt=undefined;try{for(f=v[Symbol.iterator]();!(l=(w=f.next()).done);l=!0)t=w.value,u.appendChild(e(t))}catch(c){g=!0;nt=c}finally{try{!l&&f["return"]&&f["return"]()}finally{if(g)throw nt;}}}if(y.length>0){o=document.createElement("div");o.classList.add("level-right");i.appendChild(o);var a=!0,tt=!1,it=undefined;try{for(s=y[Symbol.iterator]();!(a=(b=s.next()).done);a=!0)t=b.value,o.appendChild(e(t))}catch(c){tt=!0;it=c}finally{try{!a&&s["return"]&&s["return"]()}finally{if(tt)throw it;}}}return i}function e(n){var f,u=document.createElement("div"),t,i,r;return(f=u.classList).add.apply(f,["level-item"].concat(_toConsumableArray(n.classes))),t=document.createElement("div"),u.appendChild(t),n.heading.length>0&&(i=document.createElement("p"),i.classList.add("heading"),i.appendChild(document.createTextNode(n.heading)),t.appendChild(i)),n.title_text.length>0?(r=document.createElement("p"),r.classList.add("title"),r.appendChild(document.createTextNode(n.title_text)),t.appendChild(r)):n.title!==null&&t.appendChild(n.title),u}function at(n,t,i){var u=arguments.length<=3||arguments[3]===undefined?"":arguments[3],f=arguments.length<=4||arguments[4]===undefined?-1:arguments[4],r;return n!=="td"&&n!=="th"&&(n="td"),r=document.createElement(n),u.length>0&&(r.style.width=u),t.length>0&&r.appendChild(document.createTextNode(t)),i.length>0&&r.classList.add(i),f>-1&&(r.colSpan=f),r}n.Hide=t;n.Show=r;n.Show_Inline=a;n.Show_Inline_Flex=v;n.Show_Flex=y;n.Error_Show=o;n.Simple_Error_Show=p;n.Clear_Element=i;n.Create_Option=w;n.Get_Value=s;n.Set_Value=b;n.Set_Text=u;n.Show_Menu=h;n.Handle_Tabs=k;n.Activate_Inactivate_Selector=c;n.Show_Hide_Selector=f;n.Get_Empty=d;n.Get=g;n.Post=nt;n.Post_Empty=tt;n.Format_Amount=it;n.Format_Date=rt;n.Format_DateTime=ut;n.Validate_Text=ft;n.Toggle_Loading_Button=et;n.Create_Menu_Element=ot;n.Update_Menu=l;n.Build_Menu_Elements=st;n.CheckBrowser=ht;n.Get_Path=ct;n.Create_Centered_Level=lt;n.CreateTableCell=at})(Utilities||(Utilities={})),function(n){var t=function t(){_classCallCheck(this,t);this.label="";this.value=""};n.SimpleValue=t}(Utilities||(Utilities={}));__awaiter=undefined&&undefined.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},function(n){function o(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.Department.GetDepartments().then(function(t){var c,i,l,r,e,o,u,a,v,f,y;n.payment_types=[];n.controls=[];n.departments=t;n.DepartmentControl=n.Department.CreateDepartmentElement(n.departments);w();var s=!0,p=!1,b=undefined;try{for(c=function(){var t=l.value,s=n.payment_types.map(function(n){return n.payment_type_id}),f,i;n.payment_types=n.payment_types.concat(t.payment_types.filter(function(n){return s.indexOf(n.payment_type_id)===-1}));f=t.controls.map(function(n){return n.control_id});n.controls=n.controls.concat(t.controls.filter(function(n){return f.indexOf(n.control_id)===-1}));t.control_groups=n.ControlGroup.CreateControlGroups(t.controls);r=!0;e=!1;o=undefined;try{for(u=t.payment_types[Symbol.iterator]();!(r=(a=u.next()).done);r=!0)i=a.value,i.control_groups=n.ControlGroup.CreateControlGroups(i.controls)}catch(h){e=!0;o=h}finally{try{!r&&u["return"]&&u["return"]()}finally{if(e)throw o;}}},i=n.departments[Symbol.iterator]();!(s=(l=i.next()).done);s=!0)c()}catch(k){p=!0;b=k}finally{try{!s&&i["return"]&&i["return"]()}finally{if(p)throw b;}}var h=!0,d=!1,g=undefined;try{for(v=function(){var t=y.value,i=n.controls.map(function(n){return n.control_id});n.controls=n.controls.concat(t.controls.filter(function(n){return i.indexOf(n.control_id)===-1}))},f=n.payment_types[Symbol.iterator]();!(h=(y=f.next()).done);h=!0)v()}catch(k){d=!0;g=k}finally{try{!h&&f["return"]&&f["return"]()}finally{if(d)throw g;}}});case 2:return t.next=4,n.GetAllNames().then(function(n){var o=document.getElementById("nameFilter"),s=document.getElementById("depositNameFilter"),r=!0,u=!1,f=undefined,i,e,t;try{for(i=n[Symbol.iterator]();!(r=(e=i.next()).done);r=!0)t=e.value,o.add(Utilities.Create_Option(t,t,!1)),s.add(Utilities.Create_Option(t,t,!1))}catch(h){u=!0;f=h}finally{try{!r&&i["return"]&&i["return"]()}finally{if(u)throw f;}}});case 4:return t.next=6,n.GetTransactionList(1);case 6:setInterval(function(){var i=new Date,t=i.getHours();t>5&&t<19&&n.GetTransactionList(n.current_page,!1)},3e5);case 7:case"end":return t.stop()}},t,this)}))}function s(t){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.Data.TransactionData.GetSpecificTransaction(t).then(function(t){console.log("transaction to show",t);n.currentReceipt=new n.Receipt(t);n.currentReceipt.ShowReceipt(t)});case 2:case"end":return i.stop()}},i,this)}))}function h(t){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.Data.TransactionData.GetSpecificTransaction(t).then(function(t){console.log("transaction to show",t);n.currentReceipt=new n.Receipt(t);n.ViewReceiptDetail()});case 2:case"end":return i.stop()}},i,this)}))}function u(t){var i=arguments.length<=1||arguments[1]===undefined?!0:arguments[1];return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.current_page=t,r.next=3,n.Data.TransactionData.GetTransactionList().then(function(t){n.transactions=t;n.Data.TransactionData.RenderTransactionList(t);console.log("transactions",n.transactions);Utilities.Toggle_Loading_Button(n.Data.TransactionData.reload_button,!1);i&&n.ViewTransactions()});case 3:return r.next=5,n.Data.TransactionData.GetTransactionPageCount().then(function(t){n.page_count=t;ut()});case 5:case"end":return r.stop()}},r,this)}))}function c(){n.currentReceipt=new n.Receipt;var t=document.getElementById("linkReceiptInProgress");t.classList.remove("has-background-grey-light","has-text-grey");t.style.cursor="pointer";n.ViewReceiptDetail()}function l(){n.currentReceipt=new n.Receipt;n.currentReceipt=null;var t=document.getElementById("linkReceiptInProgress");t.classList.add("has-background-grey-light","has-text-grey");t.style.cursor="default"}function a(){}function v(){var n="/",t=window.location.pathname.toLowerCase().indexOf("/clayfinancial");return t==0&&(n="/clayfinancial/"),n}function y(t){var i=n.payment_types.filter(function(n){return n.payment_type_id===t});return i.length===1?i[0]:null}function p(t){var i=n.controls.filter(function(n){return n.control_id===t});return i.length===1?i[0]:null}function w(){var s=document.getElementById("departmentFilter"),t,h,u,f,e,i,r;s.add(Utilities.Create_Option("","All Departments",!0));var o=!0,c=!1,l=undefined;try{for(t=n.departments[Symbol.iterator]();!(o=(h=t.next()).done);o=!0)u=h.value,s.add(Utilities.Create_Option(u.department_id.toString(),u.name,!1))}catch(a){c=!0;l=a}finally{try{!o&&t["return"]&&t["return"]()}finally{if(c)throw l;}}f=document.getElementById("nameFilter");f.add(Utilities.Create_Option("mine","My Transactions",!0));f.add(Utilities.Create_Option("","All Users",!1));e=document.getElementById("depositNameFilter");e.add(Utilities.Create_Option("","Select A Name to Deposit",!0));e.add(Utilities.Create_Option("mine","My Transactions",!1));i=document.getElementById("statusFilter");i.add(Utilities.Create_Option("","All Statuses",!1));i.add(Utilities.Create_Option("i","Incomplete",!0));i.add(Utilities.Create_Option("c","Completed",!1));r=document.getElementById("typeFilter");r.add(Utilities.Create_Option("","All Types",!0));r.add(Utilities.Create_Option("R","Receipts",!1));r.add(Utilities.Create_Option("D","Deposits",!1))}function b(t){var i=t||window.event;t.keyCode==13&&(console.log("enter"),n.FilterTransactions())}function k(){n.department_id_filter=parseInt(Utilities.Get_Value("departmentFilter"));n.name_filter=Utilities.Get_Value("nameFilter");n.completed_filter=Utilities.Get_Value("statusFilter");n.transaction_type_filter=Utilities.Get_Value("typeFilter");n.transaction_number_filter=Utilities.Get_Value("transactionNumberFilter");n.modified_only_filter=document.getElementById("modifiedFilter").checked;n.GetTransactionList(1)}function d(){n.currentReceipt===null||f()}function r(){Utilities.Hide(n.deposit_view_container);Utilities.Hide(n.Data.TransactionData.transaction_view_container);Utilities.Hide(n.Data.TransactionData.action_container);Utilities.Hide(n.Receipt.receipt_container)}function f(){r();Utilities.Show(n.Data.TransactionData.action_container)}function g(){r();Utilities.Show(n.Receipt.receipt_container)}function nt(){r();Utilities.Show(n.Data.TransactionData.transaction_view_container)}function tt(){r();Utilities.Show(n.deposit_view_container);Utilities.Hide("createDepositButton");Utilities.Set_Value("depositNameFilter","")}function it(t){t.getAttribute("disabled")===null&&u(n.current_page-1)}function rt(t){t.getAttribute("disabled")===null&&u(n.current_page+1)}function ut(){var i=document.getElementById("resultsPreviousPage"),r=document.getElementById("resultsNextPage"),t;n.current_page===1?i.setAttribute("disabled",""):i.removeAttribute("disabled");n.page_count<=n.current_page?r.setAttribute("disabled",""):r.removeAttribute("disabled");t=document.getElementById("resultsPaginationList");Utilities.Clear_Element(t);t.appendChild(ft())}function ft(){var f=n.current_page,e=n.page_count,u=document.createDocumentFragment(),r;if(f<1&&(n.current_page=1),f>e&&(f=e),e<8){for(r=1;r<=e;r++)u.appendChild(t(r,r===f));return u}if(f===3){for(r=1;r<=4;r++)u.appendChild(t(r,r===f));for(u.appendChild(i()),r=e-1;r<=e;r++)u.appendChild(t(r,r===f));return u}if(f===e-2){for(r=1;r<=2;r++)u.appendChild(t(r,r===f));for(u.appendChild(i()),r=e-3;r<=e;r++)u.appendChild(t(r,r===f));return u}if(f<3||f>e-3){for(r=1;r<=3;r++)u.appendChild(t(r,r===f));for(u.appendChild(i()),r=e-2;r<=e;r++)u.appendChild(t(r,r===f));return u}for(u.appendChild(t(1,!1)),u.appendChild(i()),r=f-1;r<=f+1;r++)u.appendChild(t(r,r===f));return u.appendChild(i()),u.appendChild(t(e,!1)),u}function t(t,i){var u=document.createElement("li"),r=document.createElement("a");return r.classList.add("pagination-link"),r.setAttribute("aria-label","Goto page "+t.toString()),i?(r.classList.add("is-current"),r.setAttribute("aria-current","page"),r.style.cursor="default"):r.onclick=function(){n.GetTransactionList(t);var i=document.getElementById("transaction_list_view_header");i!==null&&i.scrollIntoView(!0)},r.appendChild(document.createTextNode(t.toString())),u.appendChild(r),u}function i(){var t=document.createElement("li"),n=document.createElement("span");return n.classList.add("pagination-ellipsis"),n.innerHTML="&hellip;",t.appendChild(n),t}function et(n,t){var r=document.createElement("tr"),i=document.createElement("td");return i.colSpan=n,i.appendChild(document.createTextNode(t)),r.appendChild(i),r}function ot(){n.editing_control_data=null;n.editing_payment_method_data=null;document.getElementById("change_transaction").classList.add("is-active")}function st(){document.getElementById("change_transaction").classList.remove("is-active")}function ht(t,i,r){Utilities.Set_Text("change_field_label",r);n.ShowChangeModal();n.Data.ControlData.GetAndDisplayControlHistory(t,i).then(function(){})}function ct(t,i,r,u){Utilities.Set_Text("change_field_label",u);n.ShowChangeModal();n.Data.PaymentMethodData.GetAndDisplayHistory(t,r,i).then(function(){})}function lt(){var t,i,r;if(Utilities.Toggle_Loading_Button("change_transaction_save",!0),t=Utilities.Get_Value(n.reason_for_change_input).trim(),t.length===0){i=document.getElementById(n.reason_for_change_input);r=document.getElementById(n.reason_for_change_input_container);n.ControlGroup.UpdateInputError(i,r,"This is required.");Utilities.Toggle_Loading_Button("change_transaction_save",!1);return}if(n.editing_control_data!==null){if(!n.editing_control_data.Validate()){Utilities.Toggle_Loading_Button("change_transaction_save",!1);return}n.editing_control_data.reason_for_change=t;n.editing_control_data.SaveControlChanges();n.GetTransactionList(n.current_page)}else{if(!n.editing_payment_method_data.Validate()){Utilities.Toggle_Loading_Button("change_transaction_save",!1);return}n.editing_payment_method_data.reason_for_change=t;n.editing_payment_method_data.SaveChanges();n.GetTransactionList(n.current_page)}}function at(){var t=n.GetPath();return Utilities.Get(t+"API/Transaction/GetAllNames")}function e(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Utilities.Hide("createDepositButton"),Utilities.Set_Value("depositCount","0"),i=Utilities.Get_Value("depositNameFilter"),!(i.length===0)){t.next=5;break}return t.abrupt("return");case 5:return r=n.GetPath(),t.next=8,Utilities.Get_Empty(r+"API/Transaction/GetDepositCount?name="+i).then(function(n){var t=parseInt(n);Utilities.Set_Value("depositCount",n);t>0&&Utilities.Show("createDepositButton")});case 8:case"end":return t.stop()}},t,this)}))}function vt(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Utilities.Toggle_Loading_Button("createDepositButton",!0),t.next=3,e().then(function(){var t=parseInt(Utilities.Get_Value("depositCount")),i,r;if(!isNaN(t)&&t>0)i=Utilities.Get_Value("depositNameFilter"),r=n.GetPath(),Utilities.Post(r+"API/Transaction/CreateDeposit?selected_user_display_name="+i,null).then(function(t){var i=t.transaction_id;n.ShowReceiptDetail(i);n.GetTransactionList(n.current_page,!1);Utilities.Toggle_Loading_Button("createDepositButton",!1)},function(n){console.log("error!",n);Utilities.Toggle_Loading_Button("createDepositButton",!1)});else{Utilities.Toggle_Loading_Button("createDepositButton",!1);alert("The Receipts ready for deposit was updated, a deposit can not be created at this time.");return}});case 3:case"end":return t.stop()}},t,this)}))}n.app_input_size="is-normal";n.error_scrolled=!1;n.departments=[];n.payment_types=[];n.controls=[];n.transactions=[];n.currentReceipt=null;n.DepartmentControl=null;n.DepartmentControlContainer=null;n.current_page=1;n.page_count=0;n.department_id_filter=-1;n.name_filter="mine";n.completed_filter="i";n.transaction_type_filter="";n.modified_only_filter=!1;n.transaction_number_filter="";n.editing_control_data=null;n.editing_payment_method_data=null;n.reason_for_change_input="reason_for_change";n.reason_for_change_input_container="reason_for_change_container";n.change_edit_container="change_edit_container";n.change_transaction_history_table_header="change_transaction_history_header";n.change_transaction_history_table_body="change_transaction_history_table";n.deposit_view_container="deposit_view";n.Start=o;n.ShowReceipt=s;n.ShowReceiptDetail=h;n.GetTransactionList=u;n.NewReceipt=c;n.ResetReceipt=l;n.NewDeposit=a;n.GetPath=v;n.FindPaymentType=y;n.FindControl=p;n.SearchOnEnter=b;n.FilterTransactions=k;n.ViewReceiptInProgress=d;n.ViewReceiptDetail=f;n.ViewPrintableReceipt=g;n.ViewTransactions=nt;n.ViewDeposit=tt;n.PreviousPage=it;n.NextPage=rt;n.CreateMessageRow=et;n.ShowChangeModal=ot;n.CloseChangeModal=st;n.LoadControlDataChange=ht;n.LoadPaymentTypeDataChange=ct;n.SaveChanges=lt;n.GetAllNames=at;n.GetDepositCount=e;n.CreateDeposit=vt}(Transaction||(Transaction={})),function(n){var t=function t(n,i,r){var o;_classCallCheck(this,t);this.classes=[];this.heading="";this.title=null;this.title_text="";this.heading=n;this.title=r;i.length>0&&(this.title_text=i,this.title=null);for(var f=arguments.length,e=Array(f>3?f-3:0),u=3;u<f;u++)e[u-3]=arguments[u];e.length>0&&(o=this.classes).push.apply(o,e)};n.LevelItem=t}(Utilities||(Utilities={})),function(n){var t=function(){function t(){_classCallCheck(this,t);this.percent_used=0;this.controls=[]}return _createClass(t,[{key:"CreateControlData",value:function(t){var l=arguments.length<=1||arguments[1]===undefined?!0:arguments[1],e=[],r=document.createElement("div"),i,o,s,u;r.classList.add("columns","is-multiline");t.appendChild(r);var f=!0,h=!1,c=undefined;try{for(i=this.controls[Symbol.iterator]();!(f=(o=i.next()).done);f=!0)s=o.value,u=new n.Data.ControlData(s,-1,l),e.push(u),r.appendChild(u.container_element)}catch(a){h=!0;c=a}finally{try{!f&&i["return"]&&i["return"]()}finally{if(h)throw c;}}return e}}],[{key:"CreateControlGroups",value:function(i){var e=[],o=new t,f=!0,s=!1,h=undefined,u,c,r;try{for(u=i[Symbol.iterator]();!(f=(c=u.next()).done);f=!0)r=c.value,r.is_active&&(r.rendered_input_element=n.Control.CreateControl(r),o.controls.push(r))}catch(l){s=!0;h=l}finally{try{!f&&u["return"]&&u["return"]()}finally{if(s)throw h;}}return e.push(o),e}},{key:"CreateSavedControlGroups",value:function(i){var e=[],o=new t,f=!0,s=!1,h=undefined,r,c,u;try{for(r=i[Symbol.iterator]();!(f=(c=r.next()).done);f=!0)u=c.value,u.control.rendered_input_element=n.Control.CreateSavedControl(u),o.controls.push(u.control)}catch(l){s=!0;h=l}finally{try{!f&&r["return"]&&r["return"]()}finally{if(s)throw h;}}return e.push(o),e}},{key:"CreateInputFieldContainerByControl",value:function(n,t){var i=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],r=arguments.length<=3||arguments[3]===undefined?"":arguments[3];return this.CreateInputFieldContainer(t,n.label,i,n.render_hints)}},{key:"CreateInputFieldContainer",value:function(t,i){var a=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],s=arguments.length<=3||arguments[3]===undefined?"":arguments[3],v=arguments.length<=4||arguments[4]===undefined?!1:arguments[4],e=null,r,f,u,h,c,l,o;return(t.getAttribute("transaction_id")!==null&&function(){var r=t.getAttribute("transaction_id"),u=t.getAttribute("control_data_id");u!==null?e=function(){n.LoadControlDataChange(u,r,i)}:function(){var u=t.getAttribute("payment_method_data_id"),f=t.getAttribute("is_cash").toLowerCase()==="true";e=function(){n.LoadPaymentTypeDataChange(u,f,r,i)}}()}(),e!==null&&(t.onclick=function(){e()}),r=document.createElement("div"),r.classList.add("field"),f=document.createElement("label"),f.classList.add("label",n.app_input_size),i.length>0?f.appendChild(document.createTextNode(i)):f.innerHTML="&nbsp;",r.appendChild(f),t.getAttribute("transaction_id")!==null&&(u=document.createElement("a"),u.style.marginLeft=".5em",u.style.fontSize=".75em",u.style.fontWeight="400",u.onclick=function(){e()},u.appendChild(document.createTextNode("edit")),f.appendChild(u)),h=document.createElement("div"),h.classList.add("control"),h.appendChild(t),r.appendChild(h),v&&(c=document.createElement("p"),c.classList.add("help","guide"),r.appendChild(c)),l=document.createElement("p"),l.classList.add("help","is-danger"),r.appendChild(l),a)?(o=document.createElement("div"),o.classList.add("column"),s.length>0&&o.classList.add(s),o.appendChild(r),o):(s.length>0&&r.classList.add(s),r)}},{key:"CreateButtonlistFieldContainer",value:function(t,i){var p=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],e=arguments.length<=3||arguments[3]===undefined?"":arguments[3],r=document.createElement("div"),u,o,s,h,l,a,f;r.classList.add("field");u=document.createElement("label");u.classList.add("label",n.app_input_size);i.length>0?u.appendChild(document.createTextNode(i)):u.innerHTML="&nbsp;";r.appendChild(u);o=document.createElement("div");o.classList.add("control");s=document.createElement("div");s.classList.add("buttons");var c=!0,v=!1,y=undefined;try{for(h=t[Symbol.iterator]();!(c=(l=h.next()).done);c=!0)a=l.value,s.appendChild(a)}catch(w){v=!0;y=w}finally{try{!c&&h["return"]&&h["return"]()}finally{if(v)throw y;}}return(o.appendChild(s),r.appendChild(o),p)?(f=document.createElement("div"),f.classList.add("column"),e.length>0&&f.classList.add(e),f.appendChild(r),f):(e.length>0&&r.classList.add(e),r)}},{key:"CreateSelectFieldContainerByControl",value:function(n,t){var i=arguments.length<=2||arguments[2]===undefined?!1:arguments[2];return this.CreateSelectFieldContainer(t,n.label,i,n.render_hints)}},{key:"CreateSelectFieldContainer",value:function(t,i){var h=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],s=arguments.length<=3||arguments[3]===undefined?"":arguments[3],r=document.createElement("div"),u,f,e,o;return r.classList.add("field"),h&&(r.classList.add("column"),s.length>0&&r.classList.add(s)),u=document.createElement("label"),u.classList.add("label","is-normal"),u.appendChild(document.createTextNode(i)),r.appendChild(u),t.getAttribute("transaction_id")!==null&&function(){var r=document.createElement("a"),f,e;r.style.marginLeft=".5em";r.style.fontSize=".75em";r.style.fontWeight="400";f=t.getAttribute("transaction_id");e=t.getAttribute("control_data_id");r.onclick=function(){n.LoadControlDataChange(e,f,i)};r.appendChild(document.createTextNode("edit"));u.appendChild(r)}(),f=document.createElement("div"),f.classList.add("control"),e=document.createElement("div"),e.classList.add("select","is-normal"),e.appendChild(t),f.appendChild(e),r.appendChild(f),o=document.createElement("p"),o.classList.add("help","is-danger"),r.appendChild(o),r}},{key:"CreateInput",value:function(n,t,i,r){var f=arguments.length<=4||arguments[4]===undefined?"":arguments[4],u=document.createElement("input");return u.type=n,u.maxLength=t,u.classList.add("input","is-normal"),u.type==="number"&&(u.onwheel=function(n){n.preventDefault()},u.step="0.01",u.min="0"),u.placeholder=r,u.required=i,u.value=f,u}},{key:"UpdateSelectError",value:function(t){var i=arguments.length<=1||arguments[1]===undefined?"":arguments[1],r=t.querySelector("p.help.is-danger"),u=t.querySelector("div.select");i.length===0?(Utilities.Clear_Element(r),u.classList.remove("is-danger")):(Utilities.Simple_Error_Show(r,i),u.classList.add("is-danger"),n.error_scrolled||(n.error_scrolled=!0,t.scrollIntoView(!0)))}},{key:"UpdateInputError",value:function(t,i){var r=arguments.length<=2||arguments[2]===undefined?"":arguments[2],u=i.querySelector("p.help.is-danger");r.length===0?(Utilities.Clear_Element(u),t.classList.remove("is-danger")):(Utilities.Simple_Error_Show(u,r),t.classList.add("is-danger"),n.error_scrolled||(n.error_scrolled=!0,i.scrollIntoView(!0)))}},{key:"UpdateInputGuide",value:function(n){var t=arguments.length<=1||arguments[1]===undefined?"":arguments[1],i=n.querySelector("p.help.guide");if(i===null){console.log("UpdateInputGuide called, no guide elements found",n,t);return}Utilities.Set_Text(i,t)}},{key:"ValidateDropdown",value:function(n,i,r){var u="";return n.value==="-1"&&(u="You must choose one of these options."),r.indexOf(n.value)===-1&&u.length===0&&(u="Please select a valid value."),t.UpdateSelectError(i,u),u.length===0}},{key:"ValidateDate",value:function(n,i){var r="";return n.valueAsDate===null&&n.required&&(r="You must selected a date."),t.UpdateInputError(n,i,r),r.length===0}},{key:"ValidateText",value:function(n,i){var r="";return n.required&&n.value.length===0&&(r="This field is required."),n.maxLength>0&&n.value.length>n.maxLength&&r.length===0&&(r="You entered "+n.value.length.toString()+" characters but "+n.maxLength.toString()+" is the maximum number of characters allowed."),t.UpdateInputError(n,i,r),r.length===0}},{key:"ValidateNumber",value:function(n,i){var r="";return n.value.length===0&&(r="You must enter a number. (No commas or $ allowed)."),n.valueAsNumber===NaN&&r.length===0&&(r="Please enter Numbers and Decimal points only."),t.UpdateInputError(n,i,r),r.length===0}},{key:"ValidateCount",value:function(n,i){var r="";return n.value.length===0&&n.required&&(r="You must enter a number. (No commas, decimal points, or $ allowed)."),n.valueAsNumber===NaN&&r.length===0&&(r="Please enter Numbers only."),n.valueAsNumber<0&&(r="This value must be 0 or greater."),t.UpdateInputError(n,i,r),r.length===0}},{key:"ValidateMoney",value:function(n,i){var r="",u;return n.value.length===0&&(r="You must enter a number. (No commas or $ allowed)."),n.valueAsNumber===NaN&&r.length===0&&(r="Please enter Numbers and Decimal points only."),n.valueAsNumber<0&&r.length===0&&(r="Negative numbers are not allowed."),u=n.value.split("."),u.length===2&&r.length===0&&u[1].length>2&&(r="Too many digits after the decimal place. Amounts are limited to 2 digits after the decimal place."),t.UpdateInputError(n,i,r),r.length===0}}]),t}();n.ControlGroup=t}(Transaction||(Transaction={}));__awaiter=undefined&&undefined.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},function(n){var t;(function(t){var i=function(){function i(n,t,r,u){t===undefined&&(t=!1);var f=arguments.length<=4||arguments[4]===undefined?null:arguments[4];_classCallCheck(this,i);this.payment_method_data_id=-1;this.prior_payment_method_data_id=-1;this.transaction_payment_type_id=-1;this.transaction_id=-1;this.cash_amount=0;this.check_amount=0;this.check_count=0;this.check_number="";this.check_from="";this.paying_for="";this.is_active=!0;this.added_after_save=!1;this.modified_by="";this.modified_on=new Date;this.reason_for_change="";this.error_text="";this.is_cash=!1;this.show_cancel=!1;this.cash_amount_input_element=null;this.cash_amount_input_element_container=null;this.check_amount_input_element=null;this.check_amount_input_element_container=null;this.check_count_input_element=null;this.check_count_input_element_container=null;this.check_number_input_element=null;this.check_number_input_element_container=null;this.paying_for_input_element=null;this.paying_for_input_element_container=null;this.check_from_input_element=null;this.check_from_input_element_container=null;this.add_check_button_element=null;this.cancel_check_button_element=null;this.check_buttons_container_element=null;this.payment_method_change=function(){};this.validate_money_regex="(?=.*?d)^$?(([1-9]d{0,2}(,d{3})*)|d+)?(.d{1,2})?$";this.control_to_render=null;this.is_cash=n;this.show_cancel=t;this.payment_method_data_id=r;this.payment_method_change=u;n?this.RenderCashControls(f):this.RenderCheckControls(f)}return _createClass(i,[{key:"Validate",value:function(){return this.is_cash?this.ValidateCash():this.ValidateCheck()}},{key:"ValidateCash",value:function(){var n=!0,t=this.ValidateCashAmount();return!t&&n&&(n=t),n}},{key:"ValidateCashAmount",value:function(){return n.ControlGroup.ValidateMoney(this.cash_amount_input_element,this.cash_amount_input_element_container)}},{key:"ValidateCheck",value:function(){var t=!0,n=this.ValidateCheckAmount();return!n&&t&&(t=n),n=this.ValidateCheckCount(),!n&&t&&(t=n),n=this.ValidateCheckNumber(),!n&&t&&(t=n),n=this.ValidateCheckFrom(),!n&&t&&(t=n),n=this.ValidatePayingFor(),!n&&t&&(t=n),t}},{key:"ValidateCheckAmount",value:function(){return n.ControlGroup.ValidateMoney(this.check_amount_input_element,this.check_amount_input_element_container)}},{key:"ValidateCheckCount",value:function(){return n.ControlGroup.ValidateCount(this.check_count_input_element,this.check_count_input_element_container)}},{key:"ValidateCheckNumber",value:function(){var i=this.check_number_input_element,t="";return i.value.length>0&&this.check_amount===0&&(t="This field should only be used if a check is entered."),i.value.length===0&&this.check_amount>0&&this.check_count===1&&(t="A check number is required when you enter a check amount and set the check count to 1 check."),i.value.length>50&&(t="The check number can be at most 50 characters long."),n.ControlGroup.UpdateInputError(this.check_number_input_element,this.check_number_input_element_container,t),t.length===0}},{key:"ValidatePayingFor",value:function(){var i=this.paying_for_input_element,t="";return i.value.length>0&&this.check_amount===0&&(t="This field should only be used if a check amount is entered."),i.value.length>500&&(t="This field can be at most 500 characters long."),n.ControlGroup.UpdateInputError(this.paying_for_input_element,this.paying_for_input_element_container,t),t.length===0}},{key:"ValidateCheckFrom",value:function(){var i=this.check_from_input_element,t="";return i.value.length>0&&this.check_amount===0&&(t="This field should only be used if a check amount is entered."),i.value.length===0&&this.check_amount>0&&this.check_count===1&&(t="This field is required if you enter a check amount and set the check count to 1 check."),i.value.length>500&&(t="This field can be at most 500 characters long."),n.ControlGroup.UpdateInputError(this.check_from_input_element,this.check_from_input_element_container,t),t.length===0}},{key:"RenderCashControls",value:function(t){var i=this,r=document.createElement("div");r.classList.add("columns");this.cash_amount_input_element=n.ControlGroup.CreateInput("number",15,!0,"0");t===null?this.cash_amount_input_element.oninput=function(){i.cash_amount=0;i.ValidateCashAmount()&&(i.cash_amount=i.cash_amount_input_element.valueAsNumber);i.payment_method_change()}:(this.cash_amount_input_element.value=t.cash_amount.toString(),this.cash_amount_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.cash_amount_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.cash_amount_input_element.setAttribute("is_cash","true"));this.cash_amount_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.cash_amount_input_element,"Cash Amount",!0,"is-one-quarter");r.appendChild(this.cash_amount_input_element_container);this.control_to_render=r}},{key:"RenderCheckControls",value:function(t){var i=this,r=document.createElement("div"),u;r.classList.add("columns","is-multiline","check");this.check_amount_input_element=n.ControlGroup.CreateInput("number",15,!1,"0");t===null?this.check_amount_input_element.oninput=function(){i.check_amount=0;i.ValidateCheckAmount()&&(i.check_amount=i.check_amount_input_element.valueAsNumber,i.check_amount>0?(Utilities.Show_Flex(i.check_buttons_container_element),i.check_count_input_element.required=!0):(Utilities.Hide(i.check_buttons_container_element),i.check_count_input_element.required=!1));i.payment_method_change()}:(this.check_amount_input_element.readOnly=!0,this.check_amount_input_element.value=t.check_amount.toString(),this.check_amount_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_amount_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_amount_input_element.setAttribute("is_cash","false"));this.check_count_input_element=n.ControlGroup.CreateInput("number",5,!1,"# of Checks");this.check_count_input_element.step="1";this.check_count_input_element.min="0";t===null?this.check_count_input_element.oninput=function(t){if(i.ValidateCheckCount())if(i.check_count=t.target.valueAsNumber,i.check_amount>0)switch(i.check_count){case 0:n.ControlGroup.UpdateInputGuide(i.check_count_input_element_container,"Partial Check");break;case 1:n.ControlGroup.UpdateInputGuide(i.check_count_input_element_container,"Single Check");break;default:n.ControlGroup.UpdateInputGuide(i.check_count_input_element_container,"Bulk Check")}else n.ControlGroup.UpdateInputGuide(i.check_count_input_element_container,"");else n.ControlGroup.UpdateInputGuide(i.check_count_input_element_container,"");i.payment_method_change()}:(this.check_count_input_element.readOnly=!0,this.check_count_input_element.value=t.check_count.toString(),this.check_count_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_count_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_count_input_element.setAttribute("is_cash","false"));this.check_number_input_element=n.ControlGroup.CreateInput("text",50,!1,"Check Number");t===null?this.check_number_input_element.oninput=function(n){i.ValidateCheckNumber()&&(i.check_number=n.target.value)}:(this.check_number_input_element.readOnly=!0,this.check_number_input_element.value=t.check_number,this.check_number_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_number_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_number_input_element.setAttribute("is_cash","false"));this.paying_for_input_element=n.ControlGroup.CreateInput("text",500,!1,"Check Paying For");t===null?this.paying_for_input_element.oninput=function(n){i.ValidatePayingFor()&&(i.paying_for=n.target.value)}:(this.paying_for_input_element.readOnly=!0,this.paying_for_input_element.value=t.paying_for,this.paying_for_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.paying_for_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.paying_for_input_element.setAttribute("is_cash","false"));this.check_from_input_element=n.ControlGroup.CreateInput("text",500,!1,"Check From");t===null?this.check_from_input_element.oninput=function(n){i.ValidateCheckFrom()&&(i.check_from=n.target.value)}:(this.check_from_input_element.readOnly=!0,this.check_from_input_element.value=t.check_from,this.check_from_input_element.setAttribute("payment_method_data_id",t.payment_method_data_id.toString()),this.check_from_input_element.setAttribute("transaction_id",t.transaction_id.toString()),this.check_from_input_element.setAttribute("is_cash","false"));this.add_check_button_element=document.createElement("button");this.add_check_button_element.classList.add("button","is-info",n.app_input_size);this.add_check_button_element.appendChild(document.createTextNode("Add Another Check"));this.check_amount_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_amount_input_element,"Check Amount",!0,"is-one-quarter");r.appendChild(this.check_amount_input_element_container);this.check_count_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_count_input_element,"# of Checks",!0,"is-2",!0);r.appendChild(this.check_count_input_element_container);this.check_number_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_number_input_element,"Check Number",!0,"is-one-quarter");r.appendChild(this.check_number_input_element_container);this.show_cancel?(u=[],this.cancel_check_button_element=document.createElement("button"),this.cancel_check_button_element.classList.add("button","is-warning",n.app_input_size),this.cancel_check_button_element.appendChild(document.createTextNode("Cancel Check")),u.push(this.add_check_button_element),u.push(this.cancel_check_button_element),this.check_buttons_container_element=n.ControlGroup.CreateButtonlistFieldContainer(u,"",!0,"is-one-quarter")):(this.check_buttons_container_element=n.ControlGroup.CreateInputFieldContainer(this.add_check_button_element,"",!0,"is-one-quarter"),t===null&&this.check_buttons_container_element.classList.add("hide"));r.appendChild(this.check_buttons_container_element);this.paying_for_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.paying_for_input_element,"Paying For",!0,"is-half");t===null&&(this.paying_for_input_element_container.style.display="none");r.appendChild(this.paying_for_input_element_container);this.check_from_input_element_container=n.ControlGroup.CreateInputFieldContainer(this.check_from_input_element,"Check From",!0,"is-half");r.appendChild(this.check_from_input_element_container);this.control_to_render=r}},{key:"SaveChanges",value:function(){var t=this,i=n.GetPath();Utilities.Post_Empty(i+"API/Transaction/EditPaymentMethod",this).then(function(i){i.text().then(function(r){r.length===0?(n.CloseChangeModal(),n.ShowReceiptDetail(t.transaction_id),n.editing_control_data=null,n.editing_payment_method_data=null,n.GetTransactionList(n.current_page,!1)):alert("There was a problem saving this change.\r\n"+i);Utilities.Toggle_Loading_Button("change_transaction_save",!1)})})}}],[{key:"GetHistory",value:function(t,i){var r=n.GetPath();return Utilities.Get(r+"API/Transaction/GetPaymentMethodHistory?payment_method_data_id="+t+"&transaction_id="+i)}},{key:"GetAndDisplayHistory",value:function(n,t,r){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function u(){return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,i.GetHistory(n,t).then(function(n){i.MarkDataToEdit(n,r);i.DisplayHistory(n,r);i.DisplayEdit()});case 2:case"end":return u.stop()}},u,this)}))}},{key:"MarkDataToEdit",value:function(i,r){var e,f,u;n.editing_control_data=null;n.editing_payment_method_data=null;e=i.filter(function(n){return n.is_active});e.length===1?(f=e[0],u=new t.PaymentMethodData(r,!1,f.payment_method_data_id,function(){}),u.payment_method_data_id=f.payment_method_data_id,u.transaction_id=f.transaction_id,u.transaction_payment_type_id=f.transaction_payment_type_id,u.prior_payment_method_data_id=f.prior_payment_method_data_id,u.is_active=!0,r?(u.cash_amount=f.cash_amount,u.cash_amount_input_element.valueAsNumber=f.cash_amount):(u.check_amount=f.check_amount,u.check_amount_input_element.valueAsNumber=f.check_amount,u.check_count=f.check_count,u.check_count_input_element.valueAsNumber=f.check_count,u.check_from=f.check_from,u.check_from_input_element.value=f.check_from,u.check_number=f.check_number,u.check_number_input_element.value=f.check_number,u.paying_for=f.paying_for,u.paying_for_input_element.value=f.paying_for),n.editing_payment_method_data=u):alert("Invalid data stored in database for this transaction.")}},{key:"DisplayEdit",value:function(){var t,i;n.editing_payment_method_data!==null&&(t=document.getElementById(n.change_edit_container),Utilities.Clear_Element(t),t.classList.remove("columns"),i=n.editing_payment_method_data,Utilities.Clear_Element(i.check_buttons_container_element),t.appendChild(i.control_to_render),Utilities.Set_Value(n.reason_for_change_input,""))}},{key:"CreateCashHistoryHeader",value:function(){var n=document.createElement("tr");return n.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","20%")),n.appendChild(Utilities.CreateTableCell("th","Cash Amount","has-text-right","15%")),n.appendChild(Utilities.CreateTableCell("th","","","35%")),n}},{key:"CreateCheckHistoryHeader",value:function(){var n=document.createElement("tr");return n.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","10%")),n.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","15%")),n.appendChild(Utilities.CreateTableCell("th","Check Amount","has-text-right","15%")),n.appendChild(Utilities.CreateTableCell("th","Check Count","has-text-centered","10%")),n.appendChild(Utilities.CreateTableCell("th","Check #","has-text-left","10%")),n.appendChild(Utilities.CreateTableCell("th","Check From","has-text-left","10%")),n.appendChild(Utilities.CreateTableCell("th","Paying For","has-text-left","15%")),n}},{key:"DisplayHistory",value:function(t,r){var e=document.getElementById(n.change_transaction_history_table_header),u,f,h,o;Utilities.Clear_Element(e);r?e.appendChild(i.CreateCashHistoryHeader()):e.appendChild(i.CreateCheckHistoryHeader());u=document.getElementById(n.change_transaction_history_table_body);Utilities.Clear_Element(u);var s=!0,c=!1,l=undefined;try{for(f=t[Symbol.iterator]();!(s=(h=f.next()).done);s=!0)o=h.value,r?u.appendChild(i.CreateCashHistoryRow(o)):u.appendChild(i.CreateCheckHistoryRow(o))}catch(a){c=!0;l=a}finally{try{!s&&f["return"]&&f["return"]()}finally{if(c)throw l;}}}},{key:"CreateCashHistoryRow",value:function(n){var t=document.createElement("tr"),i;return new Date(n.modified_on).getFullYear()<1e3?(i=Utilities.CreateTableCell("td","Original Value","has-text-centered"),i.colSpan=3,t.appendChild(i)):(t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(n.modified_on),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.modified_by,"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.reason_for_change,"has-text-left"))),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.cash_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td","","","35%")),t}},{key:"CreateCheckHistoryRow",value:function(n){var t=document.createElement("tr"),i;return new Date(n.modified_on).getFullYear()<1e3?(i=Utilities.CreateTableCell("td","Original Value","has-text-centered"),i.colSpan=3,t.appendChild(i)):(t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(n.modified_on),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.modified_by,"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.reason_for_change,"has-text-left"))),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.check_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",n.check_count.toString(),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.check_number,"has-text-left")),t.appendChild(Utilities.CreateTableCell("td",n.check_from,"has-text-left")),t.appendChild(Utilities.CreateTableCell("td",n.paying_for,"has-text-left")),t}}]),i}();t.PaymentMethodData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={})),function(n){var t=function(){function n(){_classCallCheck(this,n);this.control_groups=[]}return _createClass(n,[{key:"Constructor",value:function(){}}]),n}();n.PaymentType=t}(Transaction||(Transaction={})),function(n){var t=function(){function t(){_classCallCheck(this,t);this.rendered_input_element=null;this.valid_values=[];this.is_printed=!1}return _createClass(t,[{key:"Constructor",value:function(){}}],[{key:"CreateControl",value:function(n){var i=arguments.length<=1||arguments[1]===undefined?null:arguments[1];switch(n.data_type){case"date":case"text":return t.CreateInput(n,i);case"number":case"money":case"count":return t.CreateNumericInput(n,i);case"bigtext":return t.CreateTextArea(n,i);case"dropdown":return t.CreateSelect(n,i)}return null}},{key:"CreateSavedControl",value:function(n){var i=t.CreateControl(n.control,n.value);return i.tagName.toLowerCase()!=="select"?i.readOnly=!0:i.disabled=!0,i.setAttribute("control_data_id",n.control_data_id.toString()),i.setAttribute("transaction_id",n.transaction_id.toString()),i}},{key:"CreateInput",value:function(t,i){var r=document.createElement("input"),u,f;return r.type=t.data_type,r.maxLength=t.max_length,r.classList.add("input",n.app_input_size),r.placeholder=t.label,r.required=t.required,r.type==="date"&&i!==null?(u=i.split("/"),u.length===3?(f=u[2]+"-",f+=u[0].length===1?"0"+u[0]:u[0],f+="-",f+=u[1].length===1?"0"+u[1]:u[1],r.value=f):r.value=i):r.value=i===null?"":i,r.setAttribute("control_id",t.control_id.toString()),r}},{key:"CreateNumericInput",value:function(t,i){var r=document.createElement("input");return r.type="number",r.maxLength=t.max_length,r.classList.add("input",n.app_input_size),r.placeholder="0",r.required=t.required,t.data_type==="count"?(r.step="1",r.min="0",r.pattern="[0-9]"):r.step="any",r.value=i===null?"":i,r.setAttribute("control_id",t.control_id.toString()),r}},{key:"CreateTextArea",value:function(t,i){var r=document.createElement("textarea");return r.maxLength=t.max_length,r.classList.add("textarea",n.app_input_size),r.placeholder=t.label,r.required=t.required,r.rows=4,r.value=i===null?"":i,r.setAttribute("control_id",t.control_id.toString()),r}},{key:"CreateSelect",value:function(n,t){var i,r,e,u,o;n.valid_values=n.value.split("|");i=document.createElement("select");i.required=n.required;i.appendChild(Utilities.Create_Option("-1","Select a "+n.label,!1));var f=!0,s=!1,h=undefined;try{for(r=n.valid_values[Symbol.iterator]();!(f=(e=r.next()).done);f=!0)u=e.value,o=Utilities.Create_Option(u,u,!1),i.appendChild(o)}catch(c){s=!0;h=c}finally{try{!f&&r["return"]&&r["return"]()}finally{if(s)throw h;}}return i.value=t!==null?t:"-1",i}}]),t}();n.Control=t}(Transaction||(Transaction={})),function(n){var t=function(){function t(){_classCallCheck(this,t);this.organization="";this.payment_types=[];this.controls=[];this.control_groups=[]}return _createClass(t,[{key:"Constructor",value:function(){}}],[{key:"GetDepartments",value:function(){var t=n.GetPath();return Utilities.Get(t+"API/Transaction/Departments")}},{key:"CreateDepartmentElement",value:function(n){var t=document.createElement("select"),i=document.createElement("option"),r,o,u,f;i.selected=!0;i.value="-1";i.appendChild(document.createTextNode("Select a Department"));t.appendChild(i);var e=!0,s=!1,h=undefined;try{for(r=n[Symbol.iterator]();!(e=(o=r.next()).done);e=!0)u=o.value,u.is_active&&(f=document.createElement("option"),f.appendChild(document.createTextNode(u.name)),f.value=u.department_id.toString(),t.appendChild(f))}catch(c){s=!0;h=c}finally{try{!e&&r["return"]&&r["return"]()}finally{if(s)throw h;}}return t.selectedIndex=-1,t}},{key:"CreateDepartmentElementLevel",value:function(n){var e=document.createElement("div"),t,i,r,u,f;return e.classList.add("level"),t=document.createElement("div"),t.classList.add("level-left"),i=document.createElement("div"),i.classList.add("level-item","has-text-centered"),r=document.createElement("div"),u=document.createElement("p"),u.classList.add("heading"),u.appendChild(document.createTextNode("Select Department")),f=document.createElement("div"),f.classList.add("select"),f.appendChild(n),r.appendChild(u),r.appendChild(f),i.appendChild(r),t.appendChild(i),e.appendChild(t),e}},{key:"CreateDepartmentElementField",value:function(t){return n.ControlGroup.CreateSelectFieldContainer(t,"Department",!0,"is-one-half")}},{key:"FindDepartment",value:function(t){var i=n.departments.filter(function(n){return n.department_id===t});return i.length===1?i[0]:null}}]),t}();n.Department=t}(Transaction||(Transaction={}));__awaiter=undefined&&undefined.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},function(n){var t;(function(t){var i=function(){function i(t,r,u){var f=this,o,e;_classCallCheck(this,i);this.control_data_id=-1;this.prior_control_data_id=-1;this.transaction_payment_type_id=-1;this.department_id=-1;this.transaction_id=-1;this.control_id=-1;this.control=null;this.payment_type_id=-1;this.payment_type_index=-1;this.value="";this.is_active=!0;this.modified_on=new Date;this.modified_by="";this.reason_for_change="";this.error_text="";this.selected_control=null;this.input_element=null;this.container_element=null;o=t.rendered_input_element?t.rendered_input_element.getAttribute("control_data_id"):null;this.selected_control=t;this.control_id=t.control_id;this.input_element=u?t.rendered_input_element.cloneNode(!0):t.rendered_input_element?t.rendered_input_element:n.Control.CreateControl(t);this.payment_type_id=r;o===null&&(e=this.input_element,e.type==="number"&&(e.onwheel=function(n){n.preventDefault()}),this.input_element.oninput=function(n){var i=n.target,r;if(f.Validate())switch(t.data_type){case"date":r=i.valueAsDate;r.setMinutes(r.getTimezoneOffset());f.value=Utilities.Format_Date(r);break;case"number":f.value=i.valueAsNumber.toString();break;case"count":f.value=i.valueAsNumber.toString();i.value=i.valueAsNumber.toString();break;case"money":f.value=i.valueAsNumber.toString();break;default:f.value=i.value}});this.container_element=t.data_type==="dropdown"?n.ControlGroup.CreateSelectFieldContainerByControl(t,this.input_element,!0):n.ControlGroup.CreateInputFieldContainerByControl(t,this.input_element,!0)}return _createClass(i,[{key:"Validate",value:function(){switch(this.selected_control.data_type){case"dropdown":return this.ValidateDropdown();case"count":return this.ValidateCount();case"date":return this.ValidateDate();case"number":return this.ValidateNumber();case"money":return this.ValidateMoney();case"text":case"bigtext":return this.ValidateText();default:return!1}}},{key:"ValidateDropdown",value:function(){return n.ControlGroup.ValidateDropdown(this.input_element,this.container_element,this.selected_control.valid_values)}},{key:"ValidateDate",value:function(){return n.ControlGroup.ValidateDate(this.input_element,this.container_element)}},{key:"ValidateText",value:function(){return n.ControlGroup.ValidateText(this.input_element,this.container_element)}},{key:"ValidateNumber",value:function(){return n.ControlGroup.ValidateNumber(this.input_element,this.container_element)}},{key:"ValidateCount",value:function(){return n.ControlGroup.ValidateCount(this.input_element,this.container_element)}},{key:"ValidateMoney",value:function(){return n.ControlGroup.ValidateMoney(this.input_element,this.container_element)}},{key:"SaveControlChanges",value:function(){var t=this,i=n.GetPath();console.log("saving this control data",this);Utilities.Post(i+"API/Transaction/EditControls",this).then(function(i){i.length>0?alert("There was a problem saving this change.\r\n"+i):(n.CloseChangeModal(),n.ShowReceiptDetail(t.transaction_id),n.editing_control_data=null);Utilities.Toggle_Loading_Button("change_transaction_save",!1)})}},{key:"SetErrorText",value:function(t){this.selected_control.data_type==="dropdown"?n.ControlGroup.UpdateSelectError(this.container_element,t):n.ControlGroup.UpdateInputError(this.input_element,this.container_element,t)}}],[{key:"GetControlHistory",value:function(t,i){var r=n.GetPath();return Utilities.Get(r+"API/Transaction/GetControlDataHistory?control_data_id="+t+"&transaction_id="+i)}},{key:"GetAndDisplayControlHistory",value:function(n,t){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.GetControlHistory(n,t).then(function(n){i.MarkDataToEdit(n);i.DisplayControlHistory(n);i.DisplayControlToEdit()});case 2:case"end":return r.stop()}},r,this)}))}},{key:"MarkDataToEdit",value:function(i){var o,r,u,f,e;if(n.editing_control_data=null,n.editing_payment_method_data=null,o=i.filter(function(n){return n.is_active}),o.length===1){r=o[0];u=new t.ControlData(r.control,r.payment_type_id,!1);u.transaction_payment_type_id=r.transaction_payment_type_id;u.department_id=r.department_id;u.is_active=r.is_active;u.control_data_id=r.control_data_id;u.transaction_id=r.transaction_id;u.value=r.value;switch(r.control.data_type){case"date":r.value!==""&&r.value!==null&&(f=r.value.split("/"),f.length===3&&(e=f[2]+"-",e+=f[0].length===1?"0"+f[0]:f[0],e+="-",e+=f[1].length===1?"0"+f[1]:f[1],u.input_element.value=e));break;default:u.input_element.value=r.value}u.control=u.selected_control;n.editing_control_data=u}else alert("Invalid data stored in database for this transaction.")}},{key:"DisplayControlToEdit",value:function(){var t,i;n.editing_control_data!==null&&(t=document.getElementById(n.change_edit_container),Utilities.Clear_Element(t),t.classList.add("columns"),i=n.editing_control_data,t.appendChild(i.container_element),Utilities.Set_Value(n.reason_for_change_input,""))}},{key:"CreateControlDataHistoryHeader",value:function(){var n=document.createElement("tr");return n.appendChild(Utilities.CreateTableCell("th","Modified On","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Modified By","has-text-centered","15%")),n.appendChild(Utilities.CreateTableCell("th","Reason For Change","has-text-left","20%")),n.appendChild(Utilities.CreateTableCell("th","Value","has-text-left","50%")),n}},{key:"DisplayControlHistory",value:function(t){var e=document.getElementById(n.change_transaction_history_table_header),u,r,o,s;Utilities.Clear_Element(e);e.appendChild(i.CreateControlDataHistoryHeader());u=document.getElementById(n.change_transaction_history_table_body);Utilities.Clear_Element(u);var f=!0,h=!1,c=undefined;try{for(r=t[Symbol.iterator]();!(f=(o=r.next()).done);f=!0)s=o.value,u.appendChild(i.CreateControlDataHistoryRow(s))}catch(l){h=!0;c=l}finally{try{!f&&r["return"]&&r["return"]()}finally{if(h)throw c;}}}},{key:"CreateControlDataHistoryRow",value:function(n){var t=document.createElement("tr"),i;return new Date(n.modified_on).getFullYear()<1e3?(i=Utilities.CreateTableCell("td","Original Value","has-text-centered"),i.colSpan=3,t.appendChild(i)):(t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(n.modified_on),"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.modified_by,"has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.reason_for_change,"has-text-left"))),t.appendChild(Utilities.CreateTableCell("td",n.value,"has-text-left")),t}}]),i}();t.ControlData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={})),function(n){var t;(function(t){var i=function(){function i(n,t,r){var u=arguments.length<=3||arguments[3]===undefined?null:arguments[3],f;_classCallCheck(this,i);this.transaction_payment_type_id=-1;this.transaction_id=-1;this.payment_type_id=-1;this.payment_type_index=-1;this.payment_type=null;this.control_data=[];this.added_after_save=!1;this.error_text="";this.payment_method_data=[];this.payment_type_parent_container=null;this.payment_type_container=null;this.selected_payment_type=null;this.cancel_payment_type_button=null;this.add_another_payment_type_button=null;this.save_button=null;this.control_groups=[];this.total_cash_element=null;this.total_checks_element=null;this.total_number_checks_element=null;this.next_payment_method_id=0;this.selected_payment_type=n;this.payment_type_parent_container=t;this.payment_type_id=n.payment_type_id;this.payment_type_index=u!==null?u.payment_type_index:r;f=document.createElement("li");f.style.display="block";this.payment_type_container=f;u!==null?(this.transaction_payment_type_id=u.transaction_payment_type_id,this.transaction_id=u.transaction_id,this.RenderSavedPaymentTypeControls(f,u),this.RenderSavedPaymentMethods(f,u)):(this.RenderPaymentTypeControls(f),this.RenderPaymentMethods(f));this.RenderPaymentTypeFooter(f);u!==null&&this.SavedPaymentMethodDataCalculateTotals(u.payment_method_data);this.payment_type_parent_container.appendChild(f)}return _createClass(i,[{key:"Validate",value:function(){var n=!0,u=!0,e=!1,o=undefined,t,s,h,i,c,l,r;try{for(t=this.control_data[Symbol.iterator]();!(u=(s=t.next()).done);u=!0)h=s.value,r=h.Validate(),!r&&n&&(n=!1)}catch(a){e=!0;o=a}finally{try{!u&&t["return"]&&t["return"]()}finally{if(e)throw o;}}var f=!0,v=!1,y=undefined;try{for(i=this.payment_method_data[Symbol.iterator]();!(f=(c=i.next()).done);f=!0)l=c.value,r=l.Validate(),!r&&n&&(n=!1)}catch(a){v=!0;y=a}finally{try{!f&&i["return"]&&i["return"]()}finally{if(v)throw y;}}return n}},{key:"RenderPaymentTypeControls",value:function(n){var i=!0,r=!1,u=undefined,t,f,e,o;try{for(t=this.selected_payment_type.control_groups[Symbol.iterator]();!(i=(f=t.next()).done);i=!0)o=f.value,(e=this.control_data).push.apply(e,_toConsumableArray(o.CreateControlData(n)))}catch(s){r=!0;u=s}finally{try{!i&&t["return"]&&t["return"]()}finally{if(r)throw u;}}}},{key:"CreateHeaderButton",value:function(n){var u,i=document.createElement("button");i.appendChild(document.createTextNode(n));for(var r=arguments.length,f=Array(r>1?r-1:0),t=1;t<r;t++)f[t-1]=arguments[t];return(u=i.classList).add.apply(u,["button"].concat(f)),i}},{key:"RenderPaymentTypeFooter",value:function(n){var i=[],t,r,u;this.total_cash_element=document.createElement("span");this.total_cash_element.classList.add("title");this.total_cash_element.appendChild(document.createTextNode("$0.00"));this.total_checks_element=document.createElement("span");this.total_checks_element.classList.add("title");this.total_checks_element.appendChild(document.createTextNode("$0.00"));this.total_number_checks_element=document.createElement("span");this.total_number_checks_element.classList.add("title");this.total_number_checks_element.appendChild(document.createTextNode("0"));i.push(new Utilities.LevelItem("Total Cash","",this.total_cash_element,"has-text-centered"));i.push(new Utilities.LevelItem("Total Checks","",this.total_checks_element,"has-text-centered"));i.push(new Utilities.LevelItem("# Checks","",this.total_number_checks_element,"has-text-centered"));this.add_another_payment_type_button=this.CreateHeaderButton("Add","is-info");this.cancel_payment_type_button=this.CreateHeaderButton("Cancel","is-warning");this.save_button=this.CreateHeaderButton("Preview & Save","is-success");t=document.createElement("div");t.classList.add("buttons");t.appendChild(this.add_another_payment_type_button);t.appendChild(this.cancel_payment_type_button);t.appendChild(this.save_button);r=[];r.push(new Utilities.LevelItem("","",t,"has-text-centered"));u=Utilities.Create_Centered_Level(i,[],r);u.classList.add("has-background-grey-lighter");n.appendChild(u)}},{key:"RenderPaymentMethods",value:function(n){var t=document.createElement("fieldset"),i=document.createElement("legend");i.classList.add("label");i.appendChild(document.createTextNode("Payment Methods"));t.appendChild(i);this.AddCashPaymentMethod(t);this.AddCheckPaymentMethod(t);n.appendChild(t)}},{key:"AddCheckPaymentMethod",value:function(n){var r=this,u=arguments.length<=1||arguments[1]===undefined?!1:arguments[1],f=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],i=new t.PaymentMethodData(!1,u,this.next_payment_method_id++,function(){r.PaymentMethodDataChanged()});n.appendChild(i.control_to_render);this.payment_method_data.push(i);f?(Utilities.Set_Text(i.add_check_button_element,"Save this Check"),i.add_check_button_element.classList.remove("is-info"),i.add_check_button_element.classList.add("is-success"),i.add_check_button_element.onclick=function(){r.SavePaymentMethodData(i,i.add_check_button_element)}):i.add_check_button_element.onclick=function(){r.AddCheckPaymentMethod(n,!0,f)};u&&(i.cancel_check_button_element.onclick=function(){n.removeChild(i.control_to_render);var t=r.payment_method_data.findIndex(function(n){return n.payment_method_data_id===i.payment_method_data_id});t>-1&&r.payment_method_data.splice(t,1);i=null;r.PaymentMethodDataChanged()})}},{key:"AddCashPaymentMethod",value:function(n){var r=this,i=new t.PaymentMethodData(!0,!1,this.next_payment_method_id++,function(){r.PaymentMethodDataChanged()});n.appendChild(i.control_to_render);this.payment_method_data.push(i)}},{key:"PaymentMethodDataChanged",value:function(){var r=0,u=0,f=0,i=!0,e=!1,o=undefined,n,s,t;try{for(n=this.payment_method_data[Symbol.iterator]();!(i=(s=n.next()).done);i=!0)t=s.value,r+=t.cash_amount,u+=t.check_amount,f+=t.check_count}catch(h){e=!0;o=h}finally{try{!i&&n["return"]&&n["return"]()}finally{if(e)throw o;}}this.total_cash_element.innerHTML=Utilities.Format_Amount(r);this.total_checks_element.innerHTML=Utilities.Format_Amount(u);this.total_number_checks_element.innerHTML=f.toString()}},{key:"SavedPaymentMethodDataCalculateTotals",value:function(n){var u=0,f=0,e=0,r=!0,o=!1,s=undefined,t,h,i;try{for(t=n[Symbol.iterator]();!(r=(h=t.next()).done);r=!0)i=h.value,u+=i.cash_amount,f+=i.check_amount,e+=i.check_count}catch(c){o=!0;s=c}finally{try{!r&&t["return"]&&t["return"]()}finally{if(o)throw s;}}this.total_cash_element.innerHTML=Utilities.Format_Amount(u);this.total_checks_element.innerHTML=Utilities.Format_Amount(f);this.total_number_checks_element.innerHTML=e.toString()}},{key:"RenderSavedPaymentTypeControls",value:function(t,i){var r,f,e,o;this.control_groups=n.ControlGroup.CreateSavedControlGroups(i.control_data);var u=!0,s=!1,h=undefined;try{for(r=this.control_groups[Symbol.iterator]();!(u=(f=r.next()).done);u=!0)o=f.value,(e=this.control_data).push.apply(e,_toConsumableArray(o.CreateControlData(t,!1)))}catch(c){s=!0;h=c}finally{try{!u&&r["return"]&&r["return"]()}finally{if(s)throw h;}}}},{key:"RenderSavedPaymentMethods",value:function(n,t){var r=document.createElement("fieldset"),f=document.createElement("legend"),i,u,c,l;f.classList.add("label");f.appendChild(document.createTextNode("Payment Methods"));r.appendChild(f);var e=null,o=[],s=[].concat(_toConsumableArray(t.payment_method_data));s.sort(function(n,t){return t.cash_amount-n.cash_amount});do i=s.shift(),i.check_amount>0||i.check_number.length>0||i.check_count>0||i.check_from.length>0||i.paying_for.length>0?o.push(i):i.cash_amount>0||e===null?e=i:o.push(i);while(s.length>0);this.AddSavedCashPaymentMethod(r,e);var h=!0,a=!1,v=undefined;try{for(u=o[Symbol.iterator]();!(h=(c=u.next()).done);h=!0)l=c.value,this.AddSavedCheckPaymentMethod(r,l)}catch(y){a=!0;v=y}finally{try{!h&&u["return"]&&u["return"]()}finally{if(a)throw v;}}n.appendChild(r)}},{key:"AddSavedCheckPaymentMethod",value:function(n,i){var u=this,r=new t.PaymentMethodData(!1,!1,this.next_payment_method_id++,null,i);n.appendChild(r.control_to_render);this.payment_method_data.push(r);r.add_check_button_element.onclick=function(){u.AddCheckPaymentMethod(n,!0,!0)}}},{key:"AddSavedCashPaymentMethod",value:function(n,i){var r=new t.PaymentMethodData(!0,!1,this.next_payment_method_id++,null,i);n.appendChild(r.control_to_render);this.payment_method_data.push(r)}},{key:"SavePaymentMethodData",value:function(t,i){var u=this,r;(Utilities.Toggle_Loading_Button(i,!0),t.Validate())&&(t.transaction_id=this.transaction_id,t.payment_method_data_id=-1,t.transaction_payment_type_id=this.transaction_payment_type_id,r=n.GetPath(),Utilities.Post_Empty(r+"API/Transaction/AddPaymentMethod",t).then(function(t){t.text().then(function(t){if(console.log("response text",t,t.length),Utilities.Toggle_Loading_Button(i,!1),t.length>0){alert("there was an error attempting to add this check, please refresh this web page and try again.");return}n.ShowReceiptDetail(u.transaction_id)})}))}},{key:"FindPaymentTypeControl",value:function(n){return this.control_data.find(function(t){return t.control_id===n})}}]),i}();t.PaymentTypeData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={})),function(n){var t=function(){function t(){var i=this,r=arguments.length<=0||arguments[0]===undefined?null:arguments[0];_classCallCheck(this,t);this.currentTransaction=null;this.savedTransaction=null;this.view_container=null;this.receipt_number_element=null;this.county_manager_element=null;this.created_by_element=null;this.created_on_element=null;this.receipt_view_contents_element=null;this.receipt_view_totals_element=null;this.receipt_preview_controls_element=null;this.receipt_preview_cancel_button_element=null;this.receipt_preview_save_button_element=null;this.view_container=document.getElementById(t.receipt_container);this.receipt_number_element=document.getElementById("receipt_view_number");this.created_by_element=document.getElementById("receipt_created_by");this.county_manager_element=document.getElementById("receipt_view_county_manager");this.created_on_element=document.getElementById("receipt_view_date");this.receipt_view_contents_element=document.getElementById("receipt_view_contents");this.receipt_view_totals_element=document.getElementById("receipt_view_totals");this.currentTransaction=new n.Data.TransactionData("R",r);this.receipt_preview_controls_element=document.getElementById("receipt_preview_controls");this.receipt_preview_cancel_button_element=document.getElementById("receipt_view_cancel");this.receipt_preview_save_button_element=document.getElementById("receipt_view_save");this.receipt_preview_cancel_button_element.onclick=function(){n.ViewReceiptDetail()};this.receipt_preview_save_button_element.onclick=function(){i.currentTransaction.SaveTransactionData()}}return _createClass(t,[{key:"ShowReceiptPreview",value:function(){var n=this.currentTransaction;this.UpdateReceipt(n);Utilities.Show(this.receipt_preview_controls_element)}},{key:"ShowReceipt",value:function(n){this.UpdateReceipt(n);Utilities.Hide(this.receipt_preview_controls_element)}},{key:"UpdateReceipt",value:function(t){n.ViewPrintableReceipt();Utilities.Set_Text(this.created_on_element,Utilities.Format_Date(t.created_on));Utilities.Set_Text(this.receipt_number_element,t.transaction_number);Utilities.Set_Text(this.created_by_element,t.created_by_display_name);Utilities.Set_Text(this.county_manager_element,t.county_manager_name);this.DisplayDepartmentControls(t);t.transaction_type=="R"?this.CreatePaymentTypeDisplay(t):(this.CreateTransactionViewDisplay(t),t.transaction_type==="C")}},{key:"CreateTransactionViewDisplay",value:function(n){var i,u,t;Utilities.Clear_Element(this.receipt_view_contents_element);Utilities.Clear_Element(this.receipt_view_totals_element);var r=!0,f=!1,e=undefined;try{for(i=n.deposit_receipts[Symbol.iterator]();!(r=(u=i.next()).done);r=!0)t=u.value,this.receipt_view_contents_element.appendChild(this.CreateReceiptDetailRow(t.transaction_type+" "+t.transaction_number,t.total_cash_amount,t.total_check_amount,t.total_check_count))}catch(o){f=!0;e=o}finally{try{!r&&i["return"]&&i["return"]()}finally{if(f)throw e;}}this.receipt_view_totals_element.appendChild(this.CreateReceiptDetailRow("Grand Total",n.total_cash_amount,n.total_check_amount,n.total_check_count))}},{key:"CreatePaymentTypeDisplay",value:function(n){var e,tt,o,s,it,i,u,h,rt,ut,v,ft,et,ot,c,st,t,ht;Utilities.Clear_Element(this.receipt_view_contents_element);Utilities.Clear_Element(this.receipt_view_totals_element);var ct=0,lt=0,at=0,y=!0,vt=!1,yt=undefined;try{for(e=n.payment_type_data[Symbol.iterator]();!(y=(tt=e.next()).done);y=!0){var f=tt.value,l=!1,p=0,w=0,b=0,r=f.control_data,k=this.get_address_controls(r,!0);k.length>0&&(r=this.get_address_controls(r,!1));o=this.get_date_range_controls(r,!0);o.length>0&&(r=this.get_date_range_controls(r,!1));var d=!0,pt=!1,wt=undefined;try{for(s=r[Symbol.iterator]();!(d=(it=s.next()).done);d=!0)if(i=it.value,u=i.control?i.control:i.selected_control,u.data_type==="bigtext"){var bt=document.createElement("div"),ti=i.value.split("\n"),g=!0,kt=!1,dt=undefined;try{for(h=ti[Symbol.iterator]();!(g=(rt=h.next()).done);g=!0)ut=rt.value,v=document.createElement("p"),v.appendChild(document.createTextNode(ut)),bt.appendChild(v)}catch(a){kt=!0;dt=a}finally{try{!g&&h["return"]&&h["return"]()}finally{if(kt)throw dt;}}this.receipt_view_contents_element.appendChild(this.CreateControlDataRow(u.label,bt))}else u.data_type==="money"?(ft=Utilities.Format_Amount(parseFloat(i.value)),this.receipt_view_contents_element.appendChild(this.CreateControlDataRow(u.label,ft))):this.receipt_view_contents_element.appendChild(this.CreateControlDataRow(u.label,i.value))}catch(a){pt=!0;wt=a}finally{try{!d&&s["return"]&&s["return"]()}finally{if(pt)throw wt;}}k.length>0&&(et=this.get_address(k),this.receipt_view_contents_element.appendChild(this.CreateControlDataRow("Address",et)));o.length>0&&(ot=this.get_date_range(o),this.receipt_view_contents_element.appendChild(this.CreateControlDataRow("Date Range",ot)));var nt=!0,gt=!1,ni=undefined;try{for(c=f.payment_method_data[Symbol.iterator]();!(nt=(st=c.next()).done);nt=!0)t=st.value,t.cash_amount>0?(l||(this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeHeaderRow()),l=!0),this.receipt_view_contents_element.appendChild(this.CreateCashDataRow(t))):(t.check_amount>0||t.check_number.length>0||t.check_from.length>0)&&(l||(this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeHeaderRow()),l=!0),this.receipt_view_contents_element.appendChild(this.CreateCheckDataRow(t))),w+=t.cash_amount,p+=t.check_amount,b+=t.check_count}catch(a){gt=!0;ni=a}finally{try{!nt&&c["return"]&&c["return"]()}finally{if(gt)throw ni;}}ht=f.selected_payment_type!==undefined?f.selected_payment_type.name:f.payment_type.name;this.receipt_view_contents_element.appendChild(this.CreatePaymentTypeRow(ht+" Total",w,p,b));ct+=p;lt+=w;at+=b}}catch(a){vt=!0;yt=a}finally{try{!y&&e["return"]&&e["return"]()}finally{if(vt)throw yt;}}this.receipt_view_totals_element.appendChild(this.CreatePaymentTypeRow("Grand Total",lt,ct,at))}},{key:"CreatePaymentTypeRow",value:function(n,t,i,r){return this.CreateReceiptDetailRow(n,t,i,r)}},{key:"CreateControlDataRow",value:function(n,t){var i=document.createElement("tr"),r;return i.classList.add("pagebreak"),i.appendChild(Utilities.CreateTableCell("td",n,"has-text-right")),typeof t=="string"?i.appendChild(Utilities.CreateTableCell("td",t,"has-text-left","",2)):(r=Utilities.CreateTableCell("td",t,"has-text-left","",2),r.appendChild(t),i.appendChild(r)),i.appendChild(Utilities.CreateTableCell("td","","","",4)),i}},{key:"CreatePaymentTypeHeaderRow",value:function(){var n=document.createElement("tr");return n.classList.add("pagebreak"),n.appendChild(Utilities.CreateTableCell("th","Check Number","has-text-right")),n.appendChild(Utilities.CreateTableCell("th","Check From","has-text-right")),n.appendChild(Utilities.CreateTableCell("th","Type","has-text-centered")),n.appendChild(Utilities.CreateTableCell("td","","","",4)),n}},{key:"CreateCheckDataRow",value:function(n){var t=document.createElement("tr");return t.classList.add("pagebreak"),t.appendChild(Utilities.CreateTableCell("td",n.check_number,"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",n.check_from,"has-text-right")),t.appendChild(Utilities.CreateTableCell("td","Check","has-text-centered")),t.appendChild(Utilities.CreateTableCell("td",n.check_count.toString(),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.check_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td","","")),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.check_amount),"has-text-right")),t}},{key:"CreateCashDataRow",value:function(n){var t=document.createElement("tr");return t.classList.add("pagebreak"),t.appendChild(Utilities.CreateTableCell("td","","","",2)),t.appendChild(Utilities.CreateTableCell("td","Cash","has-text-centered")),t.appendChild(Utilities.CreateTableCell("td","","","",2)),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.cash_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.cash_amount),"has-text-right")),t}},{key:"CreateReceiptDetailRow",value:function(n,t,i,r){var u=document.createElement("tr");return u.appendChild(Utilities.CreateTableCell("th",n,"has-text-left","",3)),u.appendChild(Utilities.CreateTableCell("th",r.toString(),"has-text-right")),u.appendChild(Utilities.CreateTableCell("th",Utilities.Format_Amount(i),"has-text-right")),u.appendChild(Utilities.CreateTableCell("th",Utilities.Format_Amount(t),"has-text-right")),u.appendChild(Utilities.CreateTableCell("th",Utilities.Format_Amount(t+i),"has-text-right")),u.classList.add("payment_type_end"),u}},{key:"DisplayDepartmentControls",value:function(n){var u=document.getElementById("receipt_department_controls"),t,i,f,e;Utilities.Clear_Element(u);t=document.createDocumentFragment();t.appendChild(this.CreatePrintableControl("is-half","Received From",n.received_from));t.appendChild(this.CreatePrintableControl("is-half","Department",n.department_name));var r=!0,o=!1,s=undefined;try{for(i=n.department_control_data[Symbol.iterator]();!(r=(f=i.next()).done);r=!0)e=f.value,t.appendChild(this.CreateDepartmentControl(e))}catch(h){o=!0;s=h}finally{try{!r&&i["return"]&&i["return"]()}finally{if(o)throw s;}}u.appendChild(t)}},{key:"CreateDepartmentControl",value:function(n){var i="",t;return console.log("create departmental control",n),t=n.control!==null?n.control:n.selected_control,t.render_hints.length>0&&(i=t.render_hints),this.CreatePrintableControl(i,t.label,n.value)}},{key:"CreatePrintableControl",value:function(t,i,r){var f=document.createElement("div"),e,o,u;return f.classList.add("field","column",t),e=document.createElement("label"),e.classList.add("label",n.app_input_size),e.appendChild(document.createTextNode(i)),f.appendChild(e),o=document.createElement("p"),o.classList.add("control"),f.appendChild(o),u=document.createElement("input"),u.classList.add("input","is-static",n.app_input_size),u.value=r,u.readOnly=!0,o.appendChild(u),f}},{key:"get_address_controls",value:function(n,t){return this.get_control_groups([5,6,7,8,9],n,t)}},{key:"get_address",value:function(n){var i=document.createElement("div"),o="",s="",r="",u="",h="",f="",c=!0,y=!1,p=undefined,e,w,t,l,a,v;try{for(e=n[Symbol.iterator]();!(c=(w=e.next()).done);c=!0){t=w.value;switch(t.control_id){case 5:o=t.value.trim();break;case 6:s=t.value.trim();break;case 7:r=t.value.trim();break;case 8:u=t.value.trim();break;case 9:h=t.value.trim()}}}catch(b){y=!0;p=b}finally{try{!c&&e["return"]&&e["return"]()}finally{if(y)throw p;}}return o.length>0&&(l=document.createElement("p"),l.appendChild(document.createTextNode(o)),i.appendChild(l)),s.length>0&&(a=document.createElement("p"),a.appendChild(document.createTextNode(s)),i.appendChild(a)),(r.length>0||u.length>0||h.length>0)&&(r.length>0&&(f=r+", "),u.length>0&&(f+=u+" "),f+=h,v=document.createElement("p"),v.appendChild(document.createTextNode(f)),i.appendChild(v)),i}},{key:"get_date_range",value:function(n){var u="",f="",e=document.createElement("e"),r=!0,o=!1,s=undefined,t,h,i;try{for(t=n[Symbol.iterator]();!(r=(h=t.next()).done);r=!0){i=h.value;switch(i.control_id){case 10:case 71:u=i.value;break;case 11:case 72:f=i.value}}}catch(c){o=!0;s=c}finally{try{!r&&t["return"]&&t["return"]()}finally{if(o)throw s;}}return e.appendChild(document.createTextNode(u+" through "+f)),e}},{key:"get_date_range_controls",value:function(n,t){return this.get_control_groups([10,11,71,72],n,t)}},{key:"get_control_groups",value:function(n,t,i){return i?t.filter(function(t){return n.includes(t.control_id)}):t.filter(function(t){return!n.includes(t.control_id)})}}]),t}();t.receipt_container="receipt_view";n.Receipt=t}(Transaction||(Transaction={})),function(n){var t;(function(t){var i=function(){function i(n,t){_classCallCheck(this,i);this.transaction_id=-1;this.fiscal_year=-1;this.created_by_employee_id=-1;this.employee_transaction_count=-1;this.transaction_number="PREVIEW";this.transaction_type="";this.child_transaction_id=-1;this.department_id=-1;this.department_name="";this.department_control_data=[];this.payment_type_data=[];this.county_manager_name="PREVIEW";this.comment="";this.error_text="";this.received_from="";this.total_cash_amount=-1;this.total_check_amount=-1;this.total_check_count=-1;this.created_on=new Date;this.created_by_username="";this.created_by_ip_address="";this.created_by_display_name="PREVIEW";this.deposit_receipts=[];this.can_modify=!1;this.can_accept_deposit=!1;this.child_transaction=null;this.department_element=null;this.department_element_container=null;this.received_from_element=null;this.received_from_element_container=null;this.department_controls_target="department_controls_container";this.payment_type_target="payment_type_container";this.transaction_error_element=null;this.selected_department=null;this.next_payment_type_index=0;this.transaction_type=n;t!==null&&(this.transaction_id=t.transaction_id,this.transaction_number=t.transaction_number,this.transaction_type=t.transaction_type);var r=document.getElementById(i.action_container);Utilities.Clear_Element(r);this.CreateReceiptTitle(r,t);switch(this.transaction_type){case"R":console.log("receipt view");this.RenderReceiptView(r,t);break;case"D":case"C":console.log("deposit view");this.RenderDepositView(r,t)}this.transaction_error_element=this.CreateTransactionErrorElement();r.appendChild(this.transaction_error_element)}return _createClass(i,[{key:"RenderDepositView",value:function(n,t){var r=document.createElement("div"),u;n.appendChild(r);u=i.CreateTransactionsTableFooter(t);i.RenderTransactionList(t.deposit_receipts,r,u);t.can_accept_deposit&&(console.log("can accept deposit"),n.appendChild(i.CreateAcceptDepositMenu(t)))}},{key:"RenderReceiptView",value:function(t,i){var r=document.createElement("div");r.id="transaction_controls";r.classList.add("columns");t.appendChild(r);this.department_element=n.DepartmentControl.cloneNode(!0);this.RenderDepartmentSelection(r,i);this.RenderReceivedFromInput(r,i)}},{key:"CreateTransactionErrorElement",value:function(){return document.createElement("div")}},{key:"CreateReceiptTitle",value:function(t,i){var u=document.createElement("h2"),r;if(u.classList.add("title","has-text-centered"),r="",i===null)r="Create a New Receipt",u.appendChild(document.createTextNode(r));else{switch(i.transaction_type){case"R":r="Viewing Receipt: "+i.transaction_number;break;case"D":r="Viewing Deposit: "+i.transaction_number;break;case"C":r="Viewing Deposit Receipt: "+i.transaction_number}u.appendChild(document.createTextNode(r));i.child_transaction!==null&&function(){var t=i.child_transaction,f=document.createElement("a");f.appendChild(document.createTextNode(t.transaction_number));f.onclick=function(){n.ShowReceiptDetail(t.transaction_id)};switch(t.transaction_type){case"D":r=", Deposited: ";break;case"C":r=", Deposit Accepted: "}u.appendChild(document.createTextNode(r));u.appendChild(f)}()}t.appendChild(u)}},{key:"RenderDepartmentSelection",value:function(t,i){var r=this;i===null?this.department_element.onchange=function(t){r.department_id=parseInt(t.target.value);r.selected_department=n.Department.FindDepartment(r.department_id);r.RenderDepartmentControls();r.RenderPaymentTypes()}:(this.department_id=i.department_id,this.selected_department=n.Department.FindDepartment(this.department_id),this.RenderSavedDepartmentControls(i),this.RenderSavedPaymentTypes(i),this.department_element.value=i.department_id.toString(),this.department_element.disabled=!0);this.department_element_container=n.Department.CreateDepartmentElementField(this.department_element);t.appendChild(this.department_element_container)}},{key:"RenderDepartmentControls",value:function(){var n,t,u,f,e;if(this.department_control_data=[],n=document.getElementById(this.department_controls_target),n===null&&(n=document.createElement("div"),n.id=this.department_controls_target,document.getElementById(i.action_container).appendChild(n)),Utilities.Clear_Element(n),this.department_id!==-1&&this.selected_department!==null&&this.selected_department.controls.length!==0){var r=!0,o=!1,s=undefined;try{for(t=this.selected_department.control_groups[Symbol.iterator]();!(r=(u=t.next()).done);r=!0)e=u.value,(f=this.department_control_data).push.apply(f,_toConsumableArray(e.CreateControlData(n)))}catch(h){o=!0;s=h}finally{try{!r&&t["return"]&&t["return"]()}finally{if(o)throw s;}}}}},{key:"RenderPaymentTypes",value:function(){var f=this,n,t,e,r,o;if(this.payment_type_data=[],n=document.getElementById(this.payment_type_target),n===null&&(n=document.createElement("div"),n.id=this.payment_type_target,document.getElementById(i.action_container).appendChild(n)),Utilities.Clear_Element(n),this.department_id!==-1&&this.selected_department!==null){t=document.createElement("ol");t.classList.add("payment_type");var u=!0,s=!1,h=undefined;try{for(e=function(){var u=o.value,n=document.createElement("li"),r,e,i;n.classList.add("light-function","is-size-4","has-background-link");n.style.cursor="pointer";n.setAttribute("payment_type_id",u.payment_type_id.toString());r=document.createElement("span");r.classList.add("name");r.appendChild(document.createTextNode(u.name));n.appendChild(r);e=document.createElement("span");e.classList.add("totals");n.appendChild(e);t.appendChild(n);i=document.createElement("ol");i.classList.add("control_container","hide");t.appendChild(i);n.onclick=function(){i.childElementCount===0&&(f.AddPaymentType(u,i),i.classList.remove("hide"));console.log("this transaction",f)}},r=this.selected_department.payment_types[Symbol.iterator]();!(u=(o=r.next()).done);u=!0)e()}catch(c){s=!0;h=c}finally{try{!u&&r["return"]&&r["return"]()}finally{if(s)throw h;}}n.appendChild(t)}}},{key:"AddPaymentType",value:function(i,r){var f=this,e=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],o,y,p,h,s,w,c,u;if(i.payment_type_id===62){var l=!0,b=!1,k=undefined;try{for(o=this.payment_type_data[Symbol.iterator]();!(l=(y=o.next()).done);l=!0)if(p=y.value,p.payment_type_id===62){alert("You can only add 1 Security Deposit to receipt.");return}}catch(d){b=!0;k=d}finally{try{!l&&o["return"]&&o["return"]()}finally{if(b)throw k;}}}if(h=this.next_payment_type_index++,e){var a=0,v=!0,g=!1,nt=undefined;try{for(s=this.payment_type_data[Symbol.iterator]();!(v=(w=s.next()).done);v=!0)c=w.value,c.payment_type_index>a&&(a=c.payment_type_index)}catch(d){g=!0;nt=d}finally{try{!v&&s["return"]&&s["return"]()}finally{if(g)throw nt;}}h=a+1}u=new t.PaymentTypeData(i,r,h);this.payment_type_data.push(u);u.add_another_payment_type_button.onclick=function(){f.AddPaymentType(i,r,e)};u.cancel_payment_type_button.onclick=function(){r.removeChild(u.payment_type_container);var n=f.payment_type_data.findIndex(function(n){return n.payment_type_index===u.payment_type_index});n>-1&&f.payment_type_data.splice(n,1);u=null;r.childElementCount===0&&r.classList.add("hide")};e&&Utilities.Set_Text(u.save_button,"Save New Payment Types");u.save_button.onclick=function(t){var i=t.target;Utilities.Toggle_Loading_Button(i,!0);e?(f.SaveNewPaymentTypes(),Utilities.Toggle_Loading_Button(i,!1)):f.ValidateTransaction()?(n.currentReceipt.ShowReceiptPreview(),Utilities.Toggle_Loading_Button(i,!1)):Utilities.Toggle_Loading_Button(i,!1)}}},{key:"RenderSavedDepartmentControls",value:function(t){var r,u,e,o,s;if(this.department_control_data=[],r=document.getElementById(this.department_controls_target),r===null&&(r=document.createElement("div"),r.id=this.department_controls_target,document.getElementById(i.action_container).appendChild(r)),Utilities.Clear_Element(r),this.department_id!==-1&&this.selected_department!==null&&this.selected_department.controls.length!==0){var l=n.ControlGroup.CreateSavedControlGroups(t.department_control_data),f=!0,h=!1,c=undefined;try{for(u=l[Symbol.iterator]();!(f=(e=u.next()).done);f=!0)s=e.value,(o=this.department_control_data).push.apply(o,_toConsumableArray(s.CreateControlData(r,!1)))}catch(a){h=!0;c=a}finally{try{!f&&u["return"]&&u["return"]()}finally{if(h)throw c;}}}}},{key:"RenderSavedPaymentTypes",value:function(t){var h=this,r,u,y,f,p,e,c,l,o,w,b,s,k;if(this.payment_type_data=[],r=document.getElementById(this.payment_type_target),r===null&&(r=document.createElement("div"),r.id=this.payment_type_target,document.getElementById(i.action_container).appendChild(r)),Utilities.Clear_Element(r),this.department_id!==-1&&this.selected_department!==null){u=document.createElement("ol");u.classList.add("payment_type");var ut=t.payment_type_data.map(function(n){return n.payment_type_id}),d=[].concat(_toConsumableArray(new Set(ut))),a=!0,g=!1,nt=undefined;try{for(y=function(){var b=p.value,v=t.payment_type_data.filter(function(n){return n.payment_type_id===b}),s=n.FindPaymentType(v[0].payment_type_id),i=document.createElement("li"),r,a,f,y;i.classList.add("light-function","is-size-4","has-background-link");i.style.cursor="pointer";i.setAttribute("payment_type_id",s.payment_type_id.toString());r=document.createElement("span");r.classList.add("name");r.appendChild(document.createTextNode(s.name));i.appendChild(r);a=document.createElement("span");a.classList.add("totals");i.appendChild(a);u.appendChild(i);f=document.createElement("ol");f.classList.add("control_container");u.appendChild(f);e=!0;c=!1;l=undefined;try{for(o=v[Symbol.iterator]();!(e=(w=o.next()).done);e=!0)y=w.value,h.AddSavedPaymentType(s,y,f)}catch(k){c=!0;l=k}finally{try{!e&&o["return"]&&o["return"]()}finally{if(c)throw l;}}},f=d[Symbol.iterator]();!(a=(p=f.next()).done);a=!0)y()}catch(tt){g=!0;nt=tt}finally{try{!a&&f["return"]&&f["return"]()}finally{if(g)throw nt;}}var v=!0,it=!1,rt=undefined;try{for(b=function(){var n=k.value;d.indexOf(n.payment_type_id)===-1&&function(){var t=document.createElement("li"),r,f,i;t.classList.add("light-function","is-size-4","has-background-link");t.style.cursor="pointer";t.setAttribute("payment_type_id",n.payment_type_id.toString());r=document.createElement("span");r.classList.add("name");r.appendChild(document.createTextNode(n.name));t.appendChild(r);f=document.createElement("span");f.classList.add("totals");t.appendChild(f);u.appendChild(t);i=document.createElement("ol");i.classList.add("control_container","hide");u.appendChild(i);t.onclick=function(){i.childElementCount===0&&(h.AddPaymentType(n,i,!0),i.classList.remove("hide"));console.log("this transaction",h)}}()},s=this.selected_department.payment_types[Symbol.iterator]();!(v=(k=s.next()).done);v=!0)b()}catch(tt){it=!0;rt=tt}finally{try{!v&&s["return"]&&s["return"]()}finally{if(it)throw rt;}}r.appendChild(u)}}},{key:"AddSavedPaymentType",value:function(n,i,r){var f=this,u=new t.PaymentTypeData(n,r,this.next_payment_type_index++,i);this.payment_type_data.push(u);u.add_another_payment_type_button.onclick=function(){f.AddPaymentType(n,r,!0)};u.cancel_payment_type_button.style.display="none";u.save_button.style.display="none"}},{key:"RenderReceivedFromInput",value:function(t,i){var r=this,u=i===null?"":i.received_from;this.received_from=u;this.received_from_element=n.ControlGroup.CreateInput("text",500,!0,"Received From",u);i===null?this.received_from_element.oninput=function(n){var t=n.target;r.received_from=t.value.trim();r.IsValid()}:this.received_from_element.readOnly=!0;this.received_from_element_container=n.ControlGroup.CreateInputFieldContainer(this.received_from_element,"Received From or N/A",!0,"is-one-half");t.appendChild(this.received_from_element_container)}},{key:"ValidateNewPaymentTypes",value:function(n){var r=!0,i=!0,u=!1,f=undefined,t,e,o;try{for(t=n[Symbol.iterator]();!(i=(e=t.next()).done);i=!0)o=e.value,o.Validate()||(r=!1)}catch(s){u=!0;f=s}finally{try{!i&&t["return"]&&t["return"]()}finally{if(u)throw f;}}return r}},{key:"ValidateTransaction",value:function(){var n=!0,t,e,o,i,s,h,r;n=this.IsValid();var u=!0,c=!1,l=undefined;try{for(t=this.department_control_data[Symbol.iterator]();!(u=(e=t.next()).done);u=!0)o=e.value,r=o.Validate(),!r&&n&&(n=!1)}catch(a){c=!0;l=a}finally{try{!u&&t["return"]&&t["return"]()}finally{if(c)throw l;}}var f=!0,v=!1,y=undefined;try{for(i=this.payment_type_data[Symbol.iterator]();!(f=(s=i.next()).done);f=!0)h=s.value,r=h.Validate(),!r&&n&&(n=!1)}catch(a){v=!0;y=a}finally{try{!f&&i["return"]&&i["return"]()}finally{if(v)throw y;}}return n&&(this.ValidateCheckCount()||(Utilities.Error_Show(this.transaction_error_element,"You have entered a check amount but have entered that you have collected no checks."),this.transaction_error_element.parentElement.scrollIntoView(),n=!1)),n}},{key:"ValidateCheckCount",value:function(){var f=0,i=!0,e=!1,o=undefined,n,s,t,h,r;try{for(n=this.payment_type_data[Symbol.iterator]();!(i=(s=n.next()).done);i=!0){var v=s.value,u=!0,c=!1,l=undefined;try{for(t=v.payment_method_data[Symbol.iterator]();!(u=(h=t.next()).done);u=!0){if(r=h.value,r.check_count>0)return!0;f+=r.check_amount}}catch(a){c=!0;l=a}finally{try{!u&&t["return"]&&t["return"]()}finally{if(c)throw l;}}}}catch(a){e=!0;o=a}finally{try{!i&&n["return"]&&n["return"]()}finally{if(e)throw o;}}return f===0}},{key:"IsValid",value:function(){n.error_scrolled=!1;this.ResetErrorElements();var t=!0;return this.received_from.length===0&&(n.ControlGroup.UpdateInputError(this.received_from_element,this.received_from_element_container,"This field is required."),t=!1),t}},{key:"ResetErrorElements",value:function(){Utilities.Clear_Element(this.transaction_error_element);n.ControlGroup.UpdateSelectError(this.department_element_container,"");n.ControlGroup.UpdateInputError(this.received_from_element,this.received_from_element_container,"")}},{key:"SaveTransactionData",value:function(){var r=this,u=n.GetPath();Utilities.Post(u+"API/Transaction/Save",r).then(function(u){if(u.error_text.length===0)console.log("post probably good",u),n.currentReceipt.ShowReceipt(u),n.ResetReceipt(),n.Data.TransactionData.GetTransactionList().then(function(r){n.transactions=r;i.RenderTransactionList(r);Utilities.Toggle_Loading_Button(t.TransactionData.reload_button,!1)});else{console.log("transaction error",u.error_text,u);n.ViewReceiptDetail();r.ParseReturnedTransactionForErrors(u);return}},function(n){console.log("post error occurred",n)})}},{key:"ParseReturnedTransactionForErrors",value:function(n){var a=n,o=!0,v=!1,y=undefined,r,p,u,w,f,s,e,b,t,i;try{for(r=a.department_control_data[Symbol.iterator]();!(o=(p=r.next()).done);o=!0)t=p.value,t.error_text.length>0&&(i=this.FindDepartmentControl(t.control_id),i!==undefined&&i.SetErrorText(t.error_text))}catch(h){v=!0;y=h}finally{try{!o&&r["return"]&&r["return"]()}finally{if(v)throw y;}}var c=!0,k=!1,d=undefined;try{for(u=a.payment_type_data[Symbol.iterator]();!(c=(w=u.next()).done);c=!0)if(f=w.value,s=this.FindPaymentType(f.payment_type_id,f.payment_type_index),s!==undefined){var l=!0,g=!1,nt=undefined;try{for(e=f.control_data[Symbol.iterator]();!(l=(b=e.next()).done);l=!0)t=b.value,t.error_text.length>0&&(i=s.FindPaymentTypeControl(t.control_id),i!==undefined&&i.SetErrorText(t.error_text))}catch(h){g=!0;nt=h}finally{try{!l&&e["return"]&&e["return"]()}finally{if(g)throw nt;}}}}catch(h){k=!0;d=h}finally{try{!c&&u["return"]&&u["return"]()}finally{if(k)throw d;}}Utilities.Error_Show(this.transaction_error_element,n.error_text);this.transaction_error_element.parentElement.scrollIntoView()}},{key:"FindDepartmentControl",value:function(n){return this.department_control_data.find(function(t){return t.control_id===n})}},{key:"FindPaymentType",value:function(n,t){return this.payment_type_data.find(function(i){return i.payment_type_index===t&&i.payment_type_id===n})}},{key:"SaveNewPaymentTypes",value:function(){var h=this,i,f,t,e;if(console.log("save new payment types",this.payment_type_data),this.transaction_id===-1){alert("There was an error attempting to save this transaction.  The transaction id is unknown.");return}var r=[],u=!0,o=!1,s=undefined;try{for(i=this.payment_type_data[Symbol.iterator]();!(u=(f=i.next()).done);u=!0)t=f.value,t.transaction_payment_type_id===-1&&(t.transaction_id=this.transaction_id,t.added_after_save=!0,r.push(t))}catch(c){o=!0;s=c}finally{try{!u&&i["return"]&&i["return"]()}finally{if(o)throw s;}}if(!this.ValidateNewPaymentTypes(r)){console.log("failed to validate new payment types");return}e=n.GetPath();Utilities.Post_Empty(e+"API/Transaction/AddPaymentTypes",r).then(function(t){console.log("response",t);t.ok?t.text().then(function(t){console.log("response text",t);t.length>0?alert("An error occurred attempting to save this payment type:\r\n"+t):n.ShowReceiptDetail(h.transaction_id)}):alert("An error occurred attempting to save this payment type:\r\n"+t.text)})}}],[{key:"GetTransactionList",value:function(){var u=n.current_page,t,r;return Utilities.Toggle_Loading_Button(i.reload_button,!0),t=n.GetPath(),r=i.GetTransactionFilters(),Utilities.Get(t+"API/Transaction/Get?page_number="+u.toString()+r)}},{key:"GetTransactionPageCount",value:function(){var r=n.GetPath(),t=i.GetTransactionFilters();return t.length>0&&(t="?"+t.substr(1)),Utilities.Get(r+"API/Transaction/PageCount"+t)}},{key:"GetTransactionFilters",value:function(){var t=[];return n.name_filter.length>0&&t.push("&display_name_filter="+n.name_filter),n.department_id_filter>0&&t.push("&department_id_filter="+n.department_id_filter.toString()),n.transaction_type_filter.length>0&&t.push("&transaction_type_filter="+n.transaction_type_filter),n.completed_filter.length>0&&t.push("&completed_filter="+n.completed_filter),n.modified_only_filter&&t.push("&has_been_modified=true"),n.transaction_number_filter.length>0&&t.push("&transaction_number_filter="+n.transaction_number_filter),t.join("")}},{key:"GetSpecificTransaction",value:function(t){var i=n.GetPath();return Utilities.Get(i+"API/Transaction/GetTransactionData?transaction_id="+t.toString())}},{key:"RenderTransactionList",value:function(t){var h=arguments.length<=1||arguments[1]===undefined?null:arguments[1],c=arguments.length<=2||arguments[2]===undefined?null:arguments[2],r=h!==null,o=h,u,f,l,a,e,v,y;if(r||(o=document.getElementById(i.transaction_list_view_container)),Utilities.Clear_Element(o),u=i.CreateTransactionListTable(r),o.appendChild(u),f=document.createElement("tbody"),u.appendChild(f),l=r?9:11,a=r?"No transactions were found.":"No transactions were found to match your filters.",t.length===0)f.appendChild(n.CreateMessageRow(l,a));else{var s=!0,p=!1,w=undefined;try{for(e=t[Symbol.iterator]();!(s=(v=e.next()).done);s=!0)y=v.value,f.appendChild(i.CreateTransactionListRow(y,r))}catch(b){p=!0;w=b}finally{try{!s&&e["return"]&&e["return"]()}finally{if(p)throw w;}}}c!==null&&u.appendChild(c)}},{key:"CreateTransactionsTableFooter",value:function(n){var r=document.createElement("tfoot"),t=document.createElement("tr"),i;return r.appendChild(t),i=Utilities.CreateTableCell("td","Deposit Totals","has-text-right"),i.colSpan=6,t.appendChild(i),t.appendChild(Utilities.CreateTableCell("td",n.total_check_count.toString(),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.total_check_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.total_cash_amount),"has-text-right")),t.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(n.total_check_amount+n.total_cash_amount),"has-text-right")),r}},{key:"CreateTransactionListTable",value:function(){var f=arguments.length<=0||arguments[0]===undefined?!1:arguments[0],r=document.createElement("table"),i,t,u;r.classList.add("table","is-fullwidth");i=document.createElement("thead");i.id="transaction_list_view_header";r.appendChild(i);t=document.createElement("tr");i.appendChild(t);t.appendChild(Utilities.CreateTableCell("th","Created On","has-text-left","15%"));t.appendChild(Utilities.CreateTableCell("th","Type","has-text-centered","5%"));t.appendChild(Utilities.CreateTableCell("th","Number","has-text-left","10%"));t.appendChild(Utilities.CreateTableCell("th","Status","has-text-left","7.5%"));
//!short_view ? "7.5%" : "12.5%"));
t.appendChild(Utilities.CreateTableCell("th","Department","has-text-left","15%"));t.appendChild(Utilities.CreateTableCell("th","Received From","has-text-left","12.5%"));t.appendChild(Utilities.CreateTableCell("th","Checks","has-text-right","7.5%"));
//!short_view ? "7.5%" : "12.5%"));
return t.appendChild(Utilities.CreateTableCell("th","$ Check","has-text-right","7.5%")),t.appendChild(Utilities.CreateTableCell("th","$ Cash","has-text-right","7.5%")),t.appendChild(Utilities.CreateTableCell("th","$ Total","has-text-right","7.5%")),f||(u=Utilities.CreateTableCell("th","Pg: "+n.current_page.toString(),"has-text-centered","5%"),t.appendChild(u)),r}},{key:"CreateTransactionListRow",value:function(t,r){var u=document.createElement("tr"),f,s,e,o,h;return u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_DateTime(t.created_on),"has-text-left")),u.appendChild(Utilities.CreateTableCell("td",t.transaction_type,"has-text-centered")),f=document.createElement("a"),f.appendChild(document.createTextNode(t.transaction_number)),f.onclick=function(){n.ShowReceiptDetail(t.transaction_id)},s=Utilities.CreateTableCell("td","","has-text-left"),s.appendChild(f),u.appendChild(s),e="",t.transaction_type==="R"||t.transaction_type==="C"?e=t.child_transaction_id===null?"Incomplete":t.child_transaction_id===t.transaction_id?"Completed":"Deposited":t.transaction_type==="D"&&(e=t.child_transaction_id===null?"Incomplete":"Accepted"),u.appendChild(Utilities.CreateTableCell("td",e,"has-text-left")),u.appendChild(Utilities.CreateTableCell("td",t.department_name,"has-text-left")),u.appendChild(Utilities.CreateTableCell("td",t.received_from,"has-text-left")),u.appendChild(Utilities.CreateTableCell("td",t.total_check_count.toString(),"has-text-right")),u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t.total_check_amount),"has-text-right")),u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t.total_cash_amount),"has-text-right")),u.appendChild(Utilities.CreateTableCell("td",Utilities.Format_Amount(t.total_check_amount+t.total_cash_amount),"has-text-right")),r||(o=document.createElement("td"),o.classList.add("has-text-right"),h=i.CreateTableCellIconButton("fa-print","is-small"),h.onclick=function(){n.ShowReceipt(t.transaction_id)},o.appendChild(h),u.appendChild(o)),u}},{key:"CreateTableCellIconButton",value:function(n,t){var r=document.createElement("a"),i,u;return r.classList.add("button",t),i=document.createElement("span"),i.classList.add("icon",t),u=document.createElement("i"),u.classList.add("fas",n),i.appendChild(u),r.appendChild(i),r}},{key:"CreateAcceptDepositMenu",value:function(t){var s,r,f,h,e,c,o,l,i,a,u,v;return t.transaction_type="C",s=document.createDocumentFragment(),r=document.createElement("div"),r.classList.add("columns","is-multiline"),s.appendChild(r),f=n.ControlGroup.CreateInput("number",15,!0,"Cash Amount"),h=n.ControlGroup.CreateInputFieldContainer(f,"Cash Amount Collected",!0,"is-one-quarter"),r.appendChild(h),f.oninput=function(){t.total_cash_amount=0;n.ControlGroup.ValidateMoney(f,h)&&(t.total_cash_amount=f.valueAsNumber)},e=n.ControlGroup.CreateInput("number",15,!0,"Check Amount"),c=n.ControlGroup.CreateInputFieldContainer(e,"Check Amount Collected",!0,"is-one-quarter"),r.appendChild(c),e.oninput=function(){t.total_check_amount=0;n.ControlGroup.ValidateMoney(e,c)&&(t.total_check_amount=e.valueAsNumber)},o=n.ControlGroup.CreateInput("number",15,!0,"# of Checks"),l=n.ControlGroup.CreateInputFieldContainer(o,"# of Checks",!0,"is-one-quarter"),r.appendChild(l),o.oninput=function(){t.total_check_count=0;n.ControlGroup.ValidateNumber(o,l)&&(t.total_check_count=o.valueAsNumber)},i=document.createElement("textarea"),i.maxLength=500,i.required=!1,i.classList.add("textarea","is-normal"),i.rows=4,i.value="",i.oninput=function(){t.comment=i.value},a=n.ControlGroup.CreateInputFieldContainer(i,"Comments ** optional",!0,"is-half"),r.appendChild(a),u=document.createElement("button"),u.classList.add("button","is-success"),u.appendChild(document.createTextNode("Create Receipt For This Deposit")),u.onclick=function(){if(console.log("Create C Transaction",t),Utilities.Toggle_Loading_Button(u,!0),t.total_cash_amount===0&&t.total_check_amount===0&&t.comment.length===0){alert("In order to create a receipt for this deposit, you must enter this information.");return}var i=n.GetPath();Utilities.Post(i+"API/Transaction/Save",t).then(function(t){n.currentReceipt.ShowReceipt(t);n.ResetReceipt();n.GetTransactionList(n.current_page,!1).then(function(){Utilities.Toggle_Loading_Button(u,!1)})},function(n){console.log("post error occurred",n)})},v=n.ControlGroup.CreateInputFieldContainer(u,"",!0,"is-one-quarter"),r.appendChild(v),s}},{key:"SaveDepositReceipt",value:function(){}}]),i}();i.reload_button="filterRefreshButton";i.action_container="action_view";i.transaction_view_container="transaction_view";i.transaction_list_view_container="transaction_list_view";i.transaction_view_filters_container="transaction_view_filters";t.TransactionData=i})(t=n.Data||(n.Data={}))}(Transaction||(Transaction={}));